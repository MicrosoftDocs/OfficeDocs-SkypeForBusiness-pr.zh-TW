---
title: 在商務用 Skype Server 中的階段 AV 和 OAuth 憑證 Set-CsCertificate 中使用-擲入
ms.reviewer: ''
ms.author: v-cichur
author: cichur
manager: serdars
audience: ITPro
ms.topic: article
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
description: 摘要：為商務用 Skype Server 階段 AV 和 OAuth 憑證。
ms.openlocfilehash: a2586e9ebda1bae1605fd6033681b469e6731b8c
ms.sourcegitcommit: c528fad9db719f3fa96dc3fa99332a349cd9d317
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/12/2021
ms.locfileid: "49806553"
---
# <a name="stage-av-and-oauth-certificates-in-skype-for-business-server-using--roll-in-set-cscertificate"></a><span data-ttu-id="f4b49-103">在商務用 Skype Server 中的階段 AV 和 OAuth 憑證 Set-CsCertificate 中使用-擲入</span><span class="sxs-lookup"><span data-stu-id="f4b49-103">Stage AV and OAuth certificates in Skype for Business Server using -Roll in Set-CsCertificate</span></span>
 
<span data-ttu-id="f4b49-104">**摘要：** 階段 AV 和 OAuth 商務用 Skype Server 的憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-104">**Summary:** Stage AV and OAuth certificates for Skype for Business Server.</span></span>
  
<span data-ttu-id="f4b49-105">Audio/Video (A/V) 通訊是商務用 Skype Server 的主要元件。</span><span class="sxs-lookup"><span data-stu-id="f4b49-105">Audio/Video (A/V) communications is a key component of Skype for Business Server.</span></span> <span data-ttu-id="f4b49-106">「應用程式共用」和「音訊」及「視訊會議」等功能會依賴指派給 A/V Edge service 的憑證，尤其是 A/V 驗證服務。</span><span class="sxs-lookup"><span data-stu-id="f4b49-106">Features such as application sharing and audio and video conferencing rely on the certificates assigned to the A/V Edge service, specifically the A/V Authentication service.</span></span>
  
> [!IMPORTANT]
> <span data-ttu-id="f4b49-107">這項新功能的設計目的是用於 A/V Edge service 和 OAuthTokenIssuer 憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-107">This new feature is designed to work for the A/V Edge service and the OAuthTokenIssuer certificate.</span></span> <span data-ttu-id="f4b49-108">其他憑證類型可以搭配「A/V Edge service」和「OAuth 憑證」類型進行布建，但不會受益于 A/V Edge service 憑證所用的共存行為。</span><span class="sxs-lookup"><span data-stu-id="f4b49-108">Other certificate types can be provisioned along with the A/V Edge service and OAuth certificate type, but will not benefit from the coexistence behavior that the A/V Edge service certificate will.</span></span>
  
<span data-ttu-id="f4b49-109">商務用 Skype Server 管理命令介面 PowerShell 用來管理商務用 Skype Server 憑證的指令程式是指 A/V Edge service 憑證作為 AudioVideoAuthentication 憑證類型和 Microsoft.rtc.management.writableconfig.settings.ssauth.oauthserver 憑證做為 typeOAuthTokenIssuer。</span><span class="sxs-lookup"><span data-stu-id="f4b49-109">The Skype for Business Server Management Shell PowerShell cmdlets used to manage Skype for Business Server certificates refers to the A/V Edge service certificate as the AudioVideoAuthentication certificate type and the OAuthServer certificate as typeOAuthTokenIssuer.</span></span> <span data-ttu-id="f4b49-110">如需本主題的其餘部分，以及唯一識別憑證，則會使用相同的識別碼類型，AudioVideoAuthentication andOAuthTokenIssuer。</span><span class="sxs-lookup"><span data-stu-id="f4b49-110">For the rest of this topic and to uniquely identify the certificates, they will be referred to by the same identifier type, AudioVideoAuthentication andOAuthTokenIssuer.</span></span>
  
<span data-ttu-id="f4b49-111">A/V 驗證服務是專用來核發 Token，以供用戶端和其他 A/V 取用者使用。</span><span class="sxs-lookup"><span data-stu-id="f4b49-111">The A/V Authentication service is responsible for issuing tokens that are used by clients and other A/V consumers.</span></span> <span data-ttu-id="f4b49-112">Token 是依據憑證上的屬性而產生，因此當憑證到期、連線中斷或必須重新加入時，就會導致新的憑證產生新的 Token。</span><span class="sxs-lookup"><span data-stu-id="f4b49-112">The tokens are generated from attributes on the certificate, and when the certificate expires, loss of connection and requirement to rejoin with a new token generated by the new certificate will result.</span></span> <span data-ttu-id="f4b49-113">商務用 Skype Server 中的新功能會緩解這項問題，也就是在舊憑證即將到期，並且允許兩個憑證在一段時間內繼續運作的能力。</span><span class="sxs-lookup"><span data-stu-id="f4b49-113">A new feature in Skype for Business Server will alleviate this problem - the ability to stage a new certificate in advance of the old one expiring and allowing both certificates to continue to function for a period of time.</span></span> <span data-ttu-id="f4b49-114">此功能使用 Set-CsCertificate 商務用 Skype Server 管理命令介面 Cmdlet 中的更新功能。</span><span class="sxs-lookup"><span data-stu-id="f4b49-114">This feature uses updated functionality in the Set-CsCertificate Skype for Business Server Management Shell cmdlet.</span></span> <span data-ttu-id="f4b49-115">新的參數滾（-EffectiveDate 現有的參數）會將新的 AudioVideoAuthentication 憑證放置於憑證存放區中。</span><span class="sxs-lookup"><span data-stu-id="f4b49-115">The new parameter -Roll, with the existing parameter -EffectiveDate, will place the new AudioVideoAuthentication certificate in the certificate store.</span></span> <span data-ttu-id="f4b49-116">舊的 AudioVideoAuthentication 憑證仍會保留給已核發的 Token，以免其失效。</span><span class="sxs-lookup"><span data-stu-id="f4b49-116">The older AudioVideoAuthentication certificate will still remain for issued tokens to be validated against.</span></span> <span data-ttu-id="f4b49-117">只要一將新的 AudioVideoAuthentication 憑證準備就緒，就會發生下列一系列的事件：</span><span class="sxs-lookup"><span data-stu-id="f4b49-117">Beginning with putting the new AudioVideoAuthentication certificate in place, the following series of events will occur:</span></span>
  
> [!TIP]
> <span data-ttu-id="f4b49-118">使用商務用 Skype Server 管理命令介面 Cmdlet 來管理憑證，您可以針對 Edge Server 上的每個用途要求個別且獨特的憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-118">Using the Skype for Business Server Management Shell cmdlets for managing certificates, you can request separate and distinct certificates for each purpose on the Edge Server.</span></span> <span data-ttu-id="f4b49-119">在商務用 Skype 伺服器部署中使用憑證嚮導可協助您建立憑證，但通常是將 Edge Server 所有憑證使用的 **預設** 類型，放在單一憑證上。</span><span class="sxs-lookup"><span data-stu-id="f4b49-119">Using the Certificate Wizard in the Skype for Business Server Deployment Wizard assists you in creating certificates, but is typically of the **default** type which couples all certificate uses for the Edge Server onto a single certificate.</span></span> <span data-ttu-id="f4b49-120">若您要使用彙總的憑證，建議的做法是將 AudioVideoAuthentication 憑證從其他憑證用途中獨立出來。</span><span class="sxs-lookup"><span data-stu-id="f4b49-120">The recommended practice if you are going to use the rolling certificate feature is to decouple the AudioVideoAuthentication certificate from the other certificate purposes.</span></span> <span data-ttu-id="f4b49-121">您可以佈建和臨時發出預設類型的憑證，但只有組合憑證的 AudioVideoAuthentication 部分可以臨時發出。</span><span class="sxs-lookup"><span data-stu-id="f4b49-121">You can provision and stage a certificate of the Default type, but only the AudioVideoAuthentication portion of the combined certificate will benefit from the staging.</span></span> <span data-ttu-id="f4b49-122"> (中的使用者，例如，當憑證到期時，立即訊息交談) 需要登出和登入，以利用與 Access Edge service 相關聯的新憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-122">A user involved in (for example) an instant messaging conversation when the certificate expires will need to log out and log back in to make use of the new certificate associated with the Access Edge service.</span></span> <span data-ttu-id="f4b49-123">在使用 Web 會議 Edge service 的 Web 會議中，使用者會發生類似行為。</span><span class="sxs-lookup"><span data-stu-id="f4b49-123">Similar behavior will occur for a user involved in a Web conference using the Web Conferencing Edge service.</span></span> <span data-ttu-id="f4b49-124">OAuthTokenIssuer 憑證是一種特殊類型的憑證，在所有伺服器中都可以共用。</span><span class="sxs-lookup"><span data-stu-id="f4b49-124">The OAuthTokenIssuer certificate is a specific type that is shared across all servers.</span></span> <span data-ttu-id="f4b49-125">您可以在一個位置建立及管理憑證，並將憑證儲存在所有其他伺服器的中央管理存放區中。</span><span class="sxs-lookup"><span data-stu-id="f4b49-125">You create and manage the certificate in one place and the certificate is stored in the Central Management store for all other servers.</span></span>
  
<span data-ttu-id="f4b49-126">在使用 Set-CsCertificate Cmdlet 以及在目前的憑證過期前利用其來臨時發出憑證時，您也需要全盤理解您的選項和需求。</span><span class="sxs-lookup"><span data-stu-id="f4b49-126">Additional detail is needed to fully understand your options and requirements when using the Set-CsCertificate cmdlet and using it to stage certificates prior to the current certificate expiring.</span></span> <span data-ttu-id="f4b49-127">-擺參數很重要，但實質上只是單一用途。</span><span class="sxs-lookup"><span data-stu-id="f4b49-127">The -Roll parameter is important, but essentially single purpose.</span></span> <span data-ttu-id="f4b49-128">如果您將它定義為參數，您會告訴 Set-CsCertificate，您將會提供受影響之憑證的相關資訊，例如 AudioVideoAuthentication 和 OAuthTokenIssuer) ，當憑證將會在-EffectiveDate 中所定義時，將會 (受到影響。</span><span class="sxs-lookup"><span data-stu-id="f4b49-128">If you define it as a parameter, you are telling Set-CsCertificate that you will be providing information about the certificate that will be affected defined by -Type (for example AudioVideoAuthentication and OAuthTokenIssuer), when the certificate will become effective defined by -EffectiveDate.</span></span>
  
 <span data-ttu-id="f4b49-129">**-** 滾參數是必要的，且具有必須與其一起提供的相依性。</span><span class="sxs-lookup"><span data-stu-id="f4b49-129">**-Roll**: The -Roll parameter is required and has dependencies that must be supplied along with it.</span></span> <span data-ttu-id="f4b49-130">下列為可完整定義哪些憑證將受影響以及套用方式的必要參數：</span><span class="sxs-lookup"><span data-stu-id="f4b49-130">Required parameters to fully define which certificates will be affected and how they will be applied:</span></span>
  
 <span data-ttu-id="f4b49-131">**-EffectiveDate**：此參數-EffectiveDate 會定義何時新的憑證會使用目前憑證成為共同作用。</span><span class="sxs-lookup"><span data-stu-id="f4b49-131">**-EffectiveDate**: The parameter -EffectiveDate defines when the new certificate will become co-active with the current certificate.</span></span> <span data-ttu-id="f4b49-132">-EffectiveDate 可以接近目前憑證的到期時間，也可以是較長的一段時間。</span><span class="sxs-lookup"><span data-stu-id="f4b49-132">The -EffectiveDate can be close to the expiry time of the current certificate, or it can be a longer period of time.</span></span> <span data-ttu-id="f4b49-133">AudioVideoAuthentication 憑證的建議最低-EffectiveDate 為8小時，也就是使用 AudioVideoAuthentication 憑證發行之 AV Edge service 權杖的預設權杖存留時間。</span><span class="sxs-lookup"><span data-stu-id="f4b49-133">A recommended minimum -EffectiveDate for the AudioVideoAuthentication certificate would be 8 hours, which is the default token lifetime for AV Edge service tokens issued using the AudioVideoAuthentication certificate.</span></span>
  
<span data-ttu-id="f4b49-p109">臨時發出 OAuthTokenIssuer 憑證時，在讓憑證生效前的前置重疊時間方面有些不同的需求。OAuthTokenIssuer 憑證的最低前置重疊時間為目前憑證到期時間的前 24 小時。共存的延伸前置重疊時間則取決於和 OAuthTokenIssuer 憑證相依的其他伺服器角色而定 (例如 Exchange Server)，其在憑證所建立的驗證和加密金鑰內容方面可具備較長的保留時間。</span><span class="sxs-lookup"><span data-stu-id="f4b49-p109">When staging OAuthTokenIssuer certificates, there are different requirements for the lead time before the certificate can become effective. The minimum time that the OAuthTokenIssuer certificate should have for its lead time is 24 hours before the expiration time of the current certificate. The extended lead time for the coexistence is because of other server roles that are dependent on the OAuthTokenIssuer certificate (Exchange Server, for example) which has a longer retention time for certificate created authentication and encryption key materials.</span></span>
  
 <span data-ttu-id="f4b49-137">**-Thumbprint**：指紋是憑證上的一種屬性，且是唯一的。</span><span class="sxs-lookup"><span data-stu-id="f4b49-137">**-Thumbprint**: The thumbprint is an attribute on the certificate that is unique to that certificate.</span></span> <span data-ttu-id="f4b49-138">-Thumbprint 參數是用來識別 Set-CsCertificate Cmdlet 的動作會影響的憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-138">The -Thumbprint parameter is used to identify the certificate that will be affected by the actions of the Set-CsCertificate cmdlet.</span></span>
  
 <span data-ttu-id="f4b49-139">**-Type**：-type 參數可接受單一憑證使用類型或以逗號分隔的憑證使用類型清單。</span><span class="sxs-lookup"><span data-stu-id="f4b49-139">**-Type**: The -Type parameter can accept a single certificate usage type or a comma separated list of certificate usage types.</span></span> <span data-ttu-id="f4b49-140">憑證類型是指識別 Cmdlet 和伺服器的憑證用途的憑證類型。</span><span class="sxs-lookup"><span data-stu-id="f4b49-140">The certificate types are those that identify to the cmdlet and to the server what the purpose of the certificate is.</span></span> <span data-ttu-id="f4b49-141">例如，輸入 AudioVideoAuthentication 供 A/V Edge service 和 AV 驗證服務使用。</span><span class="sxs-lookup"><span data-stu-id="f4b49-141">For example, type AudioVideoAuthentication is for use by the A/V Edge service and the AV Authentication service.</span></span> <span data-ttu-id="f4b49-142">如果您決定同時暫存及布建其他類型的憑證，則必須考慮憑證的最長必要有效前置時間。</span><span class="sxs-lookup"><span data-stu-id="f4b49-142">If you decide to stage and provision certificates of a different type at the same time, you must consider the longest required minimum effective lead time for the certificates.</span></span> <span data-ttu-id="f4b49-143">例如，您必須暫存 AudioVideoAuthentication 和 OAuthTokenIssuer 類型的憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-143">For example, you need to stage certificates of type AudioVideoAuthentication and OAuthTokenIssuer.</span></span> <span data-ttu-id="f4b49-144">您的最低-EffectiveDate 必須是兩個憑證中的較大者，在此案例中是 OAuthTokenIssuer，其最小前置時間為24小時。</span><span class="sxs-lookup"><span data-stu-id="f4b49-144">Your minimum -EffectiveDate must be the greater of the two certificates, in this case the OAuthTokenIssuer, which has a minimum lead time of 24 hours.</span></span> <span data-ttu-id="f4b49-145">如果您不想要將前置時間的 AudioVideoAuthentication 憑證暫存為24小時，請使用更多您的需求 EffectiveDate 進行暫存。</span><span class="sxs-lookup"><span data-stu-id="f4b49-145">If you do not want to stage the AudioVideoAuthentication certificate with a lead time of 24 hours, stage it separately with an EffectiveDate that is more to your requirements.</span></span>
  
### <a name="to-update-or-renew-an-av-edge-service-certificate-with-a--roll-and--effectivedate-parameters"></a><span data-ttu-id="f4b49-146">使用滾及-EffectiveDate 參數更新或更新 A/V Edge service 憑證</span><span class="sxs-lookup"><span data-stu-id="f4b49-146">To update or renew an A/V Edge service certificate with a -Roll and -EffectiveDate parameters</span></span>

1. <span data-ttu-id="f4b49-147">以 Administrators 群組成員的身分登入本機電腦。</span><span class="sxs-lookup"><span data-stu-id="f4b49-147">Log on to the local computer as a member of the Administrators group.</span></span>
    
2. <span data-ttu-id="f4b49-148">以 A/V Edge service 上現有憑證的可匯出私密金鑰要求更新或新 AudioVideoAuthentication 憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-148">Request a renewal or new AudioVideoAuthentication certificate with exportable private key for the existing certificate on the A/V Edge service.</span></span>
    
3. <span data-ttu-id="f4b49-149">將新的 AudioVideoAuthentication 憑證匯入至 Edge Server，以及集區中的所有其他 Edge Server (如果您已部署) 集區。</span><span class="sxs-lookup"><span data-stu-id="f4b49-149">Import the new AudioVideoAuthentication certificate to the Edge Server and all other Edge Server in your pool (if you have a pool deployed).</span></span>
    
4. <span data-ttu-id="f4b49-150">使用 Set-CsCertificate Cmdlet 來設定匯入的憑證，並使用-擲參數搭配-EffectiveDate 參數。</span><span class="sxs-lookup"><span data-stu-id="f4b49-150">Configure the imported certificate with the Set-CsCertificate cmdlet and use the -Roll parameter with the -EffectiveDate parameter.</span></span> <span data-ttu-id="f4b49-151">生效日期應定義為目前憑證的到期時間 (14:00:00 或 2:00:00 PM) 扣除 Token 生命週期 (預設為八小時)。</span><span class="sxs-lookup"><span data-stu-id="f4b49-151">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus token lifetime (by default eight hours).</span></span> <span data-ttu-id="f4b49-152">這為我們提供了必須將憑證設定為使用中的時間，且為-EffectiveDate \<string\> ： "7/22/2015 6:00:00 AM」。</span><span class="sxs-lookup"><span data-stu-id="f4b49-152">This gives us a time that the certificate must be set to active, and is the -EffectiveDate \<string\>: "7/22/2015 6:00:00 AM".</span></span> 
    
    > [!IMPORTANT]
    > <span data-ttu-id="f4b49-153">對於 Edge 集區，您必須使用部署的第一個憑證的-EffectiveDate 參數所定義的日期和時間來部署及布建所有 AudioVideoAuthentication 憑證，以避免因舊憑證的破壞，但在使用新的憑證更新所有用戶端和使用者權杖之前，A/V 可能會造成的通訊中斷。</span><span class="sxs-lookup"><span data-stu-id="f4b49-153">For an Edge pool, you must have all AudioVideoAuthentication certificates deployed and provisioned by the date and time defined by the -EffectiveDate parameter of the first certificate deployed to avoid possible A/V communications disruption due to the older certificate expiring before all client and consumer tokens have been renewed using the new certificate.</span></span> 
  
    <span data-ttu-id="f4b49-154">具有-滾及-EffectiveTime 參數的 Set-CsCertificate 命令：</span><span class="sxs-lookup"><span data-stu-id="f4b49-154">The Set-CsCertificate command with the -Roll and -EffectiveTime parameter:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          <thumb print of new certificate> -Roll -EffectiveDate <date and time
          for certificate to become active>
   ```

    <span data-ttu-id="f4b49-155">Set-CsCertificate 命令範例：</span><span class="sxs-lookup"><span data-stu-id="f4b49-155">An example Set-CsCertificate command:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2015
          6:00:00 AM"
   ```

    > [!IMPORTANT]
    > <span data-ttu-id="f4b49-156">EffectiveDate 必須設定格式，以符合伺服器的區域及語言設定。</span><span class="sxs-lookup"><span data-stu-id="f4b49-156">The EffectiveDate must be formatted to match your server's region and language settings.</span></span> <span data-ttu-id="f4b49-157">範例是使用英文 (美國) 區域和語言設定</span><span class="sxs-lookup"><span data-stu-id="f4b49-157">The example uses the US English Region and Language settings</span></span> 
  
<span data-ttu-id="f4b49-158">若要進一步瞭解 Set-CsCertificate、滾及-EffectiveDate 使用現有憑證以驗證消費者所使用之 AudioVideoAuthentication 的新憑證 AudioVideoAuthentication 的處理常式，則 visual 時程表是瞭解該程式所使用之的有效方法。</span><span class="sxs-lookup"><span data-stu-id="f4b49-158">To further understand the process that Set-CsCertificate, -Roll, and -EffectiveDate use to stage a new certificate for issuing new AudioVideoAuthentication tokens while still using an existing certificate to validate AudioVideoAuthentication that are in use by consumers, a visual timeline is an effective means of understanding the process.</span></span> <span data-ttu-id="f4b49-159">在下列範例中，管理員會判斷 A/V Edge service 憑證是在07/22/2015 上的 2:00:00 PM 到期。</span><span class="sxs-lookup"><span data-stu-id="f4b49-159">In the following example, the administrator determines that the A/V Edge service certificate is due to expire at 2:00:00 PM on 07/22/2015.</span></span> <span data-ttu-id="f4b49-160">他要求並接收新的憑證，並將它匯入至其集區中的每個 Edge Server。</span><span class="sxs-lookup"><span data-stu-id="f4b49-160">He requests and receives a new certificate and imports it to each Edge Server in his pool.</span></span> <span data-ttu-id="f4b49-161">在07/22/2015 的淩晨2點，他開始執行 Get-CsCertificate，並以與新憑證的指紋字串相等的方式執行，並將-EffectiveTime 設定為 07/22/2015 6:00:00 AM。</span><span class="sxs-lookup"><span data-stu-id="f4b49-161">At 2 AM on 07/22/2015, he begins running Get-CsCertificate with -Roll, -Thumbprint equal to the thumbprint string of the new certificate, and -EffectiveTime set to 07/22/2015 6:00:00 AM.</span></span> <span data-ttu-id="f4b49-162">在每一部 Edge Server 上執行此命令。</span><span class="sxs-lookup"><span data-stu-id="f4b49-162">He runs this command on each Edge Server.</span></span>
  
![使用擲及 EffectiveDate 參數。](../../media/Ops_Certificate_Set_Roll_EffectiveTime_Timeline.jpg)
  
|<span data-ttu-id="f4b49-164">**Callout**</span><span class="sxs-lookup"><span data-stu-id="f4b49-164">**Callout**</span></span>|<span data-ttu-id="f4b49-165">**Stage**</span><span class="sxs-lookup"><span data-stu-id="f4b49-165">**Stage**</span></span>|
|:-----|:-----|
|<span data-ttu-id="f4b49-166">1 </span><span class="sxs-lookup"><span data-stu-id="f4b49-166">1</span></span>  <br/> |<span data-ttu-id="f4b49-167">開始： 7/22/2015 12:00:00 AM</span><span class="sxs-lookup"><span data-stu-id="f4b49-167">Start: 7/22/2015 12:00:00 AM</span></span>  <br/> <span data-ttu-id="f4b49-168">目前的 AudioVideoAuthentication 憑證是由於7/22/2015 于 2:00:00 PM 到期。</span><span class="sxs-lookup"><span data-stu-id="f4b49-168">The current AudioVideoAuthentication certificate is due to expire at 2:00:00 PM on 7/22/2015.</span></span> <span data-ttu-id="f4b49-169">這取決於憑證上到期的時間戳記。</span><span class="sxs-lookup"><span data-stu-id="f4b49-169">This is determined by the expires time stamp on the certificate.</span></span> <span data-ttu-id="f4b49-170">規劃您的憑證取代和翻轉，以計算8小時的重疊 (預設權杖存留期) 在現有憑證達到到期時間之前。</span><span class="sxs-lookup"><span data-stu-id="f4b49-170">Plan your certificate replacement and rollover to account for an 8 hour overlap (default token lifetime) before the existing certificate reaches the expire time.</span></span> <span data-ttu-id="f4b49-171">在此範例中，會使用 2:00:00 AM 前置時間，讓系統管理員有足夠的時間來預先設定新憑證，並在6:00:00 上午的時間前進行布建。</span><span class="sxs-lookup"><span data-stu-id="f4b49-171">The 2:00:00 AM lead time is used in this example to allow the administrator adequate time to place and provision the new certificates in advance of the 6:00:00 AM effective time.</span></span>  <br/> |
|<span data-ttu-id="f4b49-172">2 </span><span class="sxs-lookup"><span data-stu-id="f4b49-172">2</span></span>  <br/> |<span data-ttu-id="f4b49-173">7/22/2015 2:00:00 AM-7/22/2015 5:59:59 AM</span><span class="sxs-lookup"><span data-stu-id="f4b49-173">7/22/2015 2:00:00 AM - 7/22/2015 5:59:59 AM</span></span>  <br/> <span data-ttu-id="f4b49-174">在 Edge Server 上設定憑證，有效期為 6:00:00 AM (4 小時內推時間為此範例，但可使用 Set-CsCertificate 類型 \<certificate usage type\> 的指紋-EffectiveDate) 更長的時間。 \<thumbprint of new certificate\>\<datetime string of the effective time for new certificate\></span><span class="sxs-lookup"><span data-stu-id="f4b49-174">Set Certificates on Edge Servers with effective time of 6:00:00 AM (4 hour lead time is for this example, but can be longer) using Set-CsCertificate -Type \<certificate usage type\> -Thumbprint \<thumbprint of new certificate\> -Roll -EffectiveDate \<datetime string of the effective time for new certificate\></span></span>  <br/> |
|<span data-ttu-id="f4b49-175">3 </span><span class="sxs-lookup"><span data-stu-id="f4b49-175">3</span></span>  <br/> |<span data-ttu-id="f4b49-176">7/22/2015 6:00 AM-7/22/2015 2:00 下午</span><span class="sxs-lookup"><span data-stu-id="f4b49-176">7/22/2015 6:00 AM - 7/22/2015 2:00 PM</span></span>  <br/> <span data-ttu-id="f4b49-177">若要驗證權杖，請先嘗試新的憑證，如果新的憑證無法驗證權杖，就會嘗試舊的憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-177">To validate tokens, the new certificate is tried first, and if the new certificate fails to validate the token, the old certificate is tried.</span></span> <span data-ttu-id="f4b49-178">此程式適用于8小時 (預設權杖存留期) 重疊期間內的所有標記。</span><span class="sxs-lookup"><span data-stu-id="f4b49-178">This process is used for all tokens during the 8 hour (default token lifetime) overlap period.</span></span>  <br/> |
|<span data-ttu-id="f4b49-179">4 </span><span class="sxs-lookup"><span data-stu-id="f4b49-179">4</span></span>  <br/> |<span data-ttu-id="f4b49-180">結束： 7/22/2015 2:00:01 PM</span><span class="sxs-lookup"><span data-stu-id="f4b49-180">End: 7/22/2015 2:00:01 PM</span></span>  <br/> <span data-ttu-id="f4b49-181">舊憑證已過期，且已取得新憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-181">Old certificate has expired and the new certificate has taken over.</span></span> <span data-ttu-id="f4b49-182">舊憑證可以安全地移除，使用 Remove-CsCertificate 類型 \<certificate usage type\> 先前版本</span><span class="sxs-lookup"><span data-stu-id="f4b49-182">Old certificate can be safely removed with Remove-CsCertificate -Type \<certificate usage type\> -Previous</span></span>  <br/> |
   
<span data-ttu-id="f4b49-183">當達到有效時間時 (7/22/2015 6:00:00 AM) ，所有新的權杖都會以新的憑證發出。</span><span class="sxs-lookup"><span data-stu-id="f4b49-183">When the effective time is reached (7/22/2015 6:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="f4b49-184">驗證 Token 時，會先以新的憑證來加以驗證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-184">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="f4b49-185">若驗證失敗，就會嘗試舊的憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-185">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="f4b49-186">直到舊憑證到期時間以前，都會一直繼續嘗試新憑證並恢復使用舊憑證的程序。</span><span class="sxs-lookup"><span data-stu-id="f4b49-186">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="f4b49-187">一旦舊憑證到期 (7/22/2015 2:00:00 PM) ，權杖只會由新的憑證驗證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-187">Once the old certificate has expired (7/22/2015 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="f4b49-188">舊憑證可以使用具有-上一個參數的 Remove-CsCertificate Cmdlet 安全地移除。</span><span class="sxs-lookup"><span data-stu-id="f4b49-188">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the -Previous parameter.</span></span>

```PowerShell
Remove-CsCertificate -Type AudioVideoAuthentication -Previous
```

### <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a--roll-and--effectivedate-parameters"></a><span data-ttu-id="f4b49-189">使用 a 滾及-EffectiveDate 參數更新或更新 OAuthTokenIssuer 憑證</span><span class="sxs-lookup"><span data-stu-id="f4b49-189">To update or renew an OAuthTokenIssuer certificate with a -Roll and -EffectiveDate parameters</span></span>

1. <span data-ttu-id="f4b49-190">以 Administrators 群組成員的身分登入本機電腦。</span><span class="sxs-lookup"><span data-stu-id="f4b49-190">Log on to the local computer as a member of the Administrators group.</span></span>
    
2. <span data-ttu-id="f4b49-191">使用前端伺服器上現有憑證的可匯出私密金鑰，索取更新或新的 OAuthTokenIssuer 憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-191">Request a renewal or new OAuthTokenIssuer certificate with exportable private key for the existing certificate on the Front End Server.</span></span>
    
3. <span data-ttu-id="f4b49-192">將新的 OAuthTokenIssuer 憑證匯入至集區中的前端伺服器 (（如果您已部署) 集區）。</span><span class="sxs-lookup"><span data-stu-id="f4b49-192">Import the new OAuthTokenIssuer certificate to a Front End Server in your pool (if you have a pool deployed).</span></span> <span data-ttu-id="f4b49-193">OAuthTokenIssuer 憑證是全域複寫的，因此僅需在部署中的任何伺服器上加以更新即可。</span><span class="sxs-lookup"><span data-stu-id="f4b49-193">The OAuthTokenIssuer certificate is replicated globally and only needs to be updated and renewed at any server in your deployment.</span></span> <span data-ttu-id="f4b49-194">前端伺服器是用來做為範例。</span><span class="sxs-lookup"><span data-stu-id="f4b49-194">The Front End Server is used as an example.</span></span>
    
4. <span data-ttu-id="f4b49-195">使用 Set-CsCertificate Cmdlet 來設定匯入的憑證，並使用-擲參數搭配-EffectiveDate 參數。</span><span class="sxs-lookup"><span data-stu-id="f4b49-195">Configure the imported certificate with the Set-CsCertificate cmdlet and use the -Roll parameter with the -EffectiveDate parameter.</span></span> <span data-ttu-id="f4b49-196">生效日期應定義為目前憑證的到期時間 (14:00:00 或 2:00:00 PM) 扣除至少 24 小時。</span><span class="sxs-lookup"><span data-stu-id="f4b49-196">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus a minimum of 24 hours.</span></span> 
    
    <span data-ttu-id="f4b49-197">具有-滾及-EffectiveTime 參數的 Set-CsCertificate 命令：</span><span class="sxs-lookup"><span data-stu-id="f4b49-197">The Set-CsCertificate command with the -Roll and -EffectiveTime parameter:</span></span>
    
   ```PowerShell
   Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb
          print of new certificate> -Roll -EffectiveDate <date and time for
          certificate to become active> -identity Global 
   ```

<span data-ttu-id="f4b49-198">Set-CsCertificate 命令範例：</span><span class="sxs-lookup"><span data-stu-id="f4b49-198">An example Set-CsCertificate command:</span></span>
    
  ```PowerShell
  Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint
          "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2015
          1:00:00 PM" 
  ```

> [!IMPORTANT]
> <span data-ttu-id="f4b49-199">EffectiveDate 必須設定格式，以符合伺服器的區域及語言設定。</span><span class="sxs-lookup"><span data-stu-id="f4b49-199">The EffectiveDate must be formatted to match your server's region and language settings.</span></span> <span data-ttu-id="f4b49-200">範例是使用英文 (美國) 區域和語言設定</span><span class="sxs-lookup"><span data-stu-id="f4b49-200">The example uses the US English Region and Language settings</span></span> 
  
<span data-ttu-id="f4b49-201">當達到有效時間時 (7/21/2015 1:00:00 AM) ，所有新的權杖都會以新的憑證發出。</span><span class="sxs-lookup"><span data-stu-id="f4b49-201">When the effective time is reached (7/21/2015 1:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="f4b49-202">驗證 Token 時，會先以新的憑證來加以驗證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-202">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="f4b49-203">若驗證失敗，就會嘗試舊的憑證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-203">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="f4b49-204">直到舊憑證到期時間以前，都會一直繼續嘗試新憑證並恢復使用舊憑證的程序。</span><span class="sxs-lookup"><span data-stu-id="f4b49-204">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="f4b49-205">一旦舊憑證到期 (7/22/2015 2:00:00 PM) ，權杖只會由新的憑證驗證。</span><span class="sxs-lookup"><span data-stu-id="f4b49-205">Once the old certificate has expired (7/22/2015 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="f4b49-206">舊憑證可以使用具有-上一個參數的 Remove-CsCertificate Cmdlet 安全地移除。</span><span class="sxs-lookup"><span data-stu-id="f4b49-206">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the -Previous parameter.</span></span>
```PowerShell
Remove-CsCertificate -Type OAuthTokenIssuer -Previous 
```

## <a name="see-also"></a><span data-ttu-id="f4b49-207">另請參閱</span><span class="sxs-lookup"><span data-stu-id="f4b49-207">See also</span></span>

[<span data-ttu-id="f4b49-208">在商務用 Skype Server 中管理伺服器對伺服器驗證 (OAuth) 和夥伴應用程式</span><span class="sxs-lookup"><span data-stu-id="f4b49-208">Manage server-to-server authentication (OAuth) and partner applications in Skype for Business Server</span></span>](server-to-server-and-partner-applications.md)

[<span data-ttu-id="f4b49-209">Set-CsCertificate</span><span class="sxs-lookup"><span data-stu-id="f4b49-209">Set-CsCertificate</span></span>](https://docs.microsoft.com/powershell/module/skype/set-cscertificate?view=skype-ps)
  
[<span data-ttu-id="f4b49-210">Remove-Update-cscertificate</span><span class="sxs-lookup"><span data-stu-id="f4b49-210">Remove-CsCertificate</span></span>](https://docs.microsoft.com/powershell/module/skype/remove-cscertificate?view=skype-ps)
