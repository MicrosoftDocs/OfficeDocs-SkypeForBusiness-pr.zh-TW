---
title: 商務用 Skype 的負載平衡需求
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: conceptual
ms.prod: skype-for-business-itpro
localization_priority: Normal
ms.collection:
- IT_Skype16
- Strat_SB_Admin
ms.custom: ''
ms.assetid: 84489328-64a4-486c-9384-a3e5c8ed9c8b
description: '摘要: 在執行商務用 Skype Server 前, 請先檢查負載平衡考慮。'
ms.openlocfilehash: 2db9b7aa37f71d445feb3cfd9a09e49f44ca48f0
ms.sourcegitcommit: ab47ff88f51a96aaf8bc99a6303e114d41ca5c2f
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/20/2019
ms.locfileid: "36192968"
---
# <a name="load-balancing-requirements-for-skype-for-business"></a><span data-ttu-id="f64a6-103">商務用 Skype 的負載平衡需求</span><span class="sxs-lookup"><span data-stu-id="f64a6-103">Load balancing requirements for Skype for Business</span></span>
 
<span data-ttu-id="f64a6-104">**摘要:** 在執行商務用 Skype Server 前, 請先檢查負載平衡考慮。</span><span class="sxs-lookup"><span data-stu-id="f64a6-104">**Summary:** Review the load balancing considerations before implementing Skype for Business Server.</span></span>
  
<span data-ttu-id="f64a6-105">負載平衡在池中的伺服器之間分佈流量。</span><span class="sxs-lookup"><span data-stu-id="f64a6-105">Load balancing distributes traffic among the servers in a pool.</span></span> <span data-ttu-id="f64a6-106">如果您有前端池、中繼伺服器池或邊緣伺服器池, 您必須為這些池部署負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-106">If you have Front End pools, Mediation Server pools, or Edge Server pools, you need to deploy load balancing for these pools.</span></span>
  
<span data-ttu-id="f64a6-107">商務用 Skype 伺服器支援針對用戶端到伺服器流量的兩種負載平衡解決方案: 網域名稱系統 (DNS) 負載平衡與硬體負載平衡 (通常縮寫為 HLB)。</span><span class="sxs-lookup"><span data-stu-id="f64a6-107">Skype for Business Server supports two types of load balancing solutions for client-to-server traffic: Domain Name System (DNS) load balancing and hardware load balancing (often abbreviated as HLB).</span></span> <span data-ttu-id="f64a6-108">DNS 負載平衡提供數個優點, 包括更簡單的管理、更有效率的疑難排解, 以及將許多商務用 Skype 伺服器流量與任何可能的硬體負載平衡器問題隔離的能力。</span><span class="sxs-lookup"><span data-stu-id="f64a6-108">DNS load balancing offers several advantages including simpler administration, more efficient troubleshooting, and the ability to isolate much of your Skype for Business Server traffic from any potential hardware load balancer problems.</span></span>
  
<span data-ttu-id="f64a6-109">自己決定哪一種負載平衡方案適合您部署中的每個池, 但請記住下列限制:</span><span class="sxs-lookup"><span data-stu-id="f64a6-109">Decide for yourself which load balancing solution is appropriate for each pool in your deployment, but keep in mind the following restrictions:</span></span> 
  
- <span data-ttu-id="f64a6-110">內部 Edge 介面和外部 Edge 介面必須使用相同類型的負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-110">The internal Edge interface and external Edge interface must use the same type of load balancing.</span></span> <span data-ttu-id="f64a6-111">您無法在一個介面上使用 DNS 負載平衡, 另一種是在另一個介面上使用硬體負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-111">You cannot use DNS load balancing on one interface and hardware load balancing on the other.</span></span>
    
- <span data-ttu-id="f64a6-112">某些類型的流量需要硬體負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="f64a6-112">Some types of traffic require a hardware load balancer.</span></span> <span data-ttu-id="f64a6-113">例如, HTTP 流量需要硬體負載平衡器, 而不是 DNS 負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-113">For example, HTTP traffic requires a hardware load balancer instead of DNS load balancing.</span></span> <span data-ttu-id="f64a6-114">DNS 負載平衡無法搭配用戶端到伺服器的網路流量使用。</span><span class="sxs-lookup"><span data-stu-id="f64a6-114">DNS load balancing does not work with client-to-server web traffic.</span></span>
    
<span data-ttu-id="f64a6-115">如果您選擇要針對某個池使用 DNS 負載平衡, 但仍需要為流量 (例如 HTTP 流量) 執行硬體負載平衡器, 系統會大大簡化硬體負載平衡器的管理。</span><span class="sxs-lookup"><span data-stu-id="f64a6-115">If you choose to use DNS load balancing for a pool but still need to implement hardware load balancers for traffic such as HTTP traffic, the administration of the hardware load balancers is greatly simplified.</span></span> <span data-ttu-id="f64a6-116">例如, 設定硬體負載平衡器會比較簡單, 因為它只會管理 HTTP 和 HTTPS 流量, 而所有其他通訊協定都將由 DNS 負載平衡來管理。</span><span class="sxs-lookup"><span data-stu-id="f64a6-116">For example, configuring the hardware load balancer will be simpler as it will only manage the HTTP and HTTPS traffic, while all other protocols will be managed by DNS load balancing.</span></span> <span data-ttu-id="f64a6-117">如需詳細資訊, 請參閱[DNS 負載平衡](load-balancing.md#BKMK_DNSLoadBalancing)。</span><span class="sxs-lookup"><span data-stu-id="f64a6-117">For details, see [DNS Load Balancing](load-balancing.md#BKMK_DNSLoadBalancing).</span></span> 
  
<span data-ttu-id="f64a6-118">針對伺服器到伺服器的流量, 商務用 Skype 伺服器使用拓撲感知負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-118">For server-to-server traffic, Skype for Business Server uses topology-aware load balancing.</span></span> <span data-ttu-id="f64a6-119">伺服器會在中央管理儲存體中讀取已發佈的拓撲, 以取得拓撲中的伺服器 Fqdn, 並在伺服器之間自動散佈流量。</span><span class="sxs-lookup"><span data-stu-id="f64a6-119">Servers read the published topology in the Central Management store to obtain the FQDNs of servers in the topology, and automatically distribute the traffic among the servers.</span></span> <span data-ttu-id="f64a6-120">系統管理員不需要設定或管理這種類型的負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-120">Administrators do not need to set up or manage this type of load balancing.</span></span> 
  
<span data-ttu-id="f64a6-121">如果您使用 DNS 負載平衡, 而且您需要封鎖流量至特定電腦, 則只需從池 FQDN 中移除 IP 位址專案是不夠的。</span><span class="sxs-lookup"><span data-stu-id="f64a6-121">If you use DNS load balancing and you need to block traffic to a specific computer, it is not sufficient to just remove the IP address entries from the Pool FQDN.</span></span> <span data-ttu-id="f64a6-122">您也必須移除電腦的 DNS 專案。</span><span class="sxs-lookup"><span data-stu-id="f64a6-122">You must remove the DNS entry for the computer as well.</span></span> 
  
## <a name="hardware-load-balancer-requirements"></a><span data-ttu-id="f64a6-123">硬體負載平衡器需求</span><span class="sxs-lookup"><span data-stu-id="f64a6-123">Hardware load balancer requirements</span></span>

<span data-ttu-id="f64a6-124">針對新部署的 DNS 負載平衡進行優化的商務用 Skype 伺服器縮放的邊緣拓朴, 主要是與使用商務用 Skype Server 或 Lync Server 的其他組織聯盟。</span><span class="sxs-lookup"><span data-stu-id="f64a6-124">The Skype for Business Server scaled consolidated Edge topology is optimized for DNS load balancing for new deployments federating primarily with other organizations using Skype for Business Server or Lync Server.</span></span> <span data-ttu-id="f64a6-125">如果下列任何案例都需要高可用性, 則必須在 Edge 伺服器池中使用硬體負載平衡器, 以進行下列作業:</span><span class="sxs-lookup"><span data-stu-id="f64a6-125">If high availability is required for any of the following scenarios, a hardware load balancer must be used on Edge Server pools for the following:</span></span> 
  
- <span data-ttu-id="f64a6-126">與使用 Office 通訊伺服器 2007 R2 或 Office 通訊伺服器2007的組織同盟</span><span class="sxs-lookup"><span data-stu-id="f64a6-126">Federation with organizations using Office Communications Server 2007 R2 or Office Communications Server 2007</span></span>
    
- <span data-ttu-id="f64a6-127">在 Exchange 2010 之前使用 Exchange UM 的遠端使用者的 exchange UM 與 SP1</span><span class="sxs-lookup"><span data-stu-id="f64a6-127">Exchange UM for remote users using Exchange UM prior to Exchange 2010 with SP1</span></span>
    
- <span data-ttu-id="f64a6-128">公用 IM 使用者的連線能力</span><span class="sxs-lookup"><span data-stu-id="f64a6-128">Connectivity to public IM users</span></span>
    
> [!IMPORTANT]
> <span data-ttu-id="f64a6-129">在一個介面上使用 DNS 負載平衡, 而另一個介面上的硬體負載平衡則不受支援。</span><span class="sxs-lookup"><span data-stu-id="f64a6-129">Using DNS load balancing on one interface and hardware load balancing on the other is not supported.</span></span> <span data-ttu-id="f64a6-130">您必須針對兩種介面或 DNS 負載平衡使用硬體負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-130">You must use hardware load balancing for both interfaces or DNS load balancing for both.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="f64a6-131">如果您使用的是硬體負載平衡器, 則必須將與內部網路的連線所部署的負載平衡器設定為只進行負載平衡, 以便只對執行存取邊緣服務和 A/V 邊緣服務的伺服器進行負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-131">If you are using a hardware load balancer, the load balancer deployed for connections with the internal network must be configured to load balance only the traffic to servers running the Access Edge service and the A/V Edge service.</span></span> <span data-ttu-id="f64a6-132">它無法將流量負載平衡到內部網路會議邊緣服務或內部 XMPP Proxy 服務。</span><span class="sxs-lookup"><span data-stu-id="f64a6-132">It cannot load balance the traffic to the internal Web Conferencing Edge service or the internal XMPP Proxy service.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="f64a6-133">商務用 Skype Server 不支援直接伺服器返回 (DSR) NAT。</span><span class="sxs-lookup"><span data-stu-id="f64a6-133">The direct server return (DSR) NAT is not supported with Skype for Business Server.</span></span> 
  
<span data-ttu-id="f64a6-134">若要判斷您的硬體負載平衡器是否支援商務用 Skype Server 所需的功能, 請參閱[商務用 skype 的基礎結構](https://docs.microsoft.com/SkypeForBusiness/certification/infra-gateways)。</span><span class="sxs-lookup"><span data-stu-id="f64a6-134">To determine whether your hardware load balancer supports the necessary features required by Skype for Business Server, see [Infrastructure for Skype for Business](https://docs.microsoft.com/SkypeForBusiness/certification/infra-gateways).</span></span> 
  
### <a name="hardware-load-balancer-requirements-for-edge-servers-running-the-av-edge-service"></a><span data-ttu-id="f64a6-135">執行 A/V 邊緣服務的邊緣伺服器的硬體負載平衡器需求</span><span class="sxs-lookup"><span data-stu-id="f64a6-135">Hardware Load Balancer Requirements for Edge Servers Running the A/V Edge Service</span></span>

<span data-ttu-id="f64a6-136">以下是執行 A/V 邊緣服務的邊緣伺服器的硬體負載平衡器需求:</span><span class="sxs-lookup"><span data-stu-id="f64a6-136">Following are the hardware load balancer requirements for Edge Servers running the A/V Edge service:</span></span>
  
- <span data-ttu-id="f64a6-137">針對內部和外部埠443關閉 TCP Nagling。</span><span class="sxs-lookup"><span data-stu-id="f64a6-137">Turn off TCP nagling for both internal and external ports 443.</span></span> <span data-ttu-id="f64a6-138">Nagling 是將數個小型資料包合併成單一、較大的資料包以獲得更有效率的傳輸的程式。</span><span class="sxs-lookup"><span data-stu-id="f64a6-138">Nagling is the process of combining several small packets into a single, larger packet for more efficient transmission.</span></span>
    
- <span data-ttu-id="f64a6-139">關閉外部埠範圍 50000-59999 的 TCP Nagling。</span><span class="sxs-lookup"><span data-stu-id="f64a6-139">Turn off TCP nagling for external port range 50,000 - 59,999.</span></span> 
    
- <span data-ttu-id="f64a6-140">請勿在內部或外部防火牆上使用 NAT。</span><span class="sxs-lookup"><span data-stu-id="f64a6-140">Do not use NAT on the internal or external firewall.</span></span> 
    
- <span data-ttu-id="f64a6-141">Edge 內部介面必須在不同的網路上, 而不是 Edge 伺服器外部介面且必須停用它們之間的路由。</span><span class="sxs-lookup"><span data-stu-id="f64a6-141">The edge internal interface must be on a different network than the Edge Server external interface and routing between them must be disabled.</span></span> 
    
- <span data-ttu-id="f64a6-142">執行 A/V 邊緣服務的邊緣伺服器外部介面必須使用可公開路由的 IP 位址, 而且任何邊緣外部 IP 位址都沒有 NAT 或埠轉譯。</span><span class="sxs-lookup"><span data-stu-id="f64a6-142">The external interface of the Edge Server running the A/V Edge Service must use publicly routable IP addresses and no NAT or port translation on any of the edge external IP addresses.</span></span> 
    
- <span data-ttu-id="f64a6-143">負載平衡器不得變更用戶端的來源位址。</span><span class="sxs-lookup"><span data-stu-id="f64a6-143">The load balancer must not change the source address of the client.</span></span>
    
### <a name="other-hardware-load-balancer-requirements"></a><span data-ttu-id="f64a6-144">其他硬體負載平衡器需求</span><span class="sxs-lookup"><span data-stu-id="f64a6-144">Other Hardware Load Balancer requirements</span></span>

<span data-ttu-id="f64a6-145">在商務用 Skype Server for Web 服務中, 以 Cookie 為基礎的關聯需求大大減少。</span><span class="sxs-lookup"><span data-stu-id="f64a6-145">Cookie-based affinity requirements are greatly reduced in Skype for Business Server for Web services.</span></span> <span data-ttu-id="f64a6-146">如果您要部署商務用 Skype Server, 且不會保留任何 Lync Server 2010 前端伺服器或前端池, 則不需要以 cookie 為基礎的持久性。</span><span class="sxs-lookup"><span data-stu-id="f64a6-146">If you are deploying Skype for Business Server and will not retain any Lync Server 2010 Front End Servers or Front End pools, you do not need cookie-based persistence.</span></span> <span data-ttu-id="f64a6-147">不過, 如果您要暫時或永久保留任何 Lync Server 2010 前端伺服器或前端池, 您仍然會在針對 Lync Server 2010 部署和設定的情況下, 使用以 cookie 為基礎的持久性。</span><span class="sxs-lookup"><span data-stu-id="f64a6-147">However, if you will temporarily or permanently retain any Lync Server 2010 Front End Servers or Front End pools, you still use cookie-based persistence as it is deployed and configured for Lync Server 2010.</span></span> 
  
> [!NOTE]
> <span data-ttu-id="f64a6-148">**如果您決定使用以 cookie 為基礎的關聯, 即使您的部署不需要它**, 也不會有任何負面影響可執行此動作。</span><span class="sxs-lookup"><span data-stu-id="f64a6-148">**If you decide to use cookie-based affinity even though your deployment does not require it**, there is no negative impact to doing so.</span></span> 
  
<span data-ttu-id="f64a6-149">針對**將不會使用**cookie 的關聯的部署:</span><span class="sxs-lookup"><span data-stu-id="f64a6-149">For deployments that **will not use** cookie-based affinity:</span></span>
  
- <span data-ttu-id="f64a6-150">在埠4443的反向 proxy 發佈規則中, 將 [**轉寄主機頭**] 設定為 True。</span><span class="sxs-lookup"><span data-stu-id="f64a6-150">On the reverse proxy publishing rule for port 4443, set **Forward host header** to True.</span></span> <span data-ttu-id="f64a6-151">這可確保原始 URL 已轉寄。</span><span class="sxs-lookup"><span data-stu-id="f64a6-151">This will ensure that the original URL is forwarded.</span></span>
    
<span data-ttu-id="f64a6-152">針對**將使用**以 cookie 為基礎的關聯性的部署:</span><span class="sxs-lookup"><span data-stu-id="f64a6-152">For deployments that **will use** cookie-based affinity:</span></span>
  
- <span data-ttu-id="f64a6-153">在埠4443的反向 proxy 發佈規則中, 將 [**轉寄主機頭**] 設定為 True。</span><span class="sxs-lookup"><span data-stu-id="f64a6-153">On the reverse proxy publishing rule for port 4443, set **Forward host header** to True.</span></span> <span data-ttu-id="f64a6-154">這可確保原始 URL 已轉寄。</span><span class="sxs-lookup"><span data-stu-id="f64a6-154">This will ensure that the original URL is forwarded.</span></span>
    
- <span data-ttu-id="f64a6-155">硬體負載平衡器 cookie 不能標示為 HTTPOnly</span><span class="sxs-lookup"><span data-stu-id="f64a6-155">Hardware load balancer cookie MUST NOT be marked httpOnly</span></span>
    
- <span data-ttu-id="f64a6-156">硬體負載平衡器 cookie 不能有到期時間</span><span class="sxs-lookup"><span data-stu-id="f64a6-156">Hardware load balancer cookie MUST NOT have an expiration time</span></span>
    
- <span data-ttu-id="f64a6-157">硬體負載平衡器 cookie 必須命名為**MS-WSMAN** (這是 Web 服務預期的值, 且無法變更)</span><span class="sxs-lookup"><span data-stu-id="f64a6-157">Hardware load balancer cookie MUST be named **MS-WSMAN** (This is the value that the Web services expect, and cannot be changed)</span></span>
    
- <span data-ttu-id="f64a6-158">硬體負載平衡器 cookie 必須在每一個 HTTP 回應中設定 (無論是否已在相同的 TCP 連線中先前的 HTTP 回應都已取得 cookie)。</span><span class="sxs-lookup"><span data-stu-id="f64a6-158">Hardware load balancer cookie MUST be set in every HTTP response for which the incoming HTTP request did not have a cookie, regardless of whether a previous HTTP response on that same TCP connection had already obtained a cookie.</span></span> <span data-ttu-id="f64a6-159">如果負載平衡器針對每個 TCP 連線優化 cookie 插入, 則不一定要使用該優化</span><span class="sxs-lookup"><span data-stu-id="f64a6-159">If the load balancer optimizes cookie insert to only occur once per TCP connection, that optimization MUST NOT be used</span></span>
    
> [!NOTE]
> <span data-ttu-id="f64a6-160">典型的硬體負載平衡器設定使用來源位址關聯和20分鐘的 TCP 會話存留期, 這對 Lync Server 和 Lync 2013 用戶端來說是很好的, 因為會話狀態是透過用戶端使用量和/或應用程式互動來維護。</span><span class="sxs-lookup"><span data-stu-id="f64a6-160">Typical hardware load balancer configurations use source-address affinity and a 20 min. TCP session lifetime, which is fine for Lync Server and Lync 2013 clients because session state is maintained through client usage and/or and application interaction.</span></span> 
  
<span data-ttu-id="f64a6-161">如果您要部署行動裝置, 您的硬體負載平衡器必須能夠在 TCP 會話中的個別要求之間進行負載平衡 (事實上, 您必須能夠根據目標 IP 位址來載入個別的要求)。</span><span class="sxs-lookup"><span data-stu-id="f64a6-161">If you are deploying mobile devices, your hardware load balancer must be able to load balance individual request within a TCP session (in effect, you must be able to load balance an individual request based on the target IP address).</span></span>
  
> [!CAUTION]
> <span data-ttu-id="f64a6-162">如果您要部署行動裝置, 您的硬體負載平衡器必須能夠在 TCP 連線中針對每個要求逐一進行負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-162">If you are deploying mobile devices, your hardware load balancer must be able to individually load balance each request within a TCP connection.</span></span> <span data-ttu-id="f64a6-163">最新的 Apple iOS 行動裝置 app 需要傳輸層安全性 (TLS) 版本1.2。</span><span class="sxs-lookup"><span data-stu-id="f64a6-163">The latest Apple iOS mobile apps require Transport Layer Security (TLS) version 1.2.</span></span>  
  
> [!CAUTION]
> <span data-ttu-id="f64a6-164">如需協力廠商硬體負載平衡器的詳細資料, 請參閱[商務用 Skype 的基礎結構](https://docs.microsoft.com/SkypeForBusiness/certification/infra-gateways)。</span><span class="sxs-lookup"><span data-stu-id="f64a6-164">For details on third party hardware load balancers, see [Infrastructure for Skype for Business](https://docs.microsoft.com/SkypeForBusiness/certification/infra-gateways).</span></span>  
  
<span data-ttu-id="f64a6-165">以下是控制器和前臺端池 Web 服務的硬體負載平衡器需求:</span><span class="sxs-lookup"><span data-stu-id="f64a6-165">Following are the hardware load balancer requirements for Director and Front End pool Web Services:</span></span>
  
- <span data-ttu-id="f64a6-166">針對內部 Web 服務 Vip, 請在硬體負載平衡器上設定 Source_addr 暫留 (內部埠 80, 443)。</span><span class="sxs-lookup"><span data-stu-id="f64a6-166">For internal Web Services VIPs, set Source_addr persistence (internal port 80, 443) on the hardware load balancer.</span></span> <span data-ttu-id="f64a6-167">在商務用 Skype Server 中, Source_addr [暫留] 表示來自單一 IP 位址的多個連線總是傳送到一個伺服器, 以維持會話狀態。</span><span class="sxs-lookup"><span data-stu-id="f64a6-167">For Skype for Business Server, Source_addr persistence means that multiple connections coming from a single IP address are always sent to one server to maintain session state.</span></span>
    
- <span data-ttu-id="f64a6-168">使用1800秒的 TCP 空閒超時。</span><span class="sxs-lookup"><span data-stu-id="f64a6-168">Use TCP idle timeout of 1800 seconds.</span></span>
    
- <span data-ttu-id="f64a6-169">在反向 proxy 與下一個躍點池的硬體負載平衡器之間, 建立規則來允許 HTTPs: 埠4443上的流量, 從反向 proxy 傳送到硬體負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="f64a6-169">On the firewall between the reverse proxy and the next hop pool's hardware load balancer, create a rule to allow https: traffic on port 4443, from the reverse proxy to the hardware load balancer.</span></span> <span data-ttu-id="f64a6-170">硬體負載平衡器必須設定為在埠80、443和4443上聆聽。</span><span class="sxs-lookup"><span data-stu-id="f64a6-170">The hardware load balancer must be configured to listen on ports 80, 443, and 4443.</span></span>
    
### <a name="summary-of-hardware-load-balancer-affinity-requirements"></a><span data-ttu-id="f64a6-171">硬體負載平衡器關聯需求摘要</span><span class="sxs-lookup"><span data-stu-id="f64a6-171">Summary of Hardware Load Balancer Affinity Requirements</span></span>

|<span data-ttu-id="f64a6-172">**用戶端/使用者位置**</span><span class="sxs-lookup"><span data-stu-id="f64a6-172">**Client/user location**</span></span>|<span data-ttu-id="f64a6-173">**外部 web 服務 FQDN 關聯需求**</span><span class="sxs-lookup"><span data-stu-id="f64a6-173">**External web services FQDN affinity requirements**</span></span>|<span data-ttu-id="f64a6-174">**內部 web 服務 FQDN 關聯需求**</span><span class="sxs-lookup"><span data-stu-id="f64a6-174">**Internal web services FQDN affinity requirements**</span></span>|
|:-----|:-----|:-----|
|<span data-ttu-id="f64a6-175">Lync Web App (內部與外部使用者)</span><span class="sxs-lookup"><span data-stu-id="f64a6-175">Lync Web App (internal and external users)</span></span>  <br/> <span data-ttu-id="f64a6-176">行動裝置 (內部和外部使用者)</span><span class="sxs-lookup"><span data-stu-id="f64a6-176">Mobile device (internal and external users)</span></span>  <br/> |<span data-ttu-id="f64a6-177">沒有關聯性</span><span class="sxs-lookup"><span data-stu-id="f64a6-177">No affinity</span></span>  <br/> |<span data-ttu-id="f64a6-178">來源位址關聯</span><span class="sxs-lookup"><span data-stu-id="f64a6-178">Source address affinity</span></span>  <br/> |
|<span data-ttu-id="f64a6-179">Lync Web App (僅限外部使用者)</span><span class="sxs-lookup"><span data-stu-id="f64a6-179">Lync Web App (external users only)</span></span>  <br/> <span data-ttu-id="f64a6-180">行動裝置 (內部和外部使用者)</span><span class="sxs-lookup"><span data-stu-id="f64a6-180">Mobile device (internal and external users)</span></span>  <br/> |<span data-ttu-id="f64a6-181">沒有關聯性</span><span class="sxs-lookup"><span data-stu-id="f64a6-181">No affinity</span></span>  <br/> |<span data-ttu-id="f64a6-182">來源位址關聯</span><span class="sxs-lookup"><span data-stu-id="f64a6-182">Source address affinity</span></span>  <br/> |
|<span data-ttu-id="f64a6-183">Lync Web App (僅限內部使用者)</span><span class="sxs-lookup"><span data-stu-id="f64a6-183">Lync Web App (internal users only)</span></span>  <br/> <span data-ttu-id="f64a6-184">行動裝置 (未部署)</span><span class="sxs-lookup"><span data-stu-id="f64a6-184">Mobile device (not deployed)</span></span>  <br/> |<span data-ttu-id="f64a6-185">沒有關聯性</span><span class="sxs-lookup"><span data-stu-id="f64a6-185">No affinity</span></span>  <br/> |<span data-ttu-id="f64a6-186">來源位址關聯</span><span class="sxs-lookup"><span data-stu-id="f64a6-186">Source address affinity</span></span>  <br/> |
   
### <a name="port-monitoring-for-hardware-load-balancers"></a><span data-ttu-id="f64a6-187">硬體負載平衡器的埠監控</span><span class="sxs-lookup"><span data-stu-id="f64a6-187">Port Monitoring for Hardware Load Balancers</span></span>

<span data-ttu-id="f64a6-188">您可以在硬體負載平衡器上定義埠監視, 以判斷因硬體或通訊失敗而無法使用特定服務的時間。</span><span class="sxs-lookup"><span data-stu-id="f64a6-188">You define port monitoring on the hardware load balancers to determine when specific services are no longer available due to hardware or communications failure.</span></span> <span data-ttu-id="f64a6-189">例如, 如果前端伺服器或前端池發生故障, [前端伺服器服務 (RTCSRV)] 停止, 則 HLB 監視也應該停止在 Web 服務上接收流量。</span><span class="sxs-lookup"><span data-stu-id="f64a6-189">For example, if the Front End Server service (RTCSRV) stops because the Front End Server or Front End pool fails, the HLB monitoring should also stop receiving traffic on the Web Services.</span></span> <span data-ttu-id="f64a6-190">您可以在 HLB 上執行埠監視, 以監視下列各項:</span><span class="sxs-lookup"><span data-stu-id="f64a6-190">You implement port monitoring on the HLB to monitor the following:</span></span>
  
<span data-ttu-id="f64a6-191">**前端伺服器使用者池-HLB 內部介面**</span><span class="sxs-lookup"><span data-stu-id="f64a6-191">**Front End Server User Pool - HLB Internal Interface**</span></span>

|<span data-ttu-id="f64a6-192">**虛擬 IP/埠**</span><span class="sxs-lookup"><span data-stu-id="f64a6-192">**Virtual IP/Port**</span></span>|<span data-ttu-id="f64a6-193">**節點埠**</span><span class="sxs-lookup"><span data-stu-id="f64a6-193">**Node Port**</span></span>|<span data-ttu-id="f64a6-194">**節點電腦/監視器**</span><span class="sxs-lookup"><span data-stu-id="f64a6-194">**Node Machine/Monitor**</span></span>|<span data-ttu-id="f64a6-195">**持久性設定檔**</span><span class="sxs-lookup"><span data-stu-id="f64a6-195">**Persistence Profile**</span></span>|<span data-ttu-id="f64a6-196">**筆記**</span><span class="sxs-lookup"><span data-stu-id="f64a6-196">**Notes**</span></span>|
|:-----|:-----|:-----|:-----|:-----|
|<span data-ttu-id="f64a6-197">\<\>網站 int_mco_443_vs</span><span class="sxs-lookup"><span data-stu-id="f64a6-197">\<pool\>web-int_mco_443_vs</span></span>  <br/> <span data-ttu-id="f64a6-198">443</span><span class="sxs-lookup"><span data-stu-id="f64a6-198">443</span></span>  <br/> |<span data-ttu-id="f64a6-199">443</span><span class="sxs-lookup"><span data-stu-id="f64a6-199">443</span></span>  <br/> |<span data-ttu-id="f64a6-200">前端</span><span class="sxs-lookup"><span data-stu-id="f64a6-200">Front End</span></span>  <br/> <span data-ttu-id="f64a6-201">5061</span><span class="sxs-lookup"><span data-stu-id="f64a6-201">5061</span></span>  <br/> |<span data-ttu-id="f64a6-202">從源</span><span class="sxs-lookup"><span data-stu-id="f64a6-202">Source</span></span>  <br/> |<span data-ttu-id="f64a6-203">IP-HTTPS</span><span class="sxs-lookup"><span data-stu-id="f64a6-203">HTTPS</span></span>  <br/> |
|<span data-ttu-id="f64a6-204">\<\>網站 int_mco_80_vs</span><span class="sxs-lookup"><span data-stu-id="f64a6-204">\<pool\>web-int_mco_80_vs</span></span>  <br/> <span data-ttu-id="f64a6-205">80</span><span class="sxs-lookup"><span data-stu-id="f64a6-205">80</span></span>  <br/> |<span data-ttu-id="f64a6-206">80</span><span class="sxs-lookup"><span data-stu-id="f64a6-206">80</span></span>  <br/> |<span data-ttu-id="f64a6-207">前端</span><span class="sxs-lookup"><span data-stu-id="f64a6-207">Front End</span></span>  <br/> <span data-ttu-id="f64a6-208">5061</span><span class="sxs-lookup"><span data-stu-id="f64a6-208">5061</span></span>  <br/> |<span data-ttu-id="f64a6-209">從源</span><span class="sxs-lookup"><span data-stu-id="f64a6-209">Source</span></span>  <br/> |<span data-ttu-id="f64a6-210">HTTP</span><span class="sxs-lookup"><span data-stu-id="f64a6-210">HTTP</span></span>  <br/> |
   
<span data-ttu-id="f64a6-211">**前端伺服器使用者池-HLB 外部介面**</span><span class="sxs-lookup"><span data-stu-id="f64a6-211">**Front End Server User Pool - HLB External Interface**</span></span>

|<span data-ttu-id="f64a6-212">**虛擬 IP/埠**</span><span class="sxs-lookup"><span data-stu-id="f64a6-212">**Virtual IP/Port**</span></span>|<span data-ttu-id="f64a6-213">**節點埠**</span><span class="sxs-lookup"><span data-stu-id="f64a6-213">**Node Port**</span></span>|<span data-ttu-id="f64a6-214">**節點電腦/監視器**</span><span class="sxs-lookup"><span data-stu-id="f64a6-214">**Node Machine/Monitor**</span></span>|<span data-ttu-id="f64a6-215">**持久性設定檔**</span><span class="sxs-lookup"><span data-stu-id="f64a6-215">**Persistence Profile**</span></span>|<span data-ttu-id="f64a6-216">**筆記**</span><span class="sxs-lookup"><span data-stu-id="f64a6-216">**Notes**</span></span>|
|:-----|:-----|:-----|:-----|:-----|
|<span data-ttu-id="f64a6-217">\<pool\>web_mco_443_vs</span><span class="sxs-lookup"><span data-stu-id="f64a6-217">\<pool\>web_mco_443_vs</span></span>  <br/> <span data-ttu-id="f64a6-218">443</span><span class="sxs-lookup"><span data-stu-id="f64a6-218">443</span></span>  <br/> |<span data-ttu-id="f64a6-219">4443</span><span class="sxs-lookup"><span data-stu-id="f64a6-219">4443</span></span>  <br/> |<span data-ttu-id="f64a6-220">前端</span><span class="sxs-lookup"><span data-stu-id="f64a6-220">Front End</span></span>  <br/> <span data-ttu-id="f64a6-221">5061</span><span class="sxs-lookup"><span data-stu-id="f64a6-221">5061</span></span>  <br/> |<span data-ttu-id="f64a6-222">無</span><span class="sxs-lookup"><span data-stu-id="f64a6-222">None</span></span>  <br/> |<span data-ttu-id="f64a6-223">IP-HTTPS</span><span class="sxs-lookup"><span data-stu-id="f64a6-223">HTTPS</span></span>  <br/> |
|<span data-ttu-id="f64a6-224">\<pool\>web_mco_80_vs</span><span class="sxs-lookup"><span data-stu-id="f64a6-224">\<pool\>web_mco_80_vs</span></span>  <br/> <span data-ttu-id="f64a6-225">80</span><span class="sxs-lookup"><span data-stu-id="f64a6-225">80</span></span>  <br/> |<span data-ttu-id="f64a6-226">8080</span><span class="sxs-lookup"><span data-stu-id="f64a6-226">8080</span></span>  <br/> |<span data-ttu-id="f64a6-227">前端</span><span class="sxs-lookup"><span data-stu-id="f64a6-227">Front End</span></span>  <br/> <span data-ttu-id="f64a6-228">5061</span><span class="sxs-lookup"><span data-stu-id="f64a6-228">5061</span></span>  <br/> |<span data-ttu-id="f64a6-229">無</span><span class="sxs-lookup"><span data-stu-id="f64a6-229">None</span></span>  <br/> |<span data-ttu-id="f64a6-230">HTTP</span><span class="sxs-lookup"><span data-stu-id="f64a6-230">HTTP</span></span>  <br/> |
   
## <a name="dns-load-balancing"></a><span data-ttu-id="f64a6-231">DNS 負載平衡</span><span class="sxs-lookup"><span data-stu-id="f64a6-231">DNS Load Balancing</span></span>
<span data-ttu-id="f64a6-232"><a name="BKMK_DNSLoadBalancing"> </a></span><span class="sxs-lookup"><span data-stu-id="f64a6-232"></span></span>

<span data-ttu-id="f64a6-233">商務用 Skype 伺服器可啟用 DNS 負載平衡, 這是可大大減少網路上負載平衡之管理負荷的軟體解決方案。</span><span class="sxs-lookup"><span data-stu-id="f64a6-233">Skype for Business Server enables DNS load balancing, a software solution that can greatly reduce the administration overhead for load balancing on your network.</span></span> <span data-ttu-id="f64a6-234">DNS 負載平衡會平衡商務用 Skype 伺服器 (例如 SIP 流量及媒體流量) 獨有的網路流量。</span><span class="sxs-lookup"><span data-stu-id="f64a6-234">DNS load balancing balances the network traffic that is unique to Skype for Business Server, such as SIP traffic and media traffic.</span></span>
  
<span data-ttu-id="f64a6-235">如果您部署 DNS 負載平衡, 貴組織的硬體負載平衡器的系統管理開銷將會最小化。</span><span class="sxs-lookup"><span data-stu-id="f64a6-235">If you deploy DNS load balancing, your organization's administration overhead for hardware load balancers will be minimized.</span></span> <span data-ttu-id="f64a6-236">此外, 對於與 SIP 流量的負載平衡程式配置錯誤相關的問題, 複雜的疑難排解將會消失。</span><span class="sxs-lookup"><span data-stu-id="f64a6-236">Additionally, complex troubleshooting of problems related to misconfiguration of load balancers for SIP traffic will be eliminated.</span></span> <span data-ttu-id="f64a6-237">您也可以避免伺服器連線, 以便讓伺服器離線。</span><span class="sxs-lookup"><span data-stu-id="f64a6-237">You can also prevent server connections so that you can take servers offline.</span></span> <span data-ttu-id="f64a6-238">DNS 負載平衡也可確保硬體負載平衡器問題不會影響 SIP 流量的元素, 例如基本呼叫路由。</span><span class="sxs-lookup"><span data-stu-id="f64a6-238">DNS load balancing also ensures that hardware load balancer problems do not affect elements of SIP traffic such as basic call routing.</span></span>

<span data-ttu-id="f64a6-239">下圖顯示包括內部和外部 DNS 負載平衡的範例:</span><span class="sxs-lookup"><span data-stu-id="f64a6-239">The following diagram shows an example that includes both internal and external DNS load balancing:</span></span> 
  
<span data-ttu-id="f64a6-240">**使用公用 IPv4 位址的邊緣網狀圖**</span><span class="sxs-lookup"><span data-stu-id="f64a6-240">**Edge network diagram using Public IPv4 addresses**</span></span>

![DNS network 圖表範例](../../media/2cc9546e-5560-4d95-8fe4-65a792a0e9c3.png)
  
<span data-ttu-id="f64a6-242">如果您使用 DNS 負載平衡, 您可能也可以購買成本較低的硬體負載平衡器, 而不是在所有類型的流量中使用硬體負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="f64a6-242">If you use DNS load balancing, you may also be able to purchase lower-cost hardware load balancers than if you used the hardware load balancers for all types of traffic.</span></span> <span data-ttu-id="f64a6-243">您應該使用已透過互通性驗證測試與商務用 Skype 伺服器的負載平衡器。</span><span class="sxs-lookup"><span data-stu-id="f64a6-243">You should use load balancers that have passed interoperability qualification testing with Skype for Business Server.</span></span> <span data-ttu-id="f64a6-244">如需有關負載平衡程式互通性測試的詳細資料, 請參閱[Lync Server 2010 負載平衡器合作夥伴](https://go.microsoft.com/fwlink/p/?linkId=202452)。</span><span class="sxs-lookup"><span data-stu-id="f64a6-244">For details about load balancer interoperability testing, see [Lync Server 2010 Load Balancer Partners](https://go.microsoft.com/fwlink/p/?linkId=202452).</span></span> <span data-ttu-id="f64a6-245">此內容適用于商務用 Skype 伺服器。</span><span class="sxs-lookup"><span data-stu-id="f64a6-245">The content there applies to Skype for Business Server.</span></span>
  
<span data-ttu-id="f64a6-246">前端池、邊緣伺服器池、控制器池和獨立的中繼伺服器池都支援 DNS 負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-246">DNS load balancing is supported for Front End pools, Edge Server pools, Director pools, and stand-alone Mediation Server pools.</span></span>
  
<span data-ttu-id="f64a6-247">DNS 負載平衡通常是在應用程式層級實現。</span><span class="sxs-lookup"><span data-stu-id="f64a6-247">DNS load balancing is typically implemented at the application level.</span></span> <span data-ttu-id="f64a6-248">應用程式 (例如, 執行商務用 Skype 的用戶端) 會嘗試連線到池中從 DNS A 和 AAAA 傳回的其中一個 IP 位址 (如果使用的是 IPv6 定址) 記錄查詢, 以取得池的完整功能變數名稱 (FQDN) 來連線至池中的伺服器。</span><span class="sxs-lookup"><span data-stu-id="f64a6-248">The application (for example, a client running Skype for Business), tries to connect to a server in a pool by connecting to one of the IP addresses returned from the DNS A and AAAA (if IPv6 addressing is used) record query for the pool fully qualified domain name (FQDN).</span></span> 
  
<span data-ttu-id="f64a6-249">例如, 如果在名為 pool01.contoso.com 的池中有三個前端伺服器, 則會發生下列情況:</span><span class="sxs-lookup"><span data-stu-id="f64a6-249">For example, if there are three front end servers in a pool named pool01.contoso.com, the following will happen:</span></span>
  
- <span data-ttu-id="f64a6-250">執行商務用 Skype 查詢 pool01.contoso.com 的用戶端。</span><span class="sxs-lookup"><span data-stu-id="f64a6-250">Clients running Skype for Business query DNS for pool01.contoso.com.</span></span> <span data-ttu-id="f64a6-251">查詢會傳回三個 IP 位址, 並以下列方式將它們加以緩存 (不一定依順序):</span><span class="sxs-lookup"><span data-stu-id="f64a6-251">The query returns three IP addresses and caches them as follows (not necessarily in this order):</span></span>
    
    <span data-ttu-id="f64a6-252">pool01.contoso.com 192.168.10.90</span><span class="sxs-lookup"><span data-stu-id="f64a6-252">pool01.contoso.com 192.168.10.90</span></span>
    
    <span data-ttu-id="f64a6-253">pool01.contoso.com 192.168.10.91</span><span class="sxs-lookup"><span data-stu-id="f64a6-253">pool01.contoso.com 192.168.10.91</span></span>
    
    <span data-ttu-id="f64a6-254">pool01.contoso.com 192.168.10.92</span><span class="sxs-lookup"><span data-stu-id="f64a6-254">pool01.contoso.com 192.168.10.92</span></span>
    
- <span data-ttu-id="f64a6-255">用戶端會嘗試建立與其中一個 IP 位址的傳輸控制通訊協定 (TCP) 連線。</span><span class="sxs-lookup"><span data-stu-id="f64a6-255">The client attempts to establish a Transmission Control Protocol (TCP) connection to one of the IP addresses.</span></span> <span data-ttu-id="f64a6-256">如果失敗, 用戶端會嘗試在快取中的下一個 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="f64a6-256">If that fails, the client tries the next IP address in the cache.</span></span>
    
- <span data-ttu-id="f64a6-257">如果 TCP 連線成功, 用戶端會協商 TLS, 連線到 pool01.contoso.com 上的主要註冊機構。</span><span class="sxs-lookup"><span data-stu-id="f64a6-257">If the TCP connection succeeds, the client negotiates TLS to connect to the primary registrar on pool01.contoso.com.</span></span>
    
- <span data-ttu-id="f64a6-258">如果用戶端在未成功連線的情況下嘗試所有快取的專案, 系統會通知使用者目前沒有任何執行商務用 Skype 伺服器的伺服器可供使用。</span><span class="sxs-lookup"><span data-stu-id="f64a6-258">If the client tries all cached entries without a successful connection, the user is notified that no servers running Skype for Business Server are available at the moment.</span></span>
    
> [!NOTE]
> <span data-ttu-id="f64a6-259">以 dns 為基礎的負載平衡不同于 DNS 迴圈 (DNS RR), 主要是依靠 DNS 來提供負載平衡, 以提供與池中伺服器相對應的 IP 位址的不同順序。</span><span class="sxs-lookup"><span data-stu-id="f64a6-259">DNS-based load balancing is different from DNS round robin (DNS RR) which typically refers to load balancing by relying on DNS to provide a different order of IP addresses corresponding to the servers in a pool.</span></span> <span data-ttu-id="f64a6-260">通常 DNS RR 只會啟用負載分配, 但不會啟用容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="f64a6-260">Typically DNS RR only enables load distribution, but does not enable failover.</span></span> <span data-ttu-id="f64a6-261">例如, 如果連線到 DNS A 和 AAAA 傳回的一個 IP 位址 (如果您使用的是 IPv6 定址) 查詢失敗, 連線就會失敗。</span><span class="sxs-lookup"><span data-stu-id="f64a6-261">For example, if the connection to the one IP address returned by the DNS A and AAAA (if you are using IPv6 addressing) query fails, the connection fails.</span></span> <span data-ttu-id="f64a6-262">因此, DNS 迴圈方式本身的可靠性低於 DNS 的負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-262">Therefore, DNS round robin by itself is less reliable than DNS-based load balancing.</span></span> <span data-ttu-id="f64a6-263">您可以將 DNS 迴圈與 DNS 負載平衡搭配使用。</span><span class="sxs-lookup"><span data-stu-id="f64a6-263">You can use DNS round robin in conjunction with DNS load balancing.</span></span> 
  
<span data-ttu-id="f64a6-264">DNS 負載平衡用於下列用途:</span><span class="sxs-lookup"><span data-stu-id="f64a6-264">DNS load balancing is used for the following:</span></span>
  
- <span data-ttu-id="f64a6-265">將伺服器間 SIP 負載平衡到邊緣伺服器</span><span class="sxs-lookup"><span data-stu-id="f64a6-265">Load balancing server-to-server SIP to the Edge Servers</span></span>
    
- <span data-ttu-id="f64a6-266">[負載平衡] 應用程式服務 (UCAS) 應用程式 (例如會議自動語音應答、回應群組及通話駐留)</span><span class="sxs-lookup"><span data-stu-id="f64a6-266">Load balancing Unified Communications Application Services (UCAS) applications such as Conferencing Auto Attendant, Response Group, and Call Park</span></span>
    
- <span data-ttu-id="f64a6-267">防止新連線至 UCAS 的應用程式 (也稱為 "排出")</span><span class="sxs-lookup"><span data-stu-id="f64a6-267">Preventing new connections to UCAS applications (also known as "draining")</span></span>
    
- <span data-ttu-id="f64a6-268">負載平衡用戶端與邊緣伺服器之間的所有用戶端與伺服器流量</span><span class="sxs-lookup"><span data-stu-id="f64a6-268">Load balancing all client-to-server traffic between clients and Edge Servers</span></span>
    
<span data-ttu-id="f64a6-269">DNS 負載平衡無法用於下列專案:</span><span class="sxs-lookup"><span data-stu-id="f64a6-269">DNS load balancing cannot be used for the following:</span></span>
  
- <span data-ttu-id="f64a6-270">從用戶端到伺服器的 web 流量到控制器或前端伺服器</span><span class="sxs-lookup"><span data-stu-id="f64a6-270">Client-to-server web traffic to Director or Front End Servers</span></span>
    
<span data-ttu-id="f64a6-271">DNS 負載平衡與同盟流量:</span><span class="sxs-lookup"><span data-stu-id="f64a6-271">DNS load balancing and federated traffic:</span></span>
  
<span data-ttu-id="f64a6-272">如果 DNS SRV 查詢傳回多個 DNS 記錄, 存取邊緣服務將會使用最小的數值優先順序和最高的數位權重來挑選 DNS SRV 記錄。</span><span class="sxs-lookup"><span data-stu-id="f64a6-272">If multiple DNS records are returned by a DNS SRV query, the Access Edge service always picks the DNS SRV record with the lowest numeric priority and highest numeric weight.</span></span> <span data-ttu-id="f64a6-273">網際網路工程工作強制檔「用於指定服務位置的 DNS RR (DNS SRV)」 [RFC 2782, DNS SRV RR](https://www.ietf.org/rfc/rfc2782.txt)會指定是否已定義多個 DNS SRV 記錄、首先使用優先順序, 然後再使用 [粗細]。</span><span class="sxs-lookup"><span data-stu-id="f64a6-273">The Internet Engineering Task Force document "A DNS RR for specifying the location of services (DNS SRV)" [RFC 2782, DNS SRV RR](https://www.ietf.org/rfc/rfc2782.txt) specifies that if there are multiple DNS SRV records defined, priority is first used, then weight.</span></span> <span data-ttu-id="f64a6-274">例如, DNS SRV 記錄 A 的粗細為 20, 且優先順序為 40, 而 DNS SRV 記錄 B 的權重為10且優先順序為50。</span><span class="sxs-lookup"><span data-stu-id="f64a6-274">For example DNS SRV record A has a weight of 20 and a priority of 40 and DNS SRV record B has a weight of 10 and priority of 50.</span></span> <span data-ttu-id="f64a6-275">將會選取具有優先順序40的 DNS SRV 記錄 A。</span><span class="sxs-lookup"><span data-stu-id="f64a6-275">DNS SRV record A with priority 40 will be selected.</span></span> <span data-ttu-id="f64a6-276">下列規則適用于 DNS SRV 記錄選擇:</span><span class="sxs-lookup"><span data-stu-id="f64a6-276">The following rules apply to DNS SRV record selection:</span></span>
  
- <span data-ttu-id="f64a6-277">首先考慮優先順序。</span><span class="sxs-lookup"><span data-stu-id="f64a6-277">Priority is considered first.</span></span> <span data-ttu-id="f64a6-278">用戶端必須嘗試與 DNS SRV 記錄所定義的目標主機取得其所能達到的最低優先順序。</span><span class="sxs-lookup"><span data-stu-id="f64a6-278">A client MUST attempt to contact the target host defined by the DNS SRV record with the lowest numbered priority it can reach.</span></span> <span data-ttu-id="f64a6-279">必須按照權欄位所定義的順序來嘗試使用相同優先順序的目標。</span><span class="sxs-lookup"><span data-stu-id="f64a6-279">Targets with the same priority SHOULD be tried in an order defined by the weight field.</span></span>
    
- <span data-ttu-id="f64a6-280">[體重] 欄位指定具有相同優先順序之專案的相對權重。</span><span class="sxs-lookup"><span data-stu-id="f64a6-280">The weight field specifies a relative weight for entries with the same priority.</span></span> <span data-ttu-id="f64a6-281">應將較大的粗細指定成按比例較高的選取幾率。</span><span class="sxs-lookup"><span data-stu-id="f64a6-281">Larger weights SHOULD be given a proportionately higher probability of being selected.</span></span> <span data-ttu-id="f64a6-282">如果沒有任何伺服器可供您選擇, DNS 管理員就應該使用權重0。</span><span class="sxs-lookup"><span data-stu-id="f64a6-282">DNS administrators SHOULD use Weight 0 when there isn't any server selection to do.</span></span> <span data-ttu-id="f64a6-283">如果記錄中包含的權重大於 0, 則權重為0的記錄應該有很小的選取機會。</span><span class="sxs-lookup"><span data-stu-id="f64a6-283">In the presence of records containing weights greater than 0, records with weight 0 should have a very small chance of being selected.</span></span>
    
<span data-ttu-id="f64a6-284">如果傳回多個具有相同優先順序和寬度的 DNS SRV 記錄, 則 Access Edge 服務會選取首先從 DNS 伺服器接收的 SRV 記錄。</span><span class="sxs-lookup"><span data-stu-id="f64a6-284">If multiple DNS SRV records with equal priority and weight are returned, the Access Edge service will select the SRV record that was received first from the DNS server.</span></span>
  
### <a name="dns-load-balancing-on-front-end-pools-and-director-pools"></a><span data-ttu-id="f64a6-285">前端池與控制器池上的 DNS 負載平衡</span><span class="sxs-lookup"><span data-stu-id="f64a6-285">DNS Load Balancing on Front End Pools and Director Pools</span></span>

<span data-ttu-id="f64a6-286">您可以針對前端池和控制器池上的 SIP 流量使用 DNS 負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-286">You can use DNS load balancing for the SIP traffic on Front End pools and Director pools.</span></span> <span data-ttu-id="f64a6-287">在部署 DNS 負載平衡的情況下, 您仍然需要同時針對這些池使用硬體負載平衡器, 但僅適用于用戶端到伺服器的 HTTPS 流量。</span><span class="sxs-lookup"><span data-stu-id="f64a6-287">With DNS load balancing deployed, you still need to also use hardware load balancers for these pools, but only for client-to-server HTTPS traffic.</span></span> <span data-ttu-id="f64a6-288">硬體負載平衡器用於來自埠443和80的用戶端的 HTTPS 流量。</span><span class="sxs-lookup"><span data-stu-id="f64a6-288">The hardware load balancer is used for HTTPS traffic from clients over ports 443 and 80.</span></span> 
  
<span data-ttu-id="f64a6-289">雖然您仍需要這些池的硬體負載平衡器, 但它們的設定和管理主要是針對 HTTPS 流量 (硬體負載平衡器的系統管理員習慣)。</span><span class="sxs-lookup"><span data-stu-id="f64a6-289">Although you still need hardware load balancers for these pools, their setup and administration will be primarily for HTTPS traffic, which the administrators of hardware load balancers are accustomed to.</span></span>
  
#### <a name="dns-load-balancing-and-supporting-older-clients-and-servers"></a><span data-ttu-id="f64a6-290">DNS 負載平衡及支援舊版用戶端和伺服器</span><span class="sxs-lookup"><span data-stu-id="f64a6-290">DNS Load Balancing and Supporting Older Clients and Servers</span></span>

<span data-ttu-id="f64a6-291">DNS 負載平衡只支援針對執行商務用 Skype Server 或 Lync Server 2010 的伺服器, 以及 Lync 2013 和商務用 Skype 用戶端的自動容錯移轉。</span><span class="sxs-lookup"><span data-stu-id="f64a6-291">DNS load balancing supports automatic failover only for servers running Skype for Business Server or Lync Server 2010, and for Lync 2013 and Skype for Business clients.</span></span> <span data-ttu-id="f64a6-292">較舊版本的用戶端和 Office 通訊伺服器仍可連線到執行 DNS 負載平衡的池, 但如果它們無法連線到 DNS 負載平衡所參照的第一個伺服器, 則它們無法容錯移轉至池中的另一台伺服器.</span><span class="sxs-lookup"><span data-stu-id="f64a6-292">Earlier versions of clients and Office Communications Server can still connect to pools running DNS load balancing, but if they cannot make a connection to the first server that DNS load balancing refers them to, they are unable to fail over to another server in the pool.</span></span> 
  
<span data-ttu-id="f64a6-293">此外, 如果您使用的是 Exchange UM, 您必須至少使用 Exchange 2010 SP1, 才能取得商務用 Skype Server DNS 負載平衡支援。</span><span class="sxs-lookup"><span data-stu-id="f64a6-293">Additionally, if you are using Exchange UM, you must use a minimum of Exchange 2010 SP1 to get support for Skype for Business Server DNS load balancing.</span></span> <span data-ttu-id="f64a6-294">如果您使用的是舊版 Exchange, 您的使用者將沒有這些 Exchange UM 案例的容錯移轉功能:</span><span class="sxs-lookup"><span data-stu-id="f64a6-294">If you use an earlier version of Exchange, your users will not have failover capabilities for these Exchange UM scenarios:</span></span>
  
- <span data-ttu-id="f64a6-295">在電話上播放企業語音信箱</span><span class="sxs-lookup"><span data-stu-id="f64a6-295">Playing their Enterprise voicemail on their phone</span></span>
    
- <span data-ttu-id="f64a6-296">轉移來自 Exchange UM 自動語音應答的呼叫</span><span class="sxs-lookup"><span data-stu-id="f64a6-296">Transferring calls from an Exchange UM Auto Attendant</span></span>
    
<span data-ttu-id="f64a6-297">所有其他 Exchange UM 案例都會正常運作。</span><span class="sxs-lookup"><span data-stu-id="f64a6-297">All other Exchange UM scenarios will work properly.</span></span>
  
#### <a name="deploying-dns-load-balancing-on-front-end-pools-and-director-pools"></a><span data-ttu-id="f64a6-298">在前端池和控制器池上部署 DNS 負載平衡</span><span class="sxs-lookup"><span data-stu-id="f64a6-298">Deploying DNS Load Balancing on Front End Pools and Director Pools</span></span>
<span data-ttu-id="f64a6-299"><a name="BK_FE_Dir"> </a></span><span class="sxs-lookup"><span data-stu-id="f64a6-299"></span></span>

<span data-ttu-id="f64a6-300">在前端池和控制器池上部署 DNS 負載平衡, 您需要執行幾個額外步驟, 使用 Fqdn 和 DNS 記錄。</span><span class="sxs-lookup"><span data-stu-id="f64a6-300">Deploying DNS load balancing on Front End pools and Director pools requires you to perform a couple of extra steps with FQDNs and DNS records.</span></span>
  
- <span data-ttu-id="f64a6-301">使用 DNS 負載平衡的池必須有兩個 Fqdn: 由 DNS 負載平衡所使用的一般池 FQDN (例如 pool01.contoso.com), 並解析成池中伺服器的實際 Ip, 以及該池 Web 服務的另一個 FQDN (例如web01.contoso.com), 可解析為池的虛擬 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="f64a6-301">A pool that uses DNS load balancing must have two FQDNs: the regular pool FQDN that is used by DNS load balancing (such as pool01.contoso.com), and resolves to the physical IPs of the servers in the pool, and another FQDN for the pool's Web services (such as web01.contoso.com), which resolves to virtual IP address of the pool.</span></span> 
    
    <span data-ttu-id="f64a6-302">在拓撲建立器中, 如果您想要為池的 Web 服務部署 DNS 負載平衡, 您必須選取 [覆**寫內部 Web 服務池 FQDN** ] 核取方塊, 然後在 [**指定 Web 服務 url] 中輸入 FQDN。[此池**] 頁面。</span><span class="sxs-lookup"><span data-stu-id="f64a6-302">In Topology Builder, if you want to deploy DNS load balancing for a pool, to create this extra FQDN for the pool's Web services you must select the **Override internal Web Services pool FQDN** check box and type the FQDN, in the **Specify the Web Services URLs for this Pool** page.</span></span>
    
- <span data-ttu-id="f64a6-303">若要支援 DNS 負載平衡所使用的 FQDN, 您必須提供 DNS, 以將池 FQDN (例如 pool01.contoso.com) 解析為池中所有伺服器的 IP 位址 (例如, 192.168.1.1、192.168.1.2 等等)。</span><span class="sxs-lookup"><span data-stu-id="f64a6-303">To support the FQDN used by DNS load balancing, you must provision DNS to resolve the pool FQDN (such as pool01.contoso.com) to the IP addresses of all the servers in the pool (for example, 192.168.1.1, 192.168.1.2, and so on).</span></span> <span data-ttu-id="f64a6-304">您應該只包含目前已部署之伺服器的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="f64a6-304">You should include only the IP addresses of servers that are currently deployed.</span></span>
    
    > [!CAUTION]
    > <span data-ttu-id="f64a6-305">如果您有多個前端池或前端伺服器, 外部 Web 服務 FQDN 必須是唯一的。</span><span class="sxs-lookup"><span data-stu-id="f64a6-305">If you have more than one Front End pool or Front End Server the external Web services FQDN must be unique.</span></span> <span data-ttu-id="f64a6-306">例如, 如果您將前端伺服器的外部 Web 服務 FQDN 定義為**pool01.contoso.com**, 則無法將**pool01.contoso.com**用於另一個前端池或前端伺服器。</span><span class="sxs-lookup"><span data-stu-id="f64a6-306">For example, if you define the external Web services FQDN of a Front End Server as **pool01.contoso.com**, you cannot use **pool01.contoso.com** for another Front End pool or Front End Server.</span></span> <span data-ttu-id="f64a6-307">如果您也要部署控制器, 則為任何主管或主管池定義的外部 Web 服務 FQDN, 都必須是與任何其他控制器或主管池以及任何前端池或前端伺服器的唯一名稱。</span><span class="sxs-lookup"><span data-stu-id="f64a6-307">If you are also deploying Directors, the external Web services FQDN defined for any Director or Director pool must be unique from any other Director or Director pool as well as any Front End pool or Front End Server.</span></span> <span data-ttu-id="f64a6-308">如果決定使用自行定義的 FQDN 來覆寫內部 web 服務, 則每個 FQDN 都必須與任何其他的前端池、控制器或主管池是唯一的。</span><span class="sxs-lookup"><span data-stu-id="f64a6-308">If decide to override the Internal web services with a self-defined FQDN, each FQDN must be unique from any other Front End pool, Director or a Director pool.</span></span>
  
### <a name="dns-load-balancing-on-edge-server-pools"></a><span data-ttu-id="f64a6-309">Edge 伺服器池中的 DNS 負載平衡</span><span class="sxs-lookup"><span data-stu-id="f64a6-309">DNS Load Balancing on Edge Server Pools</span></span>
<span data-ttu-id="f64a6-310"><a name="BK_Edge"> </a></span><span class="sxs-lookup"><span data-stu-id="f64a6-310"></span></span>

<span data-ttu-id="f64a6-311">您可以在 Edge 伺服器池中部署 DNS 負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-311">You can deploy DNS load balancing on Edge Server pools.</span></span> <span data-ttu-id="f64a6-312">如果您這樣做, 您必須知道一些考慮。</span><span class="sxs-lookup"><span data-stu-id="f64a6-312">If you do, you must be aware of some considerations.</span></span>
  
<span data-ttu-id="f64a6-313">在邊緣伺服器上使用 DNS 負載平衡, 會造成下列案例中的容錯移轉能力損失:</span><span class="sxs-lookup"><span data-stu-id="f64a6-313">Using DNS load balancing on your Edge Servers causes a loss of failover ability in the following scenarios:</span></span>
  
- <span data-ttu-id="f64a6-314">與執行 Lync Server 2010 之前發行之商務用 Skype Server 版本之組織的同盟。</span><span class="sxs-lookup"><span data-stu-id="f64a6-314">Federation with organizations that are running versions of Skype for Business Server released prior to Lync Server 2010.</span></span>
    
- <span data-ttu-id="f64a6-315">除了 XMPP 的提供者和伺服器 (例如 Google 交談) 之外, 您還可以使用公用立即訊息 (IM) 服務 AOL 和 Yahoo! 等的立即訊息交換, 以及目前唯一支援的 XMPP 合作夥伴。</span><span class="sxs-lookup"><span data-stu-id="f64a6-315">Instant message exchange with users of public instant messaging (IM) services AOL and Yahoo!, in addition to XMPP-based providers and servers, such as Google Talk, currently the only supported XMPP partner.</span></span>
    
<span data-ttu-id="f64a6-316">只要池中的所有邊緣伺服器都已啟動並執行, 這些案例就能正常運作, 但如果沒有一個 Edge 伺服器無法使用, 傳送給它的這些案例的任何要求都會失敗, 而不是路由到另一個 Edge 伺服器。</span><span class="sxs-lookup"><span data-stu-id="f64a6-316">These scenarios will work as long as all Edge Servers in the pool are up and running, but if one Edge Server is unavailable, any requests for these scenarios that are sent to it will fail, instead of routing to another Edge Server.</span></span>
  
 <span data-ttu-id="f64a6-317">如果您使用的是 Exchange UM, 您必須使用 Exchange 2013 的最低限度, 才能在 Edge 上取得商務用 Skype Server DNS 負載平衡支援。</span><span class="sxs-lookup"><span data-stu-id="f64a6-317">If you are using Exchange UM, you must use a minimum of Exchange 2013 to get support for Skype for Business Server DNS load balancing on Edge.</span></span> <span data-ttu-id="f64a6-318">如果您使用的是舊版 Exchange, 您的遠端使用者將沒有這些 Exchange UM 案例的容錯移轉功能:</span><span class="sxs-lookup"><span data-stu-id="f64a6-318">If you use an earlier version of Exchange, your remote users will not have failover capabilities for these Exchange UM scenarios:</span></span>
  
- <span data-ttu-id="f64a6-319">在電話上播放企業語音信箱</span><span class="sxs-lookup"><span data-stu-id="f64a6-319">Playing their Enterprise voicemail on their phone</span></span>
    
- <span data-ttu-id="f64a6-320">轉移來自 Exchange UM 自動語音應答的呼叫</span><span class="sxs-lookup"><span data-stu-id="f64a6-320">Transferring calls from an Exchange UM Auto Attendant</span></span>
    
<span data-ttu-id="f64a6-321">所有其他 Exchange UM 案例都會正常運作。</span><span class="sxs-lookup"><span data-stu-id="f64a6-321">All other Exchange UM scenarios will work properly.</span></span>
  
<span data-ttu-id="f64a6-322">內部 Edge 介面和外部 Edge 介面必須使用相同類型的負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-322">The internal Edge interface and external Edge interface must use the same type of load balancing.</span></span> <span data-ttu-id="f64a6-323">您不能在一個 Edge 介面上使用 DNS 負載平衡，而在另一個 Edge 介面上使用硬體負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-323">You cannot use DNS load balancing on one Edge interface and hardware load balancing on the other Edge interface.</span></span>
  
#### <a name="deploying-dns-load-balancing-on-edge-server-pools"></a><span data-ttu-id="f64a6-324">在 Edge 伺服器池中部署 DNS 負載平衡</span><span class="sxs-lookup"><span data-stu-id="f64a6-324">Deploying DNS Load Balancing on Edge Server Pools</span></span>

<span data-ttu-id="f64a6-325">若要在 Edge 伺服器池的外部介面上部署 DNS 負載平衡, 您需要下列 DNS 專案:</span><span class="sxs-lookup"><span data-stu-id="f64a6-325">To deploy DNS load balancing on the external interface of your Edge Server pool, you need the following DNS entries:</span></span>
  
- <span data-ttu-id="f64a6-326">針對存取邊緣服務, 您需要為池中的每個伺服器加入一個專案。</span><span class="sxs-lookup"><span data-stu-id="f64a6-326">For the Access Edge service, you need one entry for each server in the pool.</span></span> <span data-ttu-id="f64a6-327">每個專案都必須將存取邊緣服務 (例如, sip.contoso.com) 的 FQDN 解析成池中某個邊緣伺服器上的存取邊緣服務的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="f64a6-327">Each entry must resolve the FQDN of the Access Edge service (for example, sip.contoso.com) to the IP address of the Access Edge service on one of the Edge Servers in the pool.</span></span>
    
- <span data-ttu-id="f64a6-328">針對網路會議 Edge 服務, 池中的每個伺服器都需要一個專案。</span><span class="sxs-lookup"><span data-stu-id="f64a6-328">For the Web Conferencing Edge service, you need one entry for each server in the pool.</span></span> <span data-ttu-id="f64a6-329">每個專案都必須將網路會議 Edge 服務 (例如, webconf.contoso.com) 的 FQDN 解析成池中某個邊緣伺服器的網路會議 Edge 服務的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="f64a6-329">Each entry must resolve the FQDN of the Web Conferencing Edge service (for example, webconf.contoso.com) to the IP address of the Web Conferencing Edge service on one of the Edge Servers in the pool.</span></span>
    
- <span data-ttu-id="f64a6-330">針對音訊/視頻邊緣服務, 池中的每個伺服器都需要一個專案。</span><span class="sxs-lookup"><span data-stu-id="f64a6-330">For the Audio/Video Edge service, you need one entry for each server in the pool.</span></span> <span data-ttu-id="f64a6-331">每個專案都必須將音訊/視頻邊緣服務 (例如, av.contoso.com) 的 FQDN 解析成池中某個邊緣伺服器上的 A/V 邊緣服務的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="f64a6-331">Each entry must resolve the FQDN of the Audio/Video Edge service (for example, av.contoso.com) to the IP address of the A/V Edge service on one of the Edge Servers in the pool.</span></span>
    
<span data-ttu-id="f64a6-332">若要在 Edge 伺服器池的內部介面上部署 DNS 負載平衡, 您必須加入一個 DNS A 記錄, 該記錄會將 Edge 伺服器池的內部 FQDN 解析成池中每個伺服器的 IP 位址。</span><span class="sxs-lookup"><span data-stu-id="f64a6-332">To deploy DNS load balancing on the internal interface of your Edge Server pool, you must add one DNS A record, which resolves the internal FQDN of the Edge Server pool to the IP address of each server in the pool.</span></span>
  
### <a name="using-dns-load-balancing-on-mediation-server-pools"></a><span data-ttu-id="f64a6-333">在中繼伺服器池中使用 DNS 負載平衡</span><span class="sxs-lookup"><span data-stu-id="f64a6-333">Using DNS Load Balancing on Mediation Server Pools</span></span>
<span data-ttu-id="f64a6-334"><a name="BK_Mediation"> </a></span><span class="sxs-lookup"><span data-stu-id="f64a6-334"></span></span>

<span data-ttu-id="f64a6-335">您可以在獨立的中繼伺服器池上使用 DNS 負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-335">You can use DNS load balancing on stand-alone Mediation Server pools.</span></span> <span data-ttu-id="f64a6-336">所有 SIP 和媒體流量都是透過 DNS 負載平衡來平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-336">All SIP and media traffic is balanced by DNS load balancing.</span></span>
  
<span data-ttu-id="f64a6-337">若要在轉送伺服器池中部署 DNS 負載平衡, 您必須建立 DNS, 以將池 FQDN (例如, mediationpool1.contoso.com) 解析成池中所有伺服器的 IP 位址 (例如, 192.168.1.1、192.168.1.2 等)。</span><span class="sxs-lookup"><span data-stu-id="f64a6-337">To deploy DNS load balancing on a Mediation Server pool, you must provision DNS to resolve the pool FQDN (for example, mediationpool1.contoso.com) to the IP addresses of all the servers in the pool (for example, 192.168.1.1, 192.168.1.2, and so on).</span></span>
  
### <a name="blocking-traffic-to-a-server-with-dns-load-balancing"></a><span data-ttu-id="f64a6-338">使用 DNS 負載平衡封鎖伺服器的流量</span><span class="sxs-lookup"><span data-stu-id="f64a6-338">Blocking Traffic to a Server With DNS Load Balancing</span></span>
<span data-ttu-id="f64a6-339"><a name="BK_Mediation"> </a></span><span class="sxs-lookup"><span data-stu-id="f64a6-339"></span></span>

<span data-ttu-id="f64a6-340">如果您使用 DNS 負載平衡, 而且您需要封鎖流量至特定電腦, 則只需從池 FQDN 中移除 IP 位址專案是不夠的。</span><span class="sxs-lookup"><span data-stu-id="f64a6-340">If you use DNS load balancing and you need to block traffic to a specific computer, it is not sufficient to just remove the IP address entries from the Pool FQDN.</span></span> <span data-ttu-id="f64a6-341">您也必須移除電腦的 DNS 專案。</span><span class="sxs-lookup"><span data-stu-id="f64a6-341">You must remove the DNS entry for the computer as well.</span></span> 
  
<span data-ttu-id="f64a6-342">請注意, 對於伺服器到伺服器的流量, 商務用 Skype 伺服器會使用拓撲感知負載平衡。</span><span class="sxs-lookup"><span data-stu-id="f64a6-342">Note that for server-to-server traffic, Skype for Business Server uses topology-aware load balancing.</span></span> <span data-ttu-id="f64a6-343">伺服器會在中央管理儲存體中讀取已發佈的拓撲, 以取得拓撲中的伺服器 Fqdn, 並在伺服器之間自動散佈流量。</span><span class="sxs-lookup"><span data-stu-id="f64a6-343">Servers read the published topology in the Central Management store to obtain the FQDNs of servers in the topology, and automatically distribute the traffic among the servers.</span></span> <span data-ttu-id="f64a6-344">若要封鎖伺服器接收伺服器對伺服器流量, 您必須從拓撲中移除伺服器。</span><span class="sxs-lookup"><span data-stu-id="f64a6-344">To block a server from receiving server-to-server traffic, you must remove the server from the topology.</span></span> 
  

