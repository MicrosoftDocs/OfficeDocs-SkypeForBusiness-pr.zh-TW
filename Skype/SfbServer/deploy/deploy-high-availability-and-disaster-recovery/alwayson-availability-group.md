---
title: 在商務用 Skype Server 的後端伺服器上部署 Alwayson 可用性群組
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
localization_priority: Normal
ms.collection: IT_Skype16
ms.assetid: c93c01e6-626c-40ad-92dd-373b0fe9189f
description: 在商務用 Skype Server 部署中部署（安裝） [Alwayson 可用性] 群組。
ms.openlocfilehash: d69e370716af2b23c57ad463ea7f4651ea0ea89a
ms.sourcegitcommit: b1229ed5dc25a04e56aa02aab8ad3d4209559d8f
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 02/06/2020
ms.locfileid: "41798270"
---
# <a name="deploy-an-always-on-availability-group-on-a-back-end-server-in-skype-for-business-server"></a>在商務用 Skype Server 的後端伺服器上部署 Alwayson 可用性群組
 
在商務用 Skype Server 部署中部署（安裝） [Alwayson 可用性] 群組（AG）。
  
您部署 AG 的方式取決於您是要將它部署在新的池中、使用鏡像的現有池，或是目前沒有後端資料庫高可用性的現有池。
  
> [!NOTE]
> 不支援將 AG 與持續聊天伺服器角色一起使用。 
  
- [在新的前端池中部署 Alwayson 可用性群組](alwayson-availability-group.md#BKMK_NewPool_CreateAlwaysOnGroup)
    
- [在使用資料庫鏡像的現有資料庫池中部署 Alwayson 可用性群組](alwayson-availability-group.md#BKMK_MirroredPool_CreateAlwaysOnGroup)
    
- [在不使用資料庫鏡像的現有池上部署 Alwayson 可用性群組](alwayson-availability-group.md#BKMK_NoHAPool_CreateAlwaysOnGroup)
    
## <a name="deploy-an-always-on-availability-group-on-a-new-front-end-pool"></a>在新的前端池中部署 Alwayson 可用性群組
<a name="BKMK_NewPool_CreateAlwaysOnGroup"> </a>

1. 在將成為 AG 一部分的所有資料庫伺服器上，啟用 [容錯移轉叢集] 功能。 在每個伺服器上，執行下列動作：
    
   - 開啟 [伺服器管理員]，然後按一下 [**新增角色和功能**]。
    
   - 按一下 **[下一步]** ，直到您到達 [**選取功能**] 方塊為止。 在這裡，選取 [**容錯移轉叢集**] 核取方塊。
    
   - 在 [**新增容錯移轉叢集所需的功能？** ] 方塊中，按一下 [**新增功能**]。
    
   - 按一下 [**安裝**]。
    
2. 驗證群集設定。
    
   - 在 [伺服器管理員] 中，按一下 [**工具**] 功能表，然後按一下 [**容錯移轉叢集管理器**]。
    
   - 在畫面右側的 [**動作**] 底下，按一下 [**驗證配置**]。
    
   - 在 [**開始之前**] 頁面上，按一下 **[下一步]**。
    
   - 選取要新增至群集的伺服器，然後按一下 [**執行所有測試**]。
    
   - 在 [**摘要**] 方塊中，檢查嚮導所報告的任何錯誤。 然後按一下 **[完成]** 以完成驗證。
    
     此嚮導可能會報告幾個警告，特別是如果您不是使用共用儲存空間。 您不需要使用共用儲存空間。 不過，如果您看到任何**錯誤**訊息，您必須先修正這些問題，然後才能繼續進行。
    
3. 建立 Windows Server 容錯移轉叢集（WSFC）。
    
   - 在 [**容錯移轉叢集管理**] 嚮導中，以滑鼠右鍵按一下 [**容錯移轉叢集管理**]，然後按一下 [**建立群集**]。
    
   - 在 [**開始之前**] 頁面上，按一下 **[下一步]**。
    
   - 新增 [群集名稱] 和 [IP 位址]。 驗證設定後，請按 **[下一步]**。
    
   - 在確認頁面上，按一下 **[下一步]**。
    
   - 建立群集之後，按一下 **[完成]**。
    
4. 我們建議您將群集仲裁設定設定為使用檔案共用見證。 若要這樣做，請使用下列步驟：
    
   - 以滑鼠右鍵按一下群集名稱，按一下 [**其他動作**]，然後按一下 [**設定群集仲裁設定**]。
    
   - 在 [**選取仲裁**設定] 選項頁面上，按一下 [**選取仲裁見證**]。
    
   - 在 [**選取仲裁見證**] 頁面上，按一下 [**設定檔案共用見證**]。
    
   - 在 [**設定檔案共用見證**] 頁面上，輸入您要使用的檔案共用路徑，然後按一下 **[下一步]**。
    
   - 在**確認**頁面上，按一下 **[下一步]**。
    
5. 在群集中的每個伺服器上，在 [SQL Server Configuration Manager] 中啟用 AG 功能。
    
   - 開啟 [SQL Server Configuration Manager]。 在畫面左側的樹狀結構中，按一下 [ **Sql Server 服務**]，然後按兩下 [sql server 服務]。 
    
   - 在 [**屬性**] 方塊中，選取 [ **alwayson**可用性] 索引標籤。選取 [**啟用 AlwaysOn 可用性群組**] 核取方塊。 出現提示時，請重新開機 SQL Server 服務。
   
6. 使用 [拓撲建立器] 來建立 [前端] 池，如在[商務用 Skype Server 中建立和發佈新拓撲中](../../deploy/install/create-and-publish-new-topology.md)所述。 當您這麼做時，請將 AG 指定為池子的 SQL store。
    
7. 建立 [可用性] 群組。
    
   - 開啟 [SQL Server Management Studio]，然後連線到 SQL Server 實例。
    
   - 在物件資源管理器中，展開 [**永不在高可用性**] 資料夾。 以滑鼠右鍵按一下 [**可用性群組**] 資料夾，然後按一下 [**新增可用性群組嚮導]**。
    
   - 如果出現 [**簡介**] 頁面，請按 **[下一步]**。
    
   - 在 [**指定可用性群組名稱**] 頁面上，輸入可用性群組的名稱，然後按 **[下一步]**。
    
   - 在 [選取資料庫] 頁面中，選取您要包含在 [AlwaysOn 可用性] 群組中的資料庫。 然後按一下 **[下一步]**。
    
     請勿在 [AlwaysOn 可用性] 群組中包含**ReportServer**、 **ReportServerTempDB**或持久聊天資料庫，因為這種情況不支援這些專案。 您可以在 [AlwaysOn 可用性] 群組中包含所有其他商務用 Skype 伺服器資料庫。
    
   - 在 [**指定複本**] 頁面上，按一下 [**複本**] 索引標籤。然後按一下 [**新增複本**] 按鈕，並聯機到您加入為 Windows Server 容錯移轉叢集節點的其他 SQL 實例。
    
   - 針對每個實例，選取 [**自動容錯移轉**] 和 [**同步提交**] 選項。 請勿選取 [**可讀的次要**] 選項。
    
   - 按一下 [**端點**] 索引標籤，並確認 [**埠號碼**] 設定為 [5022]。
    
   - 按一下 [**攔截器**] 索引標籤，然後選取 [**建立可用性群組偵聽程式]** 選項。 在 [該選項] 底下，輸入監聽器的名稱，並將**埠**設定為1433（此選項不支援其他埠）。
    
   - 按一下 [**新增**]，然後在 [ **IPv4 位址**] 方塊中，提供您慣用的虛擬 IP 位址，然後按一下 **[確定]**。
    
   - 在 [**選取初始資料同步**處理] 頁面中，選取 [完整]，並指定複本可存取的資料夾，且兩個複本所使用的 SQL Server 服務帳戶都具有寫入權限。 然後按一下 **[下一步]**。
    
     此檔案共用將在您初始化資料庫時暫時使用。 如果您正在處理大型資料庫，建議您手動初始化這些資料庫，以防您的網路頻寬無法容納資料庫備份的大小。
    
   - 在驗證頁面中，確認所有驗證檢查都已成功完成，然後按 **[下一步]**。
    
   - 在 [**摘要**] 頁面中，確認所有設定，然後按一下 [完成]。
      
8. 在已部署池和 AG 之後，請執行一些最終步驟，以確保 [AlwaysOn 可用性] 群組中的每個副本都有這些 SQL 登錄。 
    
   - 開啟拓撲建立器，選取 [**從現有部署下載拓撲**]，然後按一下 **[確定]**。
    
   - 展開 [商務用 Skype 伺服器]、展開您的拓撲，然後展開 **[SQL Server 存放區**]。 以滑鼠右鍵按一下新 [AlwaysOn 可用性] 群組的 SQL 存放區，然後按一下 [**編輯屬性**]。
    
     - 在頁面底部的 [ **SQL SERVER FQDN** ] 方塊中，將值變更為 AG 監聽程式的 FQDN。
    
   - 發佈拓撲。 從 [**動作**] 功能表按一下 [**拓撲**]，然後按一下 [**發佈**]。 然後在確認頁面中，按一下 **[下一步]**。 然後稍等幾分鐘，即可複製新的拓撲。
    
   - 開啟 SQL Server Management Studio，然後流覽到 AG。 將它容錯移轉到副複本。
    
   - 開啟商務用 Skype Server 管理命令介面，然後輸入下列 Cmdlet，以在此複製副本上建立 SQL 登錄：
    
   ```powershell
   Install-CsDatabase -Update
   ```

   - 針對群組中的每個複本重複上述兩個步驟（將群組容錯移轉`Install-CsDatabase -Update`至次要複本，然後使用）。
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-uses-database-mirroring"></a>在使用資料庫鏡像的現有資料庫池中部署 Alwayson 可用性群組
<a name="BKMK_MirroredPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> 如果您要升級到 AG 的池是貴組織的中央管理商店，您必須先將 CMS 移到另一個池中，才能升級此池。 使用 CsManagementServer Cmdlet 來移動池。 如果您的組織沒有另一個池，您可以暫時部署標準版伺服器，並將 CMS 移至此伺服器，然後再將您的池升級至 AG。 
  
1. 您可以開啟商務用 Skype Server 管理命令介面並輸入下列 Cmdlet，以將所有資料從鏡像轉移到主要節點。
    
   ```powershell
   Invoke-CsDatabaseFailover -PoolFqdn <Pool FQDN> -DatabaseType <DatabaseType> -NewPrincipal "Primary"
   ```

    針對池中的每個資料庫類型，重複這個 Cmdlet。 您可以使用下列 Cmdlet 來尋找此池中儲存的所有資料庫類型。
     
   ```powershell
   Get-CsPool -Identity <Pool FQDN>
   ```

2. 使用拓撲產生器從池中移除資料庫鏡像。
    
   - 開啟拓撲建立器。 在您的拓撲中，展開 [**企業版前端池**]，以滑鼠右鍵按一下該池子的名稱，然後按一下 [**編輯屬性**]。
    
   - 針對池中的每個 SQL store 類型，清除 [**啟用 SQL Store 鏡像**] 核取方塊。
    
3. 發佈變更的拓撲。 從 [**動作**] 功能表按一下 [**拓撲**]，然後按一下 [**發佈**]。 然後在確認頁面中，按一下 **[下一步]**
    
4. 使用 SQL Server Management Studio 來中斷鏡像。
    
   - 開啟 SQL Server Management Studio，流覽至您的資料庫，以滑鼠右鍵按一下 [工作] **，然後按一下**[**鏡像**]。 然後按一下 [**移除鏡像**]，然後按一下 **[確定]**。
    
   - 針對要轉換為 AG 的池中的所有資料庫重複此步驟。
    
5. 在所有要納入 AG 的資料庫伺服器上設定 [容錯移轉叢集] 功能。 在每個伺服器上，執行下列動作：
    
   - 開啟 [伺服器管理員]，然後按一下 [**新增角色和功能**]。
    
   - 按一下 **[下一步]** ，直到您到達 [**選取功能**] 方塊為止。 在這裡，選取 [**容錯移轉叢集**] 核取方塊。
    
   - 在 [**新增容錯移轉叢集所需的功能？** ] 方塊中，按一下 [**新增功能**]。
    
   - 按一下 [**安裝**]。
    
6. 驗證群集設定。
    
   - 在 [伺服器管理員] 中，按一下 [**工具**] 功能表，然後按一下 [**容錯移轉叢集管理器**]。
    
   - 在畫面右側的 [**動作**] 底下，按一下 [**驗證配置**]。
    
   - 在 [**開始之前**] 頁面上，按一下 **[下一步]**。
    
   - 選取要新增至群集的伺服器，然後按一下 [**執行所有測試**]。
    
   - 在 [**摘要**] 方塊中，檢查嚮導所報告的任何錯誤。 然後按一下 **[完成]** 以完成驗證。
    
     此嚮導可能會報告幾個警告，特別是如果您不是使用共用儲存空間。 您不需要使用共用儲存空間。 不過，如果您看到任何**錯誤**訊息，您必須先修正這些問題，然後才能繼續進行。
    
7. 建立 Windows Server 容錯移轉叢集。
    
   - 在 [**容錯移轉叢集管理**] 嚮導中，以滑鼠右鍵按一下 [**容錯移轉叢集管理**]，然後按一下 [**建立群集**]。
    
   - 在 [**開始之前**] 頁面上，按一下 **[下一步]**。
    
   - 新增 [群集名稱] 和 [IP 位址]。 驗證設定後，請按 **[下一步]**。
    
   - 在確認頁面上，按一下 **[下一步]**。
    
   - 建立群集之後，按一下 **[完成]**。
    
8. 我們建議您將群集仲裁設定設定為使用檔案共用見證。 若要這樣做，請使用下列步驟：
    
   - 以滑鼠右鍵按一下群集名稱，按一下 [**其他動作**]，然後按一下 [**設定群集仲裁設定**]。
    
   - 在 [**選取仲裁**設定] 選項頁面上，按一下 [**選取仲裁見證**]。
    
   - 在 [**選取仲裁見證**] 頁面上，按一下 [**設定檔案共用見證**]。
    
   - 在 [**設定檔案共用見證**] 頁面上，輸入您要使用的檔案共用路徑，然後按一下 **[下一步]**。
    
   - 在**確認**頁面上，按一下 **[下一步]**。
    
9. 在群集中的每個伺服器上，在 [SQL Server Configuration Manager] 中啟用 AG 功能。
    
   - 開啟 [SQL Server Configuration Manager]。 在畫面左側的樹狀結構中，按一下 [ **Sql Server 服務**]，然後按兩下 [sql server 服務]。 
    
   - 在 [**屬性**] 方塊中，選取 [ **alwayson**可用性] 索引標籤。選取 [**啟用 AlwaysOn 可用性群組**] 核取方塊。 出現提示時，請重新開機 SQL Server 服務。
    
10. 建立 [可用性] 群組。
    
    - 開啟 [SQL Server Management Studio]，然後連線到 SQL Server 實例。
    
    - 在物件資源管理器中，展開 [**永不在高可用性**] 資料夾。 以滑鼠右鍵按一下 [**可用性群組**] 資料夾，然後按一下 [**新增可用性群組嚮導]**。
    
    - 如果出現 [**簡介**] 頁面，請按 **[下一步]**。
    
    - 在 [**指定可用性群組名稱**] 頁面上，輸入可用性群組的名稱，然後按 **[下一步]**。
    
    - 在 [選取資料庫] 頁面中，選取您要包含在 [AlwaysOn 可用性] 群組中的資料庫。 然後按一下 **[下一步]**。
    
    請勿在 [AlwaysOn 可用性] 群組中包含**ReportServer**、 **ReportServerTempDB**或持久聊天資料庫，因為這種情況不支援這些專案。 您可以在 [AlwaysOn 可用性] 群組中包含所有其他商務用 Skype 伺服器資料庫。
    
    - 在 [**指定複本**] 頁面上，按一下 [**複本**] 索引標籤。然後按一下 [**新增複本**] 按鈕，並聯機到您加入為 Windows Server 容錯移轉叢集節點的其他 SQL 實例。
    
    - 針對每個實例，選取 [**自動容錯移轉**] 和 [**同步提交**] 選項。 請勿選取 [**可讀的次要**] 選項。
    
    - 按一下 [**端點**] 索引標籤，並確認 [**埠號碼**] 設定為 [5022]。
    
      - 按一下 [**攔截器**] 索引標籤，然後選取 [**建立可用性群組偵聽程式]** 選項。 在 [該選項] 底下，輸入監聽器的名稱，並將**埠**設定為1433（此選項不支援其他埠）。
    
    - 按一下 [**新增**]，然後在 [ **IPv4 位址**] 方塊中，提供您慣用的虛擬 IP 位址，然後按一下 **[確定]**。
    
    - 在 [**選取初始資料同步**處理] 頁面中，選取 [完整]，並指定複本可存取的資料夾，且兩個複本所使用的 SQL Server 服務帳戶都具有寫入權限。 然後按一下 **[下一步]**。
    
    此檔案共用將在您初始化資料庫時暫時使用。 如果您正在處理大型資料庫，建議您手動初始化這些資料庫，以防您的網路頻寬無法容納資料庫備份的大小。
    
    - 在驗證頁面中，確認所有驗證檢查都已成功完成，然後按 **[下一步]**。
    
    - 在 [**摘要**] 頁面中，確認所有設定，然後按一下 [完成]。
    
11. 建立新的市集中指定 AG 偵聽程式，並將舊鏡像的主體指定為 AG 的主要節點。
    
    - 開啟拓撲建立器。 在您的拓撲中，展開 [**共用元件**]，以滑鼠右鍵按一下 **[sql server**Store]，然後按一下 [**新增 sql server Store**]。
    
    - 在 [**定義新的 SQL Store** ] 頁面中，先選取 [**高可用性設定**] 核取方塊，然後確認 [SQL AlwaysOn 可用性群組] 出現在下拉式方塊中。
    
    - 在 [ **SQL Server 可用性偵聽程式 FQDN]** 方塊中，輸入您在建立可用性群組時所建立之監聽程式的 FQDN。
    
    - 在 [ **SQL SERVER FQDN** ] 方塊中，輸入 AG 主要節點的 FQDN，然後按一下 **[確定]**。 這應該是此存放區之舊鏡像的主體。
    
12. 將新的 AG 與前端池建立關聯。
    
    - 在拓撲建立器中，以滑鼠右鍵按一下要與 AG 關聯的 [泳池]，然後按一下 [**編輯屬性**]。
    
    - 在 [**關聯**性] 底下的 [ **SQL Server 存放區**] 方塊中，選取 AG。 針對您要移至 AG 的池中的任何其他資料庫，選取相同的群組。
    
    - 當您確定所需的所有資料庫都設定為 AG 時，請按一下 **[確定]**。
    
13. 發佈拓撲。 從 [**動作**] 功能表按一下 [**拓撲**]，然後按一下 [**發佈**]。 然後在確認頁面中，按一下 **[下一步]**。
    
14. 執行一些最終步驟，以確保 [AlwaysOn 可用性] 群組中的每個副本都有這些 SQL 登錄。
    
    - 開啟拓撲建立器，選取 [**從現有部署下載拓撲**]，然後按一下 **[確定]**。
    
    - 展開 [商務用 Skype 伺服器]、展開您的拓撲，然後展開 **[SQL Server 存放區**]。 以滑鼠右鍵按一下新 AG 的 [SQL] 商店，然後按一下 [**編輯屬性**]。
    
    - 在頁面底部的 [ **SQL SERVER FQDN** ] 方塊中，將值變更為 AG 監聽程式的 FQDN。
    
    - 發佈拓撲。 從 [**動作**] 功能表按一下 [**拓撲**]，然後按一下 [**發佈**]。 然後在確認頁面中，按一下 **[下一步]**。 然後稍等幾分鐘，即可複製新的拓撲。
    
    - 開啟 SQL Server Management Studio，然後流覽到 AG。 將它容錯移轉到副複本。
    
    - 開啟商務用 Skype Server 管理命令介面，然後輸入下列 Cmdlet，以在此複製副本上建立 SQL 登錄：
    
    ```powershell
    Install-CsDatabase -Update
    ```

    - 針對群組中的每個複本重複上述兩個步驟（將群組容錯移轉`Install-CsDatabase -Update`至次要複本，然後使用）。
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-does-not-use-database-mirroring"></a>在不使用資料庫鏡像的現有池上部署 Alwayson 可用性群組
<a name="BKMK_NoHAPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> 如果您要升級到 AG 的池是貴組織的中央管理商店，您必須先將 CMS 移到另一個池中，才能升級此池。 使用 CsManagementServer Cmdlet 來移動池。 如果您的組織沒有另一個池，您可以暫時部署標準版伺服器，並將 CMS 移至此伺服器，然後再將您的池升級至 AG。 
  
1. 在所有要納入 AG 的資料庫伺服器上設定 [容錯移轉叢集] 功能。 在每個伺服器上，執行下列動作：
    
   - 開啟 [伺服器管理員]，然後按一下 [**新增角色和功能**]。
    
   - 按一下 **[下一步]** ，直到您到達 [**選取功能**] 方塊為止。 在這裡，選取 [**容錯移轉叢集**] 核取方塊。
    
   - 在 [**新增容錯移轉叢集所需的功能？** ] 方塊中，按一下 [**新增功能**]。
    
   - 按一下 [**安裝**]。
    
2. 驗證群集設定。
    
   - 在 [伺服器管理員] 中，按一下 [**工具**] 功能表，然後按一下 [**容錯移轉叢集管理器**]。
    
   - 在畫面右側的 [**動作**] 底下，按一下 [**驗證配置**]。
    
   - 在 [**開始之前**] 頁面上，按一下 **[下一步]**。
    
   - 選取要新增至群集的伺服器，然後按一下 [**執行所有測試**]。
    
   - 在 [**摘要**] 方塊中，檢查嚮導所報告的任何錯誤。 然後按一下 **[完成]** 以完成驗證。
    
     此嚮導可能會報告幾個警告，特別是如果您不是使用共用儲存空間。 您不需要使用共用儲存空間。 不過，如果您看到任何**錯誤**訊息，您必須先修正這些問題，然後才能繼續進行。
    
3. 建立 Windows Server 容錯移轉叢集（WSFC）。
    
   - 在 [**容錯移轉叢集管理**] 嚮導中，以滑鼠右鍵按一下 [**容錯移轉叢集管理**]，然後按一下 [**建立群集**]。
    
   - 在 [**開始之前**] 頁面上，按一下 **[下一步]**。
    
   - 新增 [群集名稱] 和 [IP 位址]。 驗證設定後，請按 **[下一步]**。
    
   - 在確認頁面上，按一下 **[下一步]**。
    
   - 建立群集之後，按一下 **[完成]**。
    
4. 我們建議您將群集仲裁設定設定為使用檔案共用見證。 若要這樣做，請使用下列步驟：
    
   - 以滑鼠右鍵按一下群集名稱，按一下 [**其他動作**]，然後按一下 [**設定群集仲裁設定**]。
    
   - 在 [**選取仲裁**設定] 選項頁面上，按一下 [**選取仲裁見證**]。
    
   - 在 [**選取仲裁見證**] 頁面上，按一下 [**設定檔案共用見證**]。
    
   - 在 [**設定檔案共用見證**] 頁面上，輸入您要使用的檔案共用路徑，然後按一下 **[下一步]**。
    
   - 在**確認**頁面上，按一下 **[下一步]**。
    
5. 在群集中的每個伺服器上，于 [SQL Server Configuration Manager] 中啟用 AG。
    
   - 開啟 [SQL Server Configuration Manager]。 在畫面左側的樹狀結構中，按一下 [ **Sql Server 服務**]，然後按兩下 [sql server 服務]。 
    
   - 在 [**屬性**] 方塊中，選取 [ **alwayson**可用性] 索引標籤。選取 [**啟用 AlwaysOn 可用性群組**] 核取方塊。 出現提示時，請重新開機 SQL Server 服務。
    
6. 建立 [可用性] 群組。
    
   - 開啟 [SQL Server Management Studio]，然後連線到 SQL Server 實例。
    
   - 在物件資源管理器中，展開 [**永不在高可用性**] 資料夾。 以滑鼠右鍵按一下 [**可用性群組**] 資料夾，然後按一下 [**新增可用性群組嚮導]**。
    
   - 如果出現 [**簡介**] 頁面，請按 **[下一步]**。
    
   - 在 [**指定可用性群組名稱**] 頁面上，輸入可用性群組的名稱，然後按 **[下一步]**。
    
   - 在 [選取資料庫] 頁面中，選取您要包含在 AG 中的資料庫。 然後按一下 **[下一步]**。
    
     請勿在 AG 中包含**ReportServer**、 **ReportServerTempDB**或持久聊天資料庫，因為這種情況不支援這些專案。 您可以在 AG 中包含所有其他商務用 Skype 伺服器資料庫。
    
   - 在 [**指定複本**] 頁面上，按一下 [**複本**] 索引標籤。然後按一下 [**新增複本**] 按鈕，並聯機到您加入為 WSFC 節點的其他 SQL 實例。
    
   - 針對每個實例，選取 [**自動容錯移轉**] 和 [**同步提交**] 選項。 請勿選取 [**可讀的次要**] 選項。
    
   - 按一下 [**端點**] 索引標籤，並確認 [**埠號碼**] 設定為 [5022]。
    
   - 按一下 [**攔截器**] 索引標籤，然後選取 [**建立可用性群組偵聽程式]** 選項。 在 [該選項] 底下，輸入監聽器的名稱，並將**埠**設定為1433（此選項不支援其他埠）。
    
   - 按一下 [**新增**]，然後在 [ **IPv4 位址**] 方塊中，提供您慣用的虛擬 IP 位址，然後按一下 **[確定]**。
    
   - 在 [**選取初始資料同步**處理] 頁面中，選取 [完整]，並指定複本可存取的資料夾，且兩個複本所使用的 SQL Server 服務帳戶都具有寫入權限。 然後按一下 **[下一步]**。
    
     此檔案共用將在您初始化資料庫時暫時使用。 如果您正在處理大型資料庫，建議您手動初始化這些資料庫，以防您的網路頻寬無法容納資料庫備份的大小。
    
     - 在驗證頁面中，確認所有驗證檢查都已成功完成，然後按 **[下一步]**。
    
   - 在 [**摘要**] 頁面中，確認所有設定，然後按一下 [完成]。
    
7. 建立新的書店來指定 AG 監聽程式。
    
   - 開啟拓撲建立器。 在您的拓撲中，展開 [**共用元件**]，以滑鼠右鍵按一下 **[sql server**Store]，然後按一下 [**新增 sql server Store**]。
    
   - 在 [**定義新的 SQL Store** ] 頁面中，先選取 [**高可用性設定**] 核取方塊，然後確認 [SQL AlwaysOn 可用性群組] 出現在下拉式方塊中。
    
   - 在 [ **SQL Server 可用性偵聽程式 FQDN]** 方塊中，輸入您在建立可用性群組時所建立之監聽程式的 FQDN。
    
   - 在 [ **SQL SERVER FQDN** ] 方塊中，輸入 AG 主要節點的 FQDN，然後按一下 **[確定]**。
    
8. 將新的 [永遠開啟] 可用性群組與 [前端] 池建立關聯。
    
   - 在拓撲建立器中，以滑鼠右鍵按一下要與 AG 關聯的 [泳池]，然後按一下 [**編輯屬性**]。
    
   - 在 [**關聯**性] 底下的 [ **SQL Server 存放區**] 方塊中，選取 AG。 針對您要移至 AG 的池中的任何其他資料庫，選取相同的群組。
    
   - 當您確定所需的所有資料庫都設定為 AG 時，請按一下 **[確定]**。
    
9. 發佈拓撲。 從 [**動作**] 功能表按一下 [**拓撲**]，然後按一下 [**發佈**]。 然後在確認頁面中，按一下 **[下一步]**。
    
10. 執行一些最終步驟，以確保 AG 中的每個副本都有這些 SQL 登錄。
    
    - 開啟拓撲建立器，選取 [**從現有部署下載拓撲**]，然後按一下 **[確定]**。
    
    - 展開 [商務用 Skype 伺服器]、展開您的拓撲，然後展開 **[SQL Server 存放區**]。 以滑鼠右鍵按一下新 AG 的 [SQL] 商店，然後按一下 [**編輯屬性**]。
    
    - 在頁面底部的 [ **SQL SERVER FQDN** ] 方塊中，將值變更為 AG 監聽程式的 FQDN。
    
    - 發佈拓撲。 從 [**動作**] 功能表按一下 [**拓撲**]，然後按一下 [**發佈**]。 然後在確認頁面中，按一下 **[下一步]**。 然後稍等幾分鐘，即可複製新的拓撲。
    
    - 開啟 SQL Server Management Studio，然後流覽到 AG。 將它容錯移轉到副複本。
    
    - 開啟商務用 Skype Server 管理命令介面，然後輸入下列 Cmdlet，以在此複製副本上建立 SQL 登錄：
    
      ```powershell
      Install-CsDatabase -Update
      ```

      - 針對群組中的每個複本重複上述兩個步驟（將群組容錯移轉`Install-CsDatabase -Update`至次要複本，然後使用）。
