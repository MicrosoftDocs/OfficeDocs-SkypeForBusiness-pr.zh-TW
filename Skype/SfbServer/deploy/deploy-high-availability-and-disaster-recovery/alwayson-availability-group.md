---
title: 在商務用 Skype Server 中的後端伺服器上部署 Always On 可用性群組
ms.reviewer: ''
ms.author: v-mahoffman
author: HowlinWolf-92
manager: serdars
audience: ITPro
ms.topic: quickstart
ms.prod: skype-for-business-itpro
f1.keywords:
- NOCSH
ms.localizationpriority: medium
ms.collection: IT_Skype16
ms.assetid: c93c01e6-626c-40ad-92dd-373b0fe9189f
description: 部署 (安裝) 商務用 Skype Server 部署中的 Always On 可用性群組。
ms.openlocfilehash: c30a17ee0852cab3e8e61ee7751a6e8f5f5a6bd1
ms.sourcegitcommit: 67324fe43f50c8414bb65c52f5b561ac30b52748
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 11/08/2021
ms.locfileid: "60829467"
---
# <a name="deploy-an-always-on-availability-group-on-a-back-end-server-in-skype-for-business-server"></a>在商務用 Skype Server 中的後端伺服器上部署 Always On 可用性群組
 
在商務用 Skype Server 部署中部署 (安裝) Always On 可用性群組 (AG) 。
  
如何部署 AG 取決於您是在新的集區中部署它、使用鏡像的現有集區，或是目前沒有後端資料庫高可用性的現有集區。
  
> [!NOTE]
> 不支援使用具有 Persistent Chat Server role 的 AG。 
  
- [在新的前端集區上部署 Always On 可用性群組](alwayson-availability-group.md#BKMK_NewPool_CreateAlwaysOnGroup)
    
- [在使用資料庫鏡像的現有集區上部署 Always On 可用性群組](alwayson-availability-group.md#BKMK_MirroredPool_CreateAlwaysOnGroup)
    
- [在未使用資料庫鏡像的現有集區上部署 Always On 可用性群組](alwayson-availability-group.md#BKMK_NoHAPool_CreateAlwaysOnGroup)
    
## <a name="deploy-an-always-on-availability-group-on-a-new-front-end-pool"></a>在新的前端集區上部署 Always On 可用性群組
<a name="BKMK_NewPool_CreateAlwaysOnGroup"> </a>

1. 在將成為 AG 一部分之所有資料庫伺服器上啟用容錯移轉叢集功能。 在每一部伺服器上，執行下列操作：
    
   - 開啟 [伺服器管理員]，然後按一下 [ **新增角色及功能**]。
    
   - 按 **[下一步]** ，直到您到達 [ **選取功能** ] 方塊。 在這裡，選取 [ **容錯移轉** 叢集] 核取方塊。
    
   - 在 [ **新增容錯移轉叢集所需的功能？** ] 方塊中，按一下 [ **新增功能**]。
    
   - 按一下 **安裝**。
    
2. 驗證叢集設定。
    
   - 在 [伺服器管理員] 中，按一下 [ **工具** ] 功能表，然後按一下 [ **容錯移轉叢集管理員**]。
    
   - 在螢幕右側的 [ **動作** ] 下，按一下 [ **驗證** 設定]。
    
   - 在 **[開始之前]** 頁面上，按 **[下一步]**。
    
   - 選取要新增至該群集中的伺服器，然後按一下 [ **執行所有測試**]。
    
   - 在 [ **摘要** ] 方塊中，檢查嚮導所報告的任何錯誤。 然後按一下 **[完成]** 以完成驗證。
    
     嚮導可能會報告數個警告，尤其是當您不是使用共用儲存區時。 您不需要使用共用儲存區。 不過，如果您看到任何 **錯誤** 訊息，您必須先修正這些問題，再繼續進行。
    
3. 建立 Windows 伺服器容錯移轉叢集 (WSFC) 。
    
   - 在 [ **容錯移轉叢集管理** ] 嚮導中，以滑鼠右鍵按一下 [ **容錯移轉叢集管理**]，然後按一下 [ **建立** 叢集]。
    
   - 在 **[開始之前]** 頁面上，按 **[下一步]**。
    
   - 新增群集名稱和 IP 位址。 驗證設定後，請按 **[下一步]**。
    
   - 在 [確認] 頁面上，按 **[下一步]**。
    
   - 建立叢集後，按一下 **[完成]**。
    
4. 建議您將叢集仲裁設定設定為使用檔案共用見證。 若要這麼做，請使用下列步驟：
    
   - 以滑鼠右鍵按一下該叢集名稱，按一下 [**其他動作**]，然後按一下 [**設定叢集仲裁] 設定**。
    
   - 在 [ **選取仲裁設定選項** ] 頁面上，按一下 **[選取仲裁見證**]。
    
   - 在 [ **選取仲裁見證** ] 頁面上，按一下 [ **設定檔案共用見證**]。
    
   - 在 [ **設定檔案共用見證** ] 頁面中，輸入您要使用的檔案共用路徑，然後按 **[下一步]**。
    
   - 在 [確認] 頁面上，按 [下一步]。
    
5. 在該群集中的每一部伺服器上，啟用 SQL Server 組態管理員中的 AG 功能。
    
   - 開啟 SQL Server Configuration Manager。 在螢幕左側的樹狀目錄中，按一下 [ **SQL Server 服務**]，然後按兩下 SQL Server 服務。 
    
   - 在 [ **屬性** ] 方塊中，選取 [ **AlwaysOn 高可用性** ] 索引標籤。選取 [ **啟用 AlwaysOn 可用性群組** ] 核取方塊。 出現提示時，請重新開機 SQL Server 服務。
   
6. 使用拓撲產生器建立前端集區（如在[商務用 Skype Server 建立及發行新拓撲中](../../deploy/install/create-and-publish-new-topology.md)所述）。 當您這麼做時，請將 AG 指定為集區的 SQL 儲存區。
    
7. 建立可用性群組。
    
   - 開啟 SQL Server Management Studio，並連接到 SQL Server 實例。
    
   - 在 [物件瀏覽器] 中，展開 [ **永不增加高可用性** ] 資料夾。 在 [ **可用性群組** ] 資料夾上按一下滑鼠右鍵，然後按一下 [ **新增可用性群組嚮導]**。
    
   - 如果出現 [ **簡介** ] 頁面，按 **[下一步]**。
    
   - 在 [ **指定可用性組名** ] 頁面中，輸入可用性群組的名稱，然後按 **[下一步]**。
    
   - 在 [選取資料庫] 頁面中，選取您要包含在 [AlwaysOn 可用性] 群組中的資料庫。 然後按一下 **下一步**。
    
     請不要在 AlwaysOn 可用性群組中包含 **ReportServer**、 **ReportServerTempDB** 或 Persistent 聊天資料庫，因為這種情況不會支援這些功能。 您可以在 AlwaysOn 可用性群組中包含所有其他商務用 Skype Server 資料庫。
    
   - 在 [**指定複本**] 頁面上，按一下 [**複本**] 索引標籤。然後按一下 [**新增複製副本**] 按鈕，並連接到您加入為 Windows 伺服器容錯移轉叢集之節點的其他 SQL 實例。
    
   - 針對每個實例，選取 [ **自動容錯移轉** ] 和 [ **同步認可** ] 選項。 請勿選取 [ **可讀取的次要** ] 選項。
    
   - 按一下 [ **端點** ] 索引標籤，並確認 **埠號碼** 設定為5022。
    
   - 按一下 [ **監聽器** ] 索引標籤，然後選取 [ **建立可用性群組接聽程式** ] 選項。 在 [此選項] 底下輸入監聽器的名稱，並將 **埠** 設定為 1433 (此選項) 不支援其他埠。
    
   - 按一下 [ **新增**]，然後在 [ **IPv4 網址** ] 方塊中，提供您慣用的虛擬 IP 位址，然後按一下 **[確定]**。
    
   - 在 [**選取初始資料同步** 處理] 頁面中，選取 [完整]，並指定複本可存取的資料夾，而且這兩個複本所使用的 SQL Server 服務帳戶都具有寫入權限。 然後按一下 **下一步**。
    
     當您初始化資料庫時，會暫時使用此檔案共用。 如果您正在處理大型資料庫，建議您手動加以初始化，以防您的網路頻寬無法容納資料庫備份的大小。
    
   - 在 [驗證] 頁面中，確認所有驗證檢查是否都成功，然後按 **[下一步]**。
    
   - 在 [ **摘要** ] 頁面中，確認所有設定，然後按一下 [完成]。
      
8. 部署集區和 AG 之後，請執行一些最後的步驟，以確保 AlwaysOn 可用性群組中的每個副本上都有 SQL 登入。 
    
   - 開啟拓撲產生器，選取 [ **從現有的部署下載拓撲**]，然後按一下 **[確定]**。
    
   - 展開商務用 Skype Server，展開您的拓撲，然後展開 **SQL Server 儲存區**。 以滑鼠右鍵按一下新 AlwaysOn 可用性群組的 SQL 儲存區，然後按一下 [**編輯屬性**]。
    
     - 在頁面底部的 [ **SQL Server FQDN** ] 方塊中，將值變更為 AG 的攔截器的 FQDN。
    
   - 發行拓撲。 從 [ **動作** ] 功能表中，按一下 [ **拓撲** ]，然後再 **發佈**。 然後在 [確認] 頁面中按 **[下一步]**。 然後，請稍候幾分鐘，以複製新的拓撲。
    
   - 開啟 SQL Server Management Studio，然後流覽至 AG。 將其容錯移轉至次要複本。
    
   - 開啟商務用 Skype Server 管理命令介面，並輸入下列 Cmdlet，以在此副本上建立 SQL 登入：
    
   ```powershell
   Install-CsDatabase -Update
   ```

   - 重複執行先前的兩個步驟 (將群組容錯移轉至次要複本，然後  `Install-CsDatabase -Update` 針對群組中的每個複本使用) 。
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-uses-database-mirroring"></a>在使用資料庫鏡像的現有集區上部署 Always On 可用性群組
<a name="BKMK_MirroredPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> 如果您要升級的集區為 AG 主控組織的中央管理存放區，則必須先將 CMS 移至另一個集區，再升級此集區。 使用 Move-CsManagementServer Cmdlet 可移動集區。 如果您的組織中沒有另一個集區，您可以在將集區升級至 AG 之前，暫時部署 Standard Edition 伺服器並將 CMS 移至此伺服器。 
  
1. 開啟商務用 Skype Server 管理命令介面並輸入下列指令程式，以將鏡像中的所有資料容錯移轉至主體節點。
    
   ```powershell
   Invoke-CsDatabaseFailover -PoolFqdn <Pool FQDN> -DatabaseType <DatabaseType> -NewPrincipal "Primary"
   ```

    針對集區中的每個資料庫類型重複此 Cmdlet。 您可以使用下列 Cmdlet 來尋找儲存在此集區中的所有資料庫類型。
     
   ```powershell
   Get-CsPool -Identity <Pool FQDN>
   ```

2. 使用拓撲產生器，從集區中移除資料庫鏡像。
    
   - 開啟拓撲產生器。 在您的拓撲中，展開 [ **Enterprise Edition 前端** 集區]，以滑鼠右鍵按一下集區的名稱，然後按一下 [**編輯屬性**]。
    
   - 針對集區中的每一種 SQL 儲存區，清除 [**啟用 SQL 儲存區鏡像**] 核取方塊。
    
3. 發佈變更的拓撲。 從 [ **動作** ] 功能表中，按一下 [ **拓撲** ]，然後再 **發佈**。 然後在 [確認] 頁面中，按 **[下一步]**
    
4. 使用 SQL Server Management Studio 以中斷鏡像。
    
   - 開啟 SQL Server Management Studio，流覽至您的資料庫，以滑鼠右鍵按一下 [**任務**]，然後按一下 [**鏡像**]。 然後按一下 [ **移除鏡像** ]，然後按一下 **[確定]**。
    
   - 針對集區中將轉換為 AG 的所有資料庫重複此步驟。
    
5. 在將成為 AG 一部分的所有資料庫伺服器上，設定容錯移轉叢集功能。 在每一部伺服器上，執行下列操作：
    
   - 開啟 [伺服器管理員]，然後按一下 [ **新增角色及功能**]。
    
   - 按 **[下一步]** ，直到您到達 [ **選取功能** ] 方塊。 在這裡，選取 [ **容錯移轉** 叢集] 核取方塊。
    
   - 在 [ **新增容錯移轉叢集所需的功能？** ] 方塊中，按一下 [ **新增功能**]。
    
   - 按一下 **安裝**。
    
6. 驗證叢集設定。
    
   - 在 [伺服器管理員] 中，按一下 [ **工具** ] 功能表，然後按一下 [ **容錯移轉叢集管理員**]。
    
   - 在螢幕右側的 [ **動作** ] 下，按一下 [ **驗證** 設定]。
    
   - 在 **[開始之前]** 頁面上，按 **[下一步]**。
    
   - 選取要新增至該群集中的伺服器，然後按一下 [ **執行所有測試**]。
    
   - 在 [ **摘要** ] 方塊中，檢查嚮導所報告的任何錯誤。 然後按一下 **[完成]** 以完成驗證。
    
     嚮導可能會報告數個警告，尤其是當您不是使用共用儲存區時。 您不需要使用共用儲存區。 不過，如果您看到任何 **錯誤** 訊息，您必須先修正這些問題，再繼續進行。
    
7. 建立 Windows 伺服器容錯移轉叢集。
    
   - 在 [ **容錯移轉叢集管理** ] 嚮導中，以滑鼠右鍵按一下 [ **容錯移轉叢集管理**]，然後按一下 [ **建立** 叢集]。
    
   - 在 **[開始之前]** 頁面上，按 **[下一步]**。
    
   - 新增群集名稱和 IP 位址。 驗證設定後，請按 **[下一步]**。
    
   - 在 [確認] 頁面上，按 **[下一步]**。
    
   - 建立叢集後，按一下 **[完成]**。
    
8. 建議您將叢集仲裁設定設定為使用檔案共用見證。 若要這麼做，請使用下列步驟：
    
   - 以滑鼠右鍵按一下該叢集名稱，按一下 [**其他動作**]，然後按一下 [**設定叢集仲裁] 設定**。
    
   - 在 [ **選取仲裁設定選項** ] 頁面上，按一下 **[選取仲裁見證**]。
    
   - 在 [ **選取仲裁見證** ] 頁面上，按一下 [ **設定檔案共用見證**]。
    
   - 在 [ **設定檔案共用見證** ] 頁面中，輸入您要使用的檔案共用路徑，然後按 **[下一步]**。
    
   - 在 [確認] 頁面上，按 [下一步]。
    
9. 在該群集中的每一部伺服器上，啟用 SQL Server 組態管理員中的 AG 功能。
    
   - 開啟 SQL Server Configuration Manager。 在螢幕左側的樹狀目錄中，按一下 [ **SQL Server 服務**]，然後按兩下 SQL Server 服務。 
    
   - 在 [ **屬性** ] 方塊中，選取 [ **AlwaysOn 高可用性** ] 索引標籤。選取 [ **啟用 AlwaysOn 可用性群組** ] 核取方塊。 出現提示時，請重新開機 SQL Server 服務。
    
10. 建立可用性群組。
    
    - 開啟 SQL Server Management Studio，並連接到 SQL Server 實例。
    
    - 在 [物件瀏覽器] 中，展開 [ **永不增加高可用性** ] 資料夾。 在 [ **可用性群組** ] 資料夾上按一下滑鼠右鍵，然後按一下 [ **新增可用性群組嚮導]**。
    
    - 如果出現 [ **簡介** ] 頁面，按 **[下一步]**。
    
    - 在 [ **指定可用性組名** ] 頁面中，輸入可用性群組的名稱，然後按 **[下一步]**。
    
    - 在 [選取資料庫] 頁面中，選取您要包含在 [AlwaysOn 可用性] 群組中的資料庫。 然後按一下 **下一步**。
    
    請不要在 AlwaysOn 可用性群組中包含 **ReportServer**、 **ReportServerTempDB** 或 Persistent 聊天資料庫，因為這種情況不會支援這些功能。 您可以在 AlwaysOn 可用性群組中包含所有其他商務用 Skype Server 資料庫。
    
    - 在 [**指定複本**] 頁面上，按一下 [**複本**] 索引標籤。然後按一下 [**新增複製副本**] 按鈕，並連接到您加入為 Windows 伺服器容錯移轉叢集之節點的其他 SQL 實例。
    
    - 針對每個實例，選取 [ **自動容錯移轉** ] 和 [ **同步認可** ] 選項。 請勿選取 [ **可讀取的次要** ] 選項。
    
    - 按一下 [ **端點** ] 索引標籤，並確認 **埠號碼** 設定為5022。
    
      - 按一下 [ **監聽器** ] 索引標籤，然後選取 [ **建立可用性群組接聽程式** ] 選項。 在 [此選項] 底下輸入監聽器的名稱，並將 **埠** 設定為 1433 (此選項) 不支援其他埠。
    
    - 按一下 [ **新增**]，然後在 [ **IPv4 網址** ] 方塊中，提供您慣用的虛擬 IP 位址，然後按一下 **[確定]**。
    
    - 在 [**選取初始資料同步** 處理] 頁面中，選取 [完整]，並指定複本可存取的資料夾，而且這兩個複本所使用的 SQL Server 服務帳戶都具有寫入權限。 然後按一下 **下一步**。
    
    當您初始化資料庫時，會暫時使用此檔案共用。 如果您正在處理大型資料庫，建議您手動加以初始化，以防您的網路頻寬無法容納資料庫備份的大小。
    
    - 在 [驗證] 頁面中，確認所有驗證檢查是否都成功，然後按 **[下一步]**。
    
    - 在 [ **摘要** ] 頁面中，確認所有設定，然後按一下 [完成]。
    
11. 建立新的存放區，指定 AG 接聽程式，並將舊鏡像的主體指定為 AG 的主要節點。
    
    - 開啟拓撲產生器。 在拓撲中，展開 [**共用元件**]，以滑鼠右鍵按一下 [ **SQL Server 儲存**]，然後按一下 [**新增 SQL Server 儲存區**]。
    
    - 在 [**定義新的 SQL 儲存區**] 頁面中，先選取 [**高可用性設定**] 核取方塊，然後確定 [SQL AlwaysOn 可用性群組會出現在下拉式方塊中。
    
    - 在 [ **SQL Server 可用性攔截器 FQDN]** 方塊中，輸入您在建立可用性群組時所建立的攔截器 FQDN。
    
    - 在 [ **SQL Server FQDN** ] 方塊中，輸入 AG 之主要節點的 FQDN，然後按一下 **[確定]**。 這應該是此存放區之舊鏡像的主體。
    
12. 將新的 AG 與前端集區產生關聯。
    
    - 在 [拓撲產生器] 中，以滑鼠右鍵按一下要與 AG 產生關聯的集區，然後按一下 [ **編輯屬性**]。
    
    - 在 [**關聯**] 底下的 [ **SQL Server 儲存區**] 方塊中，選取 AG。 針對您要移至 AG 的集區中的任何其他資料庫，選取相同的群組。
    
    - 當您確定所有必要的資料庫都設定為 AG 時，請按一下 **[確定]**。
    
13. 發行拓撲。 從 [ **動作** ] 功能表中，按一下 [ **拓撲** ]，然後再 **發佈**。 然後在 [確認] 頁面中按 **[下一步]**。
    
14. 請執行一些最後的步驟，以確保 AlwaysOn 可用性群組中的每個複本都有 SQL 登入。
    
    - 開啟拓撲產生器，選取 [ **從現有的部署下載拓撲**]，然後按一下 **[確定]**。
    
    - 展開商務用 Skype Server，展開您的拓撲，然後展開 **SQL Server 儲存區**。 以滑鼠右鍵按一下新 AG 的 SQL 儲存區，然後按一下 [**編輯屬性**]。
    
    - 在頁面底部的 [ **SQL Server FQDN** ] 方塊中，將值變更為 AG 的攔截器的 FQDN。
    
    - 發行拓撲。 從 [ **動作** ] 功能表中，按一下 [ **拓撲** ]，然後再 **發佈**。 然後在 [確認] 頁面中按 **[下一步]**。 然後，請稍候幾分鐘，以複製新的拓撲。
    
    - 開啟 SQL Server Management Studio，然後流覽至 AG。 將其容錯移轉至次要複本。
    
    - 開啟商務用 Skype Server 管理命令介面，並輸入下列 Cmdlet，以在此副本上建立 SQL 登入：
    
    ```powershell
    Install-CsDatabase -Update
    ```

    - 重複執行先前的兩個步驟 (將群組容錯移轉至次要複本，然後  `Install-CsDatabase -Update` 針對群組中的每個複本使用) 。
    
## <a name="deploy-an-always-on-availability-group-on-an-existing-pool-that-does-not-use-database-mirroring"></a>在未使用資料庫鏡像的現有集區上部署 Always On 可用性群組
<a name="BKMK_NoHAPool_CreateAlwaysOnGroup"> </a>

> [!NOTE]
> 如果您要升級的集區為 AG 主控組織的中央管理存放區，則必須先將 CMS 移至另一個集區，再升級此集區。 使用 Move-CsManagementServer Cmdlet 可移動集區。 如果您的組織中沒有另一個集區，您可以在將集區升級至 AG 之前，暫時部署 Standard Edition 伺服器並將 CMS 移至此伺服器。 
  
1. 在將成為 AG 一部分的所有資料庫伺服器上，設定容錯移轉叢集功能。 在每一部伺服器上，執行下列操作：
    
   - 開啟 [伺服器管理員]，然後按一下 [ **新增角色及功能**]。
    
   - 按 **[下一步]** ，直到您到達 [ **選取功能** ] 方塊。 在這裡，選取 [ **容錯移轉** 叢集] 核取方塊。
    
   - 在 [ **新增容錯移轉叢集所需的功能？** ] 方塊中，按一下 [ **新增功能**]。
    
   - 按一下 **安裝**。
    
2. 驗證叢集設定。
    
   - 在 [伺服器管理員] 中，按一下 [ **工具** ] 功能表，然後按一下 [ **容錯移轉叢集管理員**]。
    
   - 在螢幕右側的 [ **動作** ] 下，按一下 [ **驗證** 設定]。
    
   - 在 **[開始之前]** 頁面上，按 **[下一步]**。
    
   - 選取要新增至該群集中的伺服器，然後按一下 [ **執行所有測試**]。
    
   - 在 [ **摘要** ] 方塊中，檢查嚮導所報告的任何錯誤。 然後按一下 **[完成]** 以完成驗證。
    
     嚮導可能會報告數個警告，尤其是當您不是使用共用儲存區時。 您不需要使用共用儲存區。 不過，如果您看到任何 **錯誤** 訊息，您必須先修正這些問題，再繼續進行。
    
3. 建立 Windows 伺服器容錯移轉叢集 (WSFC) 。
    
   - 在 [ **容錯移轉叢集管理** ] 嚮導中，以滑鼠右鍵按一下 [ **容錯移轉叢集管理**]，然後按一下 [ **建立** 叢集]。
    
   - 在 **[開始之前]** 頁面上，按 **[下一步]**。
    
   - 新增群集名稱和 IP 位址。 驗證設定後，請按 **[下一步]**。
    
   - 在 [確認] 頁面上，按 **[下一步]**。
    
   - 建立叢集後，按一下 **[完成]**。
    
4. 建議您將叢集仲裁設定設定為使用檔案共用見證。 若要這麼做，請使用下列步驟：
    
   - 以滑鼠右鍵按一下該叢集名稱，按一下 [**其他動作**]，然後按一下 [**設定叢集仲裁] 設定**。
    
   - 在 [ **選取仲裁設定選項** ] 頁面上，按一下 **[選取仲裁見證**]。
    
   - 在 [ **選取仲裁見證** ] 頁面上，按一下 [ **設定檔案共用見證**]。
    
   - 在 [ **設定檔案共用見證** ] 頁面中，輸入您要使用的檔案共用路徑，然後按 **[下一步]**。
    
   - 在 [確認] 頁面上，按 [下一步]。
    
5. 在該群集中的每一部伺服器上，在 SQL Server 組態管理員中啟用 AG。
    
   - 開啟 SQL Server Configuration Manager。 在螢幕左側的樹狀目錄中，按一下 [ **SQL Server 服務**]，然後按兩下 SQL Server 服務。 
    
   - 在 [ **屬性** ] 方塊中，選取 [ **AlwaysOn 高可用性** ] 索引標籤。選取 [ **啟用 AlwaysOn 可用性群組** ] 核取方塊。 出現提示時，請重新開機 SQL Server 服務。
    
6. 建立可用性群組。
    
   - 開啟 SQL Server Management Studio，並連接到 SQL Server 實例。
    
   - 在 [物件瀏覽器] 中，展開 [ **永不增加高可用性** ] 資料夾。 在 [ **可用性群組** ] 資料夾上按一下滑鼠右鍵，然後按一下 [ **新增可用性群組嚮導]**。
    
   - 如果出現 [ **簡介** ] 頁面，按 **[下一步]**。
    
   - 在 [ **指定可用性組名** ] 頁面中，輸入可用性群組的名稱，然後按 **[下一步]**。
    
   - 在 [選取資料庫] 頁面中，選取您要包含在 AG 中的資料庫。 然後按一下 **下一步**。
    
     請勿在 AG 中包含 **ReportServer**、 **ReportServerTempDB** 或 Persistent 聊天資料庫，因為這種情況不會支援這些功能。 您可以在 AG 中包含所有其他的商務用 Skype Server 資料庫。
    
   - 在 [**指定複本**] 頁面上，按一下 [**複本**] 索引標籤。然後按一下 [**新增複製副本**] 按鈕，並連接到您加入為 WSFC 節點的其他 SQL 實例。
    
   - 針對每個實例，選取 [ **自動容錯移轉** ] 和 [ **同步認可** ] 選項。 請勿選取 [ **可讀取的次要** ] 選項。
    
   - 按一下 [ **端點** ] 索引標籤，並確認 **埠號碼** 設定為5022。
    
   - 按一下 [ **監聽器** ] 索引標籤，然後選取 [ **建立可用性群組接聽程式** ] 選項。 在 [此選項] 底下輸入監聽器的名稱，並將 **埠** 設定為 1433 (此選項) 不支援其他埠。
    
   - 按一下 [ **新增**]，然後在 [ **IPv4 網址** ] 方塊中，提供您慣用的虛擬 IP 位址，然後按一下 **[確定]**。
    
   - 在 [**選取初始資料同步** 處理] 頁面中，選取 [完整]，並指定複本可存取的資料夾，而且這兩個複本所使用的 SQL Server 服務帳戶都具有寫入權限。 然後按一下 **下一步**。
    
     當您初始化資料庫時，會暫時使用此檔案共用。 如果您正在處理大型資料庫，建議您手動加以初始化，以防您的網路頻寬無法容納資料庫備份的大小。
    
     - 在 [驗證] 頁面中，確認所有驗證檢查是否都成功，然後按 **[下一步]**。
    
   - 在 [ **摘要** ] 頁面中，確認所有設定，然後按一下 [完成]。
    
7. 建立新的存放區，以指定 AG 偵聽程式。
    
   - 開啟拓撲產生器。 在拓撲中，展開 [**共用元件**]，以滑鼠右鍵按一下 [ **SQL Server 儲存**]，然後按一下 [**新增 SQL Server 儲存區**]。
    
   - 在 [**定義新的 SQL 儲存區**] 頁面中，先選取 [**高可用性設定**] 核取方塊，然後確定 [SQL AlwaysOn 可用性群組會出現在下拉式方塊中。
    
   - 在 [ **SQL Server 可用性攔截器 FQDN]** 方塊中，輸入您在建立可用性群組時所建立的攔截器 FQDN。
    
   - 在 [ **SQL Server FQDN** ] 方塊中，輸入 AG 之主要節點的 FQDN，然後按一下 **[確定]**。
    
8. 將新的 Always On 可用性群組與前端集區產生關聯。
    
   - 在 [拓撲產生器] 中，以滑鼠右鍵按一下要與 AG 產生關聯的集區，然後按一下 [ **編輯屬性**]。
    
   - 在 [**關聯**] 底下的 [ **SQL Server 儲存區**] 方塊中，選取 AG。 針對您要移至 AG 的集區中的任何其他資料庫，選取相同的群組。
    
   - 當您確定所有必要的資料庫都設定為 AG 時，請按一下 **[確定]**。
    
9. 發行拓撲。 從 [ **動作** ] 功能表中，按一下 [ **拓撲** ]，然後再 **發佈**。 然後在 [確認] 頁面中按 **[下一步]**。
    
10. 執行一些最後一個步驟，確定在 AG 中的每個複本上都有 SQL 登入。
    
    - 開啟拓撲產生器，選取 [ **從現有的部署下載拓撲**]，然後按一下 **[確定]**。
    
    - 展開商務用 Skype Server，展開您的拓撲，然後展開 **SQL Server 儲存區**。 以滑鼠右鍵按一下新 AG 的 SQL 儲存區，然後按一下 [**編輯屬性**]。
    
    - 在頁面底部的 [ **SQL Server FQDN** ] 方塊中，將值變更為 AG 的攔截器的 FQDN。
    
    - 發行拓撲。 從 [ **動作** ] 功能表中，按一下 [ **拓撲** ]，然後再 **發佈**。 然後在 [確認] 頁面中按 **[下一步]**。 然後，請稍候幾分鐘，以複製新的拓撲。
    
    - 開啟 SQL Server Management Studio，然後流覽至 AG。 將其容錯移轉至次要複本。
    
    - 開啟商務用 Skype Server 管理命令介面，並輸入下列 Cmdlet，以在此副本上建立 SQL 登入：
    
      ```powershell
      Install-CsDatabase -Update
      ```

      - 重複執行先前的兩個步驟 (將群組容錯移轉至次要複本，然後  `Install-CsDatabase -Update` 針對群組中的每個複本使用) 。
