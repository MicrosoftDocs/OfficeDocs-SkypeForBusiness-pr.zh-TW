---
title: Lync Server 2013：設定單一內部集區的 Web 發佈規則
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
TOCTitle: Configure web publishing rules for a single internal pool
ms:assetid: 86ff4b2a-1ba9-46a2-a175-8b19e00a49dd
ms:mtpsurl: https://technet.microsoft.com/en-us/library/Gg429712(v=OCS.15)
ms:contentKeyID: 48184725
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 6ffe61072df14e28c20c45eb72302905986c6357
ms.sourcegitcommit: bb53f131fabb03a66f0d000f8ba668fbad190778
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/11/2019
ms.locfileid: "40981699"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="configure-web-publishing-rules-for-a-single-internal-pool-in-lync-server-2013"></a>在 Lync Server 2013 中設定單一內部集區的 Web 發佈規則

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

_**主題上次修改日期：** 2014-07-07_

Microsoft Forefront 威脅管理閘道2010和 Internet Information Server 應用程式要求路由（IIS ARR）使用 web 發佈規則，將內部資源（例如會議 URL）發佈給網際網路上的使用者。

除了虛擬目錄的 Web 服務 Url 之外，您也必須為簡易 Url、LyncDiscover URL 和 Office Web Apps 伺服器建立發佈規則。 針對每個簡單的 URL，您必須在指向該簡單 URL 的反向 proxy 上建立個別規則。

如果您要部署行動性並使用自動探索，您必須為外部自動探索服務 URL 建立發佈規則。 自動探索也需要適用于您主管池和前端池之外部 Lync Server Web Services URL 的發佈規則。 如需有關建立自動探索的 web 發佈規則的詳細資料，請參閱[在 Lync Server 2013 中針對行動性配置反向 proxy](lync-server-2013-configuring-the-reverse-proxy-for-mobility.md)。

使用下列程式來建立 web 發佈規則。

<div>


> [!NOTE]  
> 這些程式假設您已安裝標準版的 Forefront 威脅管理閘道（TMG）2010，或已使用應用程式要求路由（IIS ARR）延伸安裝並設定 Internet information Server。 您使用的是 TMG 或 IIS ARR。



</div>

<div>

## <a name="to-create-a-web-server-publishing-rule-on-the-computer-running-tmg-2010"></a>在運行 TMG 2010 的電腦上建立 web 伺服器發佈規則

1.  按一下 [**開始**]，選取 [**程式**]，選取 [ **Microsoft Forefront tmg**]，然後按一下 [ **Forefront TMG 管理**]。

2.  在左窗格中，展開 [**伺服器名稱**]，以滑鼠右鍵按一下 [**防火牆原則**]，選取 [**新增**]，然後按一下 [**網站發佈規則**]。

3.  在 [**歡迎使用新的 Web 發佈規則**] 頁面上，輸入發佈規則的顯示名稱（例如，LyncServerWebDownloadsRule）。

4.  在 [**選取規則動作**] 頁面上，選取 [**允許**]。

5.  在 [**發佈類型**] 頁面上，選取 [**發佈單一網站或負載平衡器**]。

6.  在 [**伺服器連線安全性**] 頁面上，選取 [**使用 SSL 連線至已發佈的 Web 服務器或伺服器**伺服器陣列]。

7.  在 [**內部發佈詳細資料**] 頁面上，在 [內部**網站名稱**] 方塊中，輸入託管會議內容和通訊錄內容的內部網頁伺服器群的完整功能變數名稱（FQDN）。
    
    <div>
    

    > [!NOTE]  
    > 如果您的內部伺服器是標準版伺服器，此 FQDN 就是標準版伺服器 FQDN。 如果您的內部伺服器是前端池，此 FQDN 是一個硬體負載平衡器虛擬 IP （VIP），負載平衡內部的網路伺服器陣列伺服器。 TMG 伺服器必須能夠將 FQDN 解析為內部 web 伺服器的 IP 位址。 如果 TMG 伺服器無法將 FQDN 解析為適當的 IP 位址，您可以選取<STRONG>[使用電腦名稱稱或 ip 位址連線到已發佈的伺服器]</STRONG>，然後在 [<STRONG>電腦名稱稱或</STRONG> <STRONG>ip 位址</STRONG>] 方塊中，輸入內部 web 伺服器的 IP 位址。 如果您這樣做，您必須確認在 TMG 伺服器上已開啟埠53，而且該伺服器可以到達位於周邊網路的 DNS 伺服器。 您也可以使用本機 hosts 檔案中的專案來提供名稱解析。

    
    </div>

8.  在 [**內部發佈詳細資料**] 頁面上的 [**路徑（選用）** ] ** / **方塊中，輸入為要發佈的資料夾路徑。
    
    <div>
    

    > [!NOTE]  
    > 您只能在 [網站發佈嚮導] 中指定一個路徑。 您可以透過修改規則的屬性來新增其他路徑。

    
    </div>

9.  在 [**公用名稱詳細資料**] 頁面上，確認已選取 [**接受要求**] 底下的 [**此功能變數名稱**]，然後在 [**公用名**] 方塊中輸入外部 Web 服務 FQDN。

10. 在 [**選取 Web 攔截器]** 頁面上，按一下 [**新增**] 以開啟 [新增網頁監聽器定義] 嚮導。

11. 在 [**歡迎使用新的 Web 攔截器嚮導]** 頁面上，于 [**網頁監聽器名稱**] 方塊中輸入網頁監聽程式的名稱（例如，LyncServerWebServers）。

12. 在 [**用戶端連線安全性**] 頁面上，選取 [**與用戶端要求 SSL 安全**連線]。

13. 在 [ **Web 偵聽程式 IP 位址]** 頁面上，選取 [**外部**]，然後按一下 [**選取 IP 位址**]。

14. 在 [**外部監聽器 IP 選取]** 頁面上，選取**所選網路中 Forefront TMG 電腦上的 [指定 ip 位址**]，選取適當的 ip 位址，然後按一下 [**新增**]。

15. 在 [**偵聽程式 SSL 憑證]** 頁面上，**針對每個 IP 位址選取 [指派憑證**]，選取與外部 web FQDN 相關聯的 IP 位址，然後按一下 [**選取憑證**]。

16. 在 [**選取憑證**] 頁面上，選取符合步驟9所指定之公用名稱的憑證，然後按一下 [**選取**]。

17. 在 [**驗證設定**] 頁面上，選取 [**無驗證**]。

18. 在 [**單一登入設定**] 頁面上，按一下 **[下一步]**。

19. 在 [**完成 Web 攔截器嚮導]** 頁面上，確認**網頁監聽**程式設定正確無誤，然後按一下 **[完成]**。

20. 在 [**驗證委派**] 頁面上，選取 [**無委派]，但用戶端可以直接驗證**。

21. 在 [**使用者組**] 頁面上，按一下 **[下一步]**。

22. 在 [**完成新的 Web 發佈規則嚮導]** 頁面上，確認 Web 發佈規則設定正確無誤，然後按一下 **[完成]**。

23. 按一下 [詳細資料] 窗格**中的 [** 套用]，儲存變更並更新配置。

</div>

<div>

## <a name="to-create-a-web-server-publishing-rule-on-the-computer-running-iis-arr"></a>在執行 IIS ARR 的電腦上建立 web 伺服器發佈規則

1.  將您要用於反向 proxy 的憑證系結到 HTTPS 通訊協定。 按一下 [**開始**]，選取 [**程式**]，選取 [**管理工具**]，然後按一下 **[網際網路資訊服務（IIS）管理員**]。
    
    <div>
    

    > [!NOTE]  
    > 在<A href="http://go.microsoft.com/fwlink/?linkid=293391">使用 iis arr 作為 Lync Server 2013 的反向 Proxy</A>，您可以在 NextHop 文章中找到有關部署和設定 IIS ARR 的其他說明、螢幕擷取畫面及指導方針。

    
    </div>

2.  如果您尚未這麼做，請匯入您將用於反向 proxy 的憑證。 在 **[網際網路資訊服務（IIS）管理員**] 中，按一下主機左側大小的反向 proxy 伺服器名稱。 在位於主控台中間的 [ **IIS** ] 中找到 [**伺服器憑證**]。 以滑鼠右鍵按一下 [**伺服器憑證**]，然後選取 [**開啟功能**]。

3.  在主控台右側，按一下 [匯**入 ...**]。 輸入副檔名的路徑和檔案名，或按一下 [ **...** ]。 流覽證書。 選取憑證，然後按一下 [**開啟**]。 提供密碼來保護私用金鑰（如果您是在匯出憑證和私密金鑰時指派密碼）。 按一下 [確定]****。 如果已成功匯入證書，則憑證會以 [**伺服器憑證**] 中的專案的形式顯示在主控台中間。

4.  指派供 HTTPS 使用的憑證。 在主控台的左側，選取 IIS 伺服器的**預設網站**。 按一下右側的 [系結 **...**]。 在 [**網站綁定**] 對話方塊中，按一下 [**新增 ...**]。 在 [**類型：**] 下的 [**新增網站**系結] 對話方塊中，選取 [ **HTTPs**]。 選取 [HTTPs] 可讓您選取要用於 HTTPs 的憑證。 在 [ **SSL 憑證：**] 下，選取您針對反向 proxy 所匯入的憑證。 按一下 [確定]****。 然後按一下 [**關閉**]。 現在，證書已系結到安全通訊端層（SSL）和傳輸層安全性（TLS）的反向 proxy。
    
    <div>
    

    > [!IMPORTANT]  
    > 如果您在關閉中間憑證遺失的 [綁定] 對話方塊時收到警告，您必須找出並匯入公用 CA 根頒發機構憑證及任何中間 CA 憑證。 請參閱您要求憑證的公用 CA 中的指示，然後依照指示要求並匯入憑證連結。 如果您是從 Edge 伺服器匯出憑證，您可以匯出根 CA 憑證以及與 Edge 伺服器相關聯的任何中間 CA 憑證。 匯入根 CA 憑證至電腦的 [（不會與使用者儲存區混淆）] 信任的根憑證授權單位儲存及中間憑證到電腦的 [中級憑證授權單位] 存放區。

    
    </div>

5.  在位於主控台左側的 IIS 伺服器名稱下方，以滑鼠右鍵按一下 [**伺服器群**]，然後按一下 [**建立伺服器群 ...**]。
    
    <div>
    

    > [!NOTE]  
    > 如果您沒有看到 [<STRONG>伺服器群</STRONG>] 節點，您必須安裝應用程式要求路由。 如需詳細資訊，請參閱為<A href="lync-server-2013-setting-up-reverse-proxy-servers.md">Lync Server 2013 設定反向 proxy 伺服器</A>。

    
    </div>
    
    在 [**伺服器場名稱**] 的 [**建立伺服器群**] 對話方塊中，針對第一個 URL 輸入名稱（這可以是識別用途的易記名稱）。 按一下 **[下一步]**。

6.  在 [**伺服器位址**] 中的 [**新增伺服器**] 對話方塊中，輸入您前端伺服器上外部 web 服務的完整功能變數名稱（FQDN）。 在這裡使用的名稱，例如，在 [反向 proxy] 的 [[認證摘要-Lync Server 2013 的反向 proxy](lync-server-2013-certificate-summary-reverse-proxy.md)] 中使用的名稱是一樣的。 參照反向 proxy 的規劃，我們輸入 FQDN `webext.contoso.com`。 確認已選取 [**線上**] 旁的核取方塊。 按一下 [**新增**]，將伺服器新增至 web 伺服器的池中，以進行這項設定。
    
    <div>
    

    > [!WARNING]  
    > Lync Server 使用硬體負載平衡器來為 HTTP 和 HTTPS 流量進行池控制器和前端伺服器。 您只會在新增伺服器到 IIS ARR 伺服器群時提供一個 FQDN。 FQDN 將是非彙集伺服器設定中的前端伺服器或主管，或伺服器池的已設定硬體負載平衡器的 FQDN。 若要將 HTTP 和 HTTPS 流量進行負載平衡，唯一支援的方法是使用硬體負載平衡器。

    
    </div>

7.  在 [**新增伺服器**] 對話方塊中，按一下 [**高級設定 ...**]。 這會開啟一個對話方塊，以針對已設定的 FQDN 定義要求的應用程式要求路由。 用途是重新定義由 IIS ARR 處理要求時所使用的埠。
    
    根據預設，目的地 HTTP 埠必須定義為8080。 按一下目前**HTTPPort 80**旁邊的，然後將值設定為**8080**。 按一下目前**HTTPsPort 443**旁邊的，然後將值設定為**4443**。 將**體重**參數留在100。 如有需要，您可以在有比較基準統計資料後，重新定義指定規則的權重。 按一下 **[完成]** 以完成這部分規則設定。

8.  您可能會看到對話方塊重寫規則，通知您 IIS 管理員可以建立 URL 重寫規則，以便自動將所有傳入的要求路由到伺服器伺服器群。 按一下 **[是]**。 您將會手動調整規則，但選取 [是] 會設定初始配置。

9.  按一下您剛剛建立的伺服器伺服器陣列名稱稱。 在 IIS 管理員功能視圖的 [**伺服器場上**] 下 **，按兩下 [** 快取]。 取消選取 [**啟用磁片**快取]。 按一下**右側的 [** 套用]。

10. 按一下伺服器伺服器陣列的名稱。 在 [IIS 管理員功能視圖] 中的 [**伺服器場上**] 底下，按兩下 [ **Proxy**]。 在 [Proxy 設定] 頁面上，將**超時（秒）** 的值變更為適合您部署的值。 按一下 **[** 套用] 以儲存變更。
    
    <div>
    

    > [!IMPORTANT]  
    > Proxy 超時值是一個數位，不會因部署而異。 您應該監視您的部署並修改用戶端最佳體驗的價值。 您可以將值設為 [低] 與200。 如果您是在您的環境中支援 Lync 行動用戶端，則應該將此值設定為960，以允許從具有超時值900的 Office 365 中推播通知的超時時間。 您很可能需要增加超時值，以避免用戶端連線時中斷連線，或在用戶端中斷連線後，如果透過 proxy 的連線沒有中斷就將數位減少。 監視與基礎，對於您的環境而言是正常的，是判斷此值的正確設定所在位置的唯一精確方式。

    
    </div>

11. 按一下伺服器伺服器陣列的名稱。 在 IIS 管理員功能視圖的 [**伺服器**伺服器陣列] 底下，按兩下 [**路由規則**]。 在 [路由規則] 對話方塊中的 [路由] 下，清除 [啟用 SSL 卸載] 旁的核取方塊。 如果無法清除該核取方塊，請選取 [**使用 URL 重寫來檢查傳入要求**] 的核取方塊。 按一下 **[** 套用] 以儲存您的變更。
    
    <div>
    

    > [!WARNING]  
    > 不支援反向 proxy 的 SSL 卸載。

    
    </div>

12. 針對必須透過反向 proxy 傳送的每個 URL，重複執行步驟5-11。 常見的清單如下所示：
    
      - 前端伺服器 Web 服務外部： webext.contoso.com （已由初始逐步進行設定）
    
      - 主管的外部 Web 服務主管： webdirext.contoso.com （如果已部署控制器，則為選用）
    
      - 簡單的 URL 開會： meet.contoso.com
    
      - 簡單的 URL 撥入： dialin.contoso.com
    
      - Lync 自動探索 URL： lyncdiscover.contoso.com
    
      - Office Web Apps Server URL： officewebapps01.contoso.com
        
        <div>
        

        > [!IMPORTANT]  
        > Office Web Apps 伺服器的 URL 會使用不同的 HTTPsPort 位址。 在步驟7中，您將<STRONG>HTTPsPort</STRONG>定義為<STRONG>443</STRONG> ，並將<STRONG>HTTPPort</STRONG>定義為 port <STRONG>80</STRONG>。 所有其他設定都是相同的。

        
        </div>

13. 在主控台的左側，按一下 [IIS 伺服器名稱]。 在主控台中間，找到 [ **IIS**] 下的 [ **URL 重寫**]。 按兩下 [URL 重寫]，開啟 [URL 重寫規則] 設定。 您應該會看到您在先前步驟中建立的每個伺服器伺服器陣列的規則。 如果沒有，請確認您已在 [網際網路資訊伺服器管理員] 中，按一下 [**開始頁面**] 節點下方的 [ **IIS 伺服器**名稱]。

14. 在 [ **URL 重新寫入**] 對話方塊中，使用 webext.contoso.com 做為範例，顯示的完整規則名稱為**ARR\_webext.contoso.com\_loadbalance\_SSL**。
    
      - 按兩下規則以開啟 [**編輯入站規則**] 對話方塊。
    
      - 按一下 [**新增 ...** ]。 在 [**條件**] 對話方塊中。
    
      - 在 [**條件輸入**] 中的 [**新增條件**]：輸入**\_{HTTP HOST}**。 （當您輸入時，會顯示對話方塊，讓您選取條件）。 在 [**檢查輸入字串：** ] 下 **，選取 [符合模式**]。 在**模式輸入**類型**\*** 中。 應選取 [**忽略大小寫**]。 按一下 [確定]****。
    
      - 在 [**編輯入站規則**] 對話方塊中向下滾動，找出 [**動作**] 對話方塊。 **動作類型：** 應該設定為**路由到伺服器伺服器**陣列，**配置：** 設定為**HTTPs://**，**伺服器集群：** 設定為適用于此規則的 URL。 在這個範例中，應該將它設為**webext.contoso.com**。 **路徑：** 設定為 **/{R： 0}**
    
      - 按一下 **[** 套用] 以儲存您的變更。 按一下 [**返回規則**]，回到 URL 重寫規則。

15. 針對您所定義的每個 SSL 重寫規則（每個伺服器伺服器陣列 URL），重複步驟14中定義的程式。
    
    <div>
    

    > [!WARNING]  
    > 根據預設，會建立 HTTP 規則，並以與 SSL 規則相似的命名來表示。 針對我們目前的範例，HTTP 規則會命名為<STRONG>ARR_webext contoso. com_loadbalance</STRONG>。 這些規則不需要任何修改，而且可以放心地忽略。

    
    </div>

</div>

<div>

## <a name="to-modify-the-properties-of-the-web-publishing-rule-in-tmg-2010"></a>在 TMG 2010 中修改網頁發佈規則的屬性

1.  按一下 [**開始**]，指向 [**程式**]，選取 [ **Microsoft Forefront tmg**]，然後按一下 [ **Forefront TMG 管理**]。

2.  在左窗格中，展開 [**伺服器名稱**]，然後按一下 [**防火牆原則**]。

3.  在 [詳細資料] 窗格中，以滑鼠右鍵按一下您在上述程式中建立的 web 伺服器發佈規則（例如，LyncServerExternalRule），然後按一下 [**屬性**]。

4.  在 [**屬性**] 頁面的 [**從**] 索引標籤上，執行下列動作：
    
      - 在 [**此規則適用于來自下列來源的流量**] 清單中，按一下 [**隨處**]，然後按一下 [**移除**]。
    
      - 按一下 [**新增**]。
    
      - 在 [**新增網路實體**] 中展開 [**網路**]，按一下 [**外部**]，按一下 [**新增**]，然後按一下 [**關閉**]。

5.  在 [**至**] 索引標籤上，確定已選取 [**轉寄原始主機頭]，而不**是 [實際] 核取方塊。

6.  在 [**橋接**] 索引標籤上，選取 [重新**導向 SSL 埠要求**] 核取方塊，然後指定埠**4443**。

7.  在 [**公用名**] 索引標籤上，新增簡單的 url （例如，meet.contoso.com 和 dialin.contoso.com）。

8.  按一下 [套用] 以儲存變更，**然後按一下** **[確定]**。

9.  按一下 [詳細資料] 窗格**中的 [** 套用]，儲存變更並更新配置。

</div>

<div>

## <a name="to-modify-the-properties-of-the-web-publishing-rule-in-iis-arr"></a>在 IIS ARR 中修改網頁發佈規則的屬性

1.  按一下 [**開始**]，選取 [**程式**]，選取 [**管理工具**]，然後按一下 **[網際網路資訊服務（IIS）管理員**]。

2.  在主控台的左側，按一下 [IIS 伺服器名稱]。

3.  在主控台中間，找到 [ **IIS**] 下的 [ **URL 重寫**]。 按兩下 [URL 重寫]，開啟 [URL 重寫規則] 設定。

4.  按兩下您需要修改的規則。 視需要在**符合 URL**、**條件**、**伺服器變數**或**動作**時，進行您的修改。

5.  按一下 **[** 套用] 以確認您的變更。 按一下 [**返回規則**] 來修改其他規則，或者，如果您已完成變更，請關閉 [ **IIS Manager** ] 主控台。

</div>

</div>

<span> </span>

</div>

</div>

</div>

