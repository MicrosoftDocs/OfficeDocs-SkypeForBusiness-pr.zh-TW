---
title: 使用 CsCertificate 集中的 [暫存 AV] 和 [OAuth 憑證]
ms.reviewer: ''
ms.author: v-lanac
author: lanachin
TOCTitle: Staging AV and OAuth certificates using -Roll in Set-CsCertificate
ms:assetid: 22dec3cc-4b6b-4df2-b269-5b35df4731a7
ms:mtpsurl: https://technet.microsoft.com/en-us/library/JJ660292(v=OCS.15)
ms:contentKeyID: 49354387
ms.date: 07/23/2014
manager: serdars
mtps_version: v=OCS.15
ms.openlocfilehash: 4acdf759181dee3df872c7803ec595c63fb07016
ms.sourcegitcommit: bb53f131fabb03a66f0d000f8ba668fbad190778
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 05/11/2019
ms.locfileid: "40975598"
---
<div data-xmlns="http://www.w3.org/1999/xhtml">

<div class="topic" data-xmlns="http://www.w3.org/1999/xhtml" data-msxsl="urn:schemas-microsoft-com:xslt" data-cs="http://msdn.microsoft.com/en-us/">

<div data-asp="http://msdn2.microsoft.com/asp">

# <a name="staging-av-and-oauth-certificates-in-lync-server-2013-using--roll-in-set-cscertificate"></a><span data-ttu-id="5bc49-102">使用 CsCertificate 在 Lync Server 2013 中暫存 AV 和 OAuth 憑證</span><span class="sxs-lookup"><span data-stu-id="5bc49-102">Staging AV and OAuth certificates in Lync Server 2013 using -Roll in Set-CsCertificate</span></span>

</div>

<div id="mainSection">

<div id="mainBody">

<span> </span>

<span data-ttu-id="5bc49-103">_**主題上次修改日期：** 2012-11-13_</span><span class="sxs-lookup"><span data-stu-id="5bc49-103">_**Topic Last Modified:** 2012-11-13_</span></span>

<span data-ttu-id="5bc49-104">音訊/視頻（A/V）通訊是 Microsoft Lync Server 2013 的主要元件。</span><span class="sxs-lookup"><span data-stu-id="5bc49-104">Audio/Video (A/V) communications is a key component of Microsoft Lync Server 2013.</span></span> <span data-ttu-id="5bc49-105">應用程式共用和音訊與視訊會議等功能，都依賴指派給 A/V 邊緣服務的憑證，特別是 A/V 驗證服務。</span><span class="sxs-lookup"><span data-stu-id="5bc49-105">Features such as application sharing and audio and video conferencing rely on the certificates assigned to the A/V Edge service, specifically the A/V Authentication service.</span></span>

<div>


> [!IMPORTANT]
> <OL>
> <LI>
> <P><span data-ttu-id="5bc49-106">這個新功能是針對 A/V 邊緣服務和<EM>OAuthTokenIssuer</EM>憑證設計的。</span><span class="sxs-lookup"><span data-stu-id="5bc49-106">This new feature is designed to work for the A/V Edge service and the <EM>OAuthTokenIssuer</EM> certificate.</span></span> <span data-ttu-id="5bc49-107">其他憑證類型可以與 A/V 邊緣服務和 OAuth 憑證類型一起進行預配，但無法從 A/V 邊緣服務憑證的共存行為獲益。</span><span class="sxs-lookup"><span data-stu-id="5bc49-107">Other certificate types can be provisioned along with the A/V Edge service and OAuth certificate type, but will not benefit from the coexistence behavior that the A/V Edge service certificate will.</span></span></P>
> <LI>
> <P><span data-ttu-id="5bc49-108">用來管理 Microsoft Lync Server 2013 憑證的 Lync Server Management 命令介面 PowerShell Cmdlet 會參照 A/V 邊緣服務憑證作為<EM>AudioVideoAuthentication</EM>憑證類型，以及 OAuthServer 憑證類型<EM>OAuthTokenIssuer</EM>。</span><span class="sxs-lookup"><span data-stu-id="5bc49-108">The Lync Server Management Shell PowerShell cmdlets used to manage Microsoft Lync Server 2013 certificates refers to the A/V Edge service certificate as the <EM>AudioVideoAuthentication</EM> certificate type and the OAuthServer certificate as type <EM>OAuthTokenIssuer</EM>.</span></span> <span data-ttu-id="5bc49-109">針對本主題的其餘部分，以及唯一識別憑證，它們將會參照相同的識別碼類型、 <EM>AudioVideoAuthentication</EM>和<EM>OAuthTokenIssuer</EM>。</span><span class="sxs-lookup"><span data-stu-id="5bc49-109">For the rest of this topic and to uniquely identify the certificates, they will be referred to by the same identifier type, <EM>AudioVideoAuthentication</EM> and <EM>OAuthTokenIssuer</EM>.</span></span></P></LI></OL>



</div>

<span data-ttu-id="5bc49-110">A/V 驗證服務負責頒發用戶端和其他 A/V 消費者所使用的權杖。</span><span class="sxs-lookup"><span data-stu-id="5bc49-110">The A/V Authentication service is responsible for issuing tokens that are used by clients and other A/V consumers.</span></span> <span data-ttu-id="5bc49-111">權杖是從憑證上的屬性產生，當憑證到期、連線中斷與需求與新憑證所產生的新權杖重新加入時，就會產生這種情況。</span><span class="sxs-lookup"><span data-stu-id="5bc49-111">The tokens are generated from attributes on the certificate, and when the certificate expires, loss of connection and requirement to rejoin with a new token generated by the new certificate will result.</span></span> <span data-ttu-id="5bc49-112">Lync Server 2013 中的新功能可減輕這個問題，即在舊憑證即將過期，並允許兩個憑證在一段時間內繼續運作的功能。</span><span class="sxs-lookup"><span data-stu-id="5bc49-112">A new feature in Lync Server 2013 will alleviate this problem – the ability to stage a new certificate in advance of the old one expiring and allowing both certificates to continue to function for a period of time.</span></span> <span data-ttu-id="5bc49-113">此功能在 CsCertificate Lync Server 管理命令介面 Cmdlet 中使用更新的功能。</span><span class="sxs-lookup"><span data-stu-id="5bc49-113">This feature uses updated functionality in the Set-CsCertificate Lync Server Management Shell cmdlet.</span></span> <span data-ttu-id="5bc49-114">使用現有參數（EffectiveDate）的新參數-滾，會將新的 AudioVideoAuthentication 憑證放在證書存放區中。</span><span class="sxs-lookup"><span data-stu-id="5bc49-114">The new parameter –Roll, with the existing parameter –EffectiveDate, will place the new AudioVideoAuthentication certificate in the certificate store.</span></span> <span data-ttu-id="5bc49-115">較舊的 AudioVideoAuthentication 憑證仍會保留給已頒發的權杖，以供驗證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-115">The older AudioVideoAuthentication certificate will still remain for issued tokens to be validated against.</span></span> <span data-ttu-id="5bc49-116">從放置新的 AudioVideoAuthentication 憑證開始，將會發生下列一系列的事件：</span><span class="sxs-lookup"><span data-stu-id="5bc49-116">Beginning with putting the new AudioVideoAuthentication certificate in place, the following series of events will occur:</span></span>

<div>


> [!TIP]
> <span data-ttu-id="5bc49-117">使用 Lync Server 管理命令介面 Cmdlet 來管理憑證，您可以針對邊緣伺服器上的每個用途要求單獨且不同的憑證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-117">Using the Lync Server Management Shell cmdlets for managing certificates, you can request separate and distinct certificates for each purpose on the Edge Server.</span></span> <span data-ttu-id="5bc49-118">使用 Lync Server 部署嚮導中的 [憑證] 嚮導可協助您建立證書，但通常是<STRONG>預設</STRONG>類型，可將邊緣伺服器的所有憑證使用方式集中在單一憑證上。</span><span class="sxs-lookup"><span data-stu-id="5bc49-118">Using the Certificate Wizard in the Lync Server Deployment Wizard assists you in creating certificates, but is typically of the <STRONG>default</STRONG> type which couples all certificate uses for the Edge Server onto a single certificate.</span></span> <span data-ttu-id="5bc49-119">建議的做法是，如果您要使用 [滾動憑證] 功能，請將 AudioVideoAuthentication 憑證與其他憑證的目的分隔開來。</span><span class="sxs-lookup"><span data-stu-id="5bc49-119">The recommended practice if you are going to use the rolling certificate feature is to decouple the AudioVideoAuthentication certificate from the other certificate purposes.</span></span> <span data-ttu-id="5bc49-120">您可以設定並暫存預設類型的憑證，但只有合併的憑證 AudioVideoAuthentication 部分才能受益于轉移。</span><span class="sxs-lookup"><span data-stu-id="5bc49-120">You can provision and stage a certificate of the Default type, but only the AudioVideoAuthentication portion of the combined certificate will benefit from the staging.</span></span> <span data-ttu-id="5bc49-121">在證書到期時，在 [立即訊息交談] 中所涉及的使用者必須登入，然後再次登入，以使用與存取邊緣服務相關聯的新憑證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-121">A user involved in (for example) an instant messaging conversation when the certificate expires will need to log out and log back in to make use of the new certificate associated with the Access Edge service.</span></span> <span data-ttu-id="5bc49-122">使用網路會議 Edge 服務參與 Web 會議的使用者就會發生類似的行為。</span><span class="sxs-lookup"><span data-stu-id="5bc49-122">Similar behavior will occur for a user involved in a Web conference using the Web Conferencing Edge service.</span></span> <span data-ttu-id="5bc49-123">OAuthTokenIssuer 憑證是一種在所有伺服器上共用的特定類型。</span><span class="sxs-lookup"><span data-stu-id="5bc49-123">The OAuthTokenIssuer certificate is a specific type that is shared across all servers.</span></span> <span data-ttu-id="5bc49-124">您可以在一個位置建立和管理證書，並將憑證儲存在所有其他伺服器的中央管理儲存體中。</span><span class="sxs-lookup"><span data-stu-id="5bc49-124">You create and manage the certificate in one place and the certificate is stored in the Central Management store for all other servers.</span></span>



</div>

<span data-ttu-id="5bc49-125">若要在使用 CsCertificate Cmdlet 時充分瞭解您的選項和需求，請使用其他詳細資料，並使用它來暫存目前憑證到期前的憑證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-125">Additional detail is needed to fully understand your options and requirements when using the Set-CsCertificate cmdlet and using it to stage certificates prior to the current certificate expiring.</span></span> <span data-ttu-id="5bc49-126">-滾參數很重要，但實質上是單一用途。</span><span class="sxs-lookup"><span data-stu-id="5bc49-126">The –Roll parameter is important, but essentially single purpose.</span></span> <span data-ttu-id="5bc49-127">如果您將它定義為參數，您會告訴 CsCertificate，您將會在證書將變成時，提供受類型（例如 AudioVideoAuthentication 和 OAuthTokenIssuer）所定義之憑證的相關資訊。有效地定義者-EffectiveDate。</span><span class="sxs-lookup"><span data-stu-id="5bc49-127">If you define it as a parameter, you are telling Set-CsCertificate that you will be providing information about the certificate that will be affected defined by –Type (for example AudioVideoAuthentication and OAuthTokenIssuer), when the certificate will become effective defined by –EffectiveDate.</span></span>

<span data-ttu-id="5bc49-128">**-滾：**-滾參數是必要的，且具有必須與它一起提供的相依性。</span><span class="sxs-lookup"><span data-stu-id="5bc49-128">**-Roll:** The –Roll parameter is required and has dependencies that must be supplied along with it.</span></span> <span data-ttu-id="5bc49-129">必要參數以完整定義哪些證書會受到影響，以及它們將如何套用：</span><span class="sxs-lookup"><span data-stu-id="5bc49-129">Required parameters to fully define which certificates will be affected and how they will be applied:</span></span>

<span data-ttu-id="5bc49-130">**-EffectiveDate：** 參數-EffectiveDate 會定義新憑證在目前憑證中成為共同作用中的時間。</span><span class="sxs-lookup"><span data-stu-id="5bc49-130">**-EffectiveDate:** The parameter –EffectiveDate defines when the new certificate will become co-active with the current certificate.</span></span> <span data-ttu-id="5bc49-131">[– EffectiveDate] 可能會接近目前憑證的到期時間，或者可能是較長的時間。</span><span class="sxs-lookup"><span data-stu-id="5bc49-131">The –EffectiveDate can be close to the expiry time of the current certificate, or it can be a longer period of time.</span></span> <span data-ttu-id="5bc49-132">建議的 AudioVideoAuthentication 憑證最小值為8小時，這是使用 AudioVideoAuthentication 憑證所頒發之 AV Edge 服務權杖的預設權杖存留期。</span><span class="sxs-lookup"><span data-stu-id="5bc49-132">A recommended minimum –EffectiveDate for the AudioVideoAuthentication certificate would be 8 hours, which is the default token lifetime for AV Edge service tokens issued using the AudioVideoAuthentication certificate.</span></span>

<span data-ttu-id="5bc49-133">在暫存 OAuthTokenIssuer 憑證時，在證書生效之前，可能會有不同的時間需求。</span><span class="sxs-lookup"><span data-stu-id="5bc49-133">When staging OAuthTokenIssuer certificates, there are different requirements for the lead time before the certificate can become effective.</span></span> <span data-ttu-id="5bc49-134">OAuthTokenIssuer 憑證對於其提前期應具有的最短時間為目前憑證到期時間之前的24小時。</span><span class="sxs-lookup"><span data-stu-id="5bc49-134">The minimum time that the OAuthTokenIssuer certificate should have for its lead time is 24 hours before the expiration time of the current certificate.</span></span> <span data-ttu-id="5bc49-135">共存的延長提前期是由於其他伺服器角色依賴于 OAuthTokenIssuer 憑證（例如 Exchange Server），而該證書已建立驗證與加密金鑰的保留時間較長原料.</span><span class="sxs-lookup"><span data-stu-id="5bc49-135">The extended lead time for the coexistence is because of other server roles that are dependent on the OAuthTokenIssuer certificate (Exchange Server, for example) which has a longer retention time for certificate created authentication and encryption key materials.</span></span>

<span data-ttu-id="5bc49-136">**-指紋：**[指紋] 是憑證上專用於該憑證的屬性。</span><span class="sxs-lookup"><span data-stu-id="5bc49-136">**-Thumbprint:** The thumbprint is an attribute on the certificate that is unique to that certificate.</span></span> <span data-ttu-id="5bc49-137">– Thumbprint 參數是用來識別受 CsCertificate Cmdlet 動作影響的憑證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-137">The –Thumbprint parameter is used to identify the certificate that will be affected by the actions of the Set-CsCertificate cmdlet.</span></span>

<span data-ttu-id="5bc49-138">**-類型：**– Type 參數可以接受單一憑證使用類型，或以逗號分隔的憑證使用類型清單。</span><span class="sxs-lookup"><span data-stu-id="5bc49-138">**-Type:** The –Type parameter can accept a single certificate usage type or a comma separated list of certificate usage types.</span></span> <span data-ttu-id="5bc49-139">證書類型是識別 Cmdlet 與伺服器的憑證類型，憑證的用途是什麼。</span><span class="sxs-lookup"><span data-stu-id="5bc49-139">The certificate types are those that identify to the cmdlet and to the server what the purpose of the certificate is.</span></span> <span data-ttu-id="5bc49-140">例如，輸入 AudioVideoAuthentication 是供 A/V 邊緣服務和 AV 驗證服務使用。</span><span class="sxs-lookup"><span data-stu-id="5bc49-140">For example, type AudioVideoAuthentication is for use by the A/V Edge service and the AV Authentication service.</span></span> <span data-ttu-id="5bc49-141">如果您決定同時暫存及建立不同類型的憑證，您必須考慮憑證的最長有效前置時間。</span><span class="sxs-lookup"><span data-stu-id="5bc49-141">If you decide to stage and provision certificates of a different type at the same time, you must consider the longest required minimum effective lead time for the certificates.</span></span> <span data-ttu-id="5bc49-142">例如，您需要暫存類型 AudioVideoAuthentication 和 OAuthTokenIssuer 的憑證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-142">For example, you need to stage certificates of type AudioVideoAuthentication and OAuthTokenIssuer.</span></span> <span data-ttu-id="5bc49-143">您的最小值– EffectiveDate 必須是兩個憑證的較大者，在此案例中為 OAuthTokenIssuer，其最小前置時間為24小時。</span><span class="sxs-lookup"><span data-stu-id="5bc49-143">Your minimum –EffectiveDate must be the greater of the two certificates, in this case the OAuthTokenIssuer, which has a minimum lead time of 24 hours.</span></span> <span data-ttu-id="5bc49-144">如果您不想要暫存前置時間為24小時的 AudioVideoAuthentication 憑證，請使用更符合您需求的 EffectiveDate 來單獨階段。</span><span class="sxs-lookup"><span data-stu-id="5bc49-144">If you do not want to stage the AudioVideoAuthentication certificate with a lead time of 24 hours, stage it separately with an EffectiveDate that is more to your requirements.</span></span>

<div>

## <a name="to-update-or-renew-an-av-edge-service-certificate-with-a-roll-and--effectivedate-parameters"></a><span data-ttu-id="5bc49-145">使用–滾與-EffectiveDate 參數更新或更新 A/V 邊緣服務憑證</span><span class="sxs-lookup"><span data-stu-id="5bc49-145">To update or renew an A/V Edge service certificate with a –Roll and -EffectiveDate parameters</span></span>

1.  <span data-ttu-id="5bc49-146">以管理員群組的成員身分登入本機電腦。</span><span class="sxs-lookup"><span data-stu-id="5bc49-146">Log on to the local computer as a member of the Administrators group.</span></span>

2.  <span data-ttu-id="5bc49-147">在 A/V 邊緣服務上，以現有憑證的可匯出私密金鑰來要求續約或新的 AudioVideoAuthentication 憑證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-147">Request a renewal or new AudioVideoAuthentication certificate with exportable private key for the existing certificate on the A/V Edge service.</span></span>

3.  <span data-ttu-id="5bc49-148">將新的 AudioVideoAuthentication 憑證匯入到 Edge 伺服器以及您的池中的所有其他邊緣伺服器（如果您已部署一個池）。</span><span class="sxs-lookup"><span data-stu-id="5bc49-148">Import the new AudioVideoAuthentication certificate to the Edge Server and all other Edge Server in your pool (if you have a pool deployed).</span></span>

4.  <span data-ttu-id="5bc49-149">使用 CsCertificate Cmdlet 設定匯入的憑證，並將–滾參數與– EffectiveDate 參數搭配使用。</span><span class="sxs-lookup"><span data-stu-id="5bc49-149">Configure the imported certificate with the Set-CsCertificate cmdlet and use the –Roll parameter with the –EffectiveDate parameter.</span></span> <span data-ttu-id="5bc49-150">生效日期應該定義為目前的憑證到期時間（14:00:00 或 2:00:00 PM）減去權杖存留期（預設為八小時）。</span><span class="sxs-lookup"><span data-stu-id="5bc49-150">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus token lifetime (by default eight hours).</span></span> <span data-ttu-id="5bc49-151">這會告訴我們，必須將憑證設定為使用中的狀態，且是– EffectiveDate \<字串\>： "7/22/2012 6:00:00 AM"。</span><span class="sxs-lookup"><span data-stu-id="5bc49-151">This gives us a time that the certificate must be set to active, and is the –EffectiveDate \<string\>: “7/22/2012 6:00:00 AM”.</span></span>
    
    <div>
    

    > [!IMPORTANT]
    > <span data-ttu-id="5bc49-152">對於邊緣池，您必須按照部署的第一個證書所定義的日期和時間來部署並設定所有 AudioVideoAuthentication 憑證，以避免由於較舊的憑證在所有用戶端和消費者權杖已使用新憑證更新之前，可能發生的 A/V 通訊中斷。</span><span class="sxs-lookup"><span data-stu-id="5bc49-152">For an Edge pool, you must have all AudioVideoAuthentication certificates deployed and provisioned by the date and time defined by the –EffectiveDate parameter of the first certificate deployed to avoid possible A/V communications disruption due to the older certificate expiring before all client and consumer tokens have been renewed using the new certificate.</span></span>

    
    </div>
    
    <span data-ttu-id="5bc49-153">具有-滾和– EffectiveTime 參數的 [設定 CsCertificate] 命令：</span><span class="sxs-lookup"><span data-stu-id="5bc49-153">The Set-CsCertificate command with the –Roll and –EffectiveTime parameter:</span></span>
    
        Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint <thumb print of new certificate> -Roll -EffectiveDate <date and time for certificate to become active>
    
    <span data-ttu-id="5bc49-154">CsCertificate 命令的範例設定：</span><span class="sxs-lookup"><span data-stu-id="5bc49-154">An example Set-CsCertificate command:</span></span>
    
        Set-CsCertificate -Type AudioVideoAuthentication -Thumbprint "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/22/2012 6:00:00 AM"
    
    <div>
    

    > [!IMPORTANT]
    > <span data-ttu-id="5bc49-155">EffectiveDate 必須格式化，才能符合您伺服器的區域及語言設定。</span><span class="sxs-lookup"><span data-stu-id="5bc49-155">The EffectiveDate must be formatted to match your server’s region and language settings.</span></span> <span data-ttu-id="5bc49-156">此範例使用美國英文地區和語言設定</span><span class="sxs-lookup"><span data-stu-id="5bc49-156">The example uses the US English Region and Language settings</span></span>

    
    </div>

<span data-ttu-id="5bc49-157">若要進一步瞭解設定 CsCertificate、滾及– EffectiveDate 使用的程式，以暫存新的憑證來頒發新的 AudioVideoAuthentication 權杖，同時仍使用現有的憑證來驗證使用中的 AudioVideoAuthentication根據消費者，視覺時間軸是瞭解程式的有效方式。</span><span class="sxs-lookup"><span data-stu-id="5bc49-157">To further understand the process that Set-CsCertificate, -Roll, and –EffectiveDate use to stage a new certificate for issuing new AudioVideoAuthentication tokens while still using an existing certificate to validate AudioVideoAuthentication that are in use by consumers, a visual timeline is an effective means of understanding the process.</span></span>

<span data-ttu-id="5bc49-158">在下列範例中，系統管理員會判斷出 A/V Edge 服務憑證到期於07/22/2012 上的 2:00:00 PM。</span><span class="sxs-lookup"><span data-stu-id="5bc49-158">In the following example, the administrator determines that the A/V Edge service certificate is due to expire at 2:00:00 PM on 07/22/2012.</span></span> <span data-ttu-id="5bc49-159">他要求並接收新的憑證，並將其匯入到其池中的每個邊緣伺服器。</span><span class="sxs-lookup"><span data-stu-id="5bc49-159">He requests and receives a new certificate and imports it to each Edge Server in his pool.</span></span> <span data-ttu-id="5bc49-160">在07/22/2012 時，他開始執行 CsCertificate with-滾、-Thumbprint 等於新憑證的指紋字串，並將– EffectiveTime 設定為 07/22/2012 6:00:00 AM。</span><span class="sxs-lookup"><span data-stu-id="5bc49-160">At 2 AM on 07/22/2012, he begins running Get-CsCertificate with –Roll, -Thumbprint equal to the thumbprint string of the new certificate, and –EffectiveTime set to 07/22/2012 6:00:00 AM.</span></span> <span data-ttu-id="5bc49-161">他在每個 Edge 伺服器上執行這個命令。</span><span class="sxs-lookup"><span data-stu-id="5bc49-161">He runs this command on each Edge Server.</span></span>

<span data-ttu-id="5bc49-162">![使用 [滾] 和 [EffectiveDate] 參數。](images/JJ660292.21d51a76-0d03-4ed7-a37e-a7c14940265f(OCS.15).jpg "使用 [滾] 和 [EffectiveDate] 參數。")</span><span class="sxs-lookup"><span data-stu-id="5bc49-162">![Using the Roll and the EffectiveDate parameters.](images/JJ660292.21d51a76-0d03-4ed7-a37e-a7c14940265f(OCS.15).jpg "Using the Roll and the EffectiveDate parameters.")</span></span>

<span data-ttu-id="5bc49-163">當達到有效時間時（7/22/2012 6:00:00 AM），所有新的權杖都是由新的憑證所頒發。</span><span class="sxs-lookup"><span data-stu-id="5bc49-163">When the effective time is reached (7/22/2012 6:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="5bc49-164">驗證權杖時，會先對照新憑證驗證權杖。</span><span class="sxs-lookup"><span data-stu-id="5bc49-164">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="5bc49-165">如果驗證失敗，則會嘗試舊的憑證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-165">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="5bc49-166">嘗試新的並回到舊憑證的程式將會繼續，直到舊憑證的到期時間為止。</span><span class="sxs-lookup"><span data-stu-id="5bc49-166">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="5bc49-167">舊憑證到期後（7/22/2012 2:00:00 PM），權杖將只會由新憑證驗證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-167">Once the old certificate has expired (7/22/2012 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="5bc49-168">使用 CsCertificate Cmdlet 和– Previous 參數，就能安全地移除舊的憑證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-168">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the –Previous parameter.</span></span>

    Remove-CsCertificate -Type AudioVideoAuthentication -Previous

</div>

<div>

## <a name="to-update-or-renew-an-oauthtokenissuer-certificate-with-a-roll-and--effectivedate-parameters"></a><span data-ttu-id="5bc49-169">使用-滾和-EffectiveDate 參數更新或更新 OAuthTokenIssuer 憑證</span><span class="sxs-lookup"><span data-stu-id="5bc49-169">To update or renew an OAuthTokenIssuer certificate with a –Roll and -EffectiveDate parameters</span></span>

1.  <span data-ttu-id="5bc49-170">以管理員群組的成員身分登入本機電腦。</span><span class="sxs-lookup"><span data-stu-id="5bc49-170">Log on to the local computer as a member of the Administrators group.</span></span>

2.  <span data-ttu-id="5bc49-171">在 A/V 邊緣服務上，以現有憑證的可匯出私密金鑰來要求續約或新的 OAuthTokenIssuer 憑證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-171">Request a renewal or new OAuthTokenIssuer certificate with exportable private key for the existing certificate on the A/V Edge service.</span></span>

3.  <span data-ttu-id="5bc49-172">將新的 OAuthTokenIssuer 憑證匯入到您的池中的前端伺服器（如果您已部署一個池）。</span><span class="sxs-lookup"><span data-stu-id="5bc49-172">Import the new OAuthTokenIssuer certificate to a Front End Server in your pool (if you have a pool deployed).</span></span> <span data-ttu-id="5bc49-173">OAuthTokenIssuer 憑證會全域複製，而且只需要在您部署中的任何伺服器上更新並更新。</span><span class="sxs-lookup"><span data-stu-id="5bc49-173">The OAuthTokenIssuer certificate is replicated globally and only needs to be updated and renewed at any server in your deployment.</span></span> <span data-ttu-id="5bc49-174">前端伺服器是用來做為範例。</span><span class="sxs-lookup"><span data-stu-id="5bc49-174">The Front End Server is used as an example.</span></span>

4.  <span data-ttu-id="5bc49-175">使用 CsCertificate Cmdlet 設定匯入的憑證，並將–滾參數與– EffectiveDate 參數搭配使用。</span><span class="sxs-lookup"><span data-stu-id="5bc49-175">Configure the imported certificate with the Set-CsCertificate cmdlet and use the –Roll parameter with the –EffectiveDate parameter.</span></span> <span data-ttu-id="5bc49-176">生效日期應該定義為目前的憑證到期時間（14:00:00 或 2:00:00 PM）減去至少24小時。</span><span class="sxs-lookup"><span data-stu-id="5bc49-176">The effective date should be defined as the current certificate expire time (14:00:00, or 2:00:00 PM) minus a minimum of 24 hours.</span></span>
    
    <span data-ttu-id="5bc49-177">具有-滾和– EffectiveTime 參數的 [設定 CsCertificate] 命令：</span><span class="sxs-lookup"><span data-stu-id="5bc49-177">The Set-CsCertificate command with the –Roll and –EffectiveTime parameter:</span></span>
    
        Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint <thumb print of new certificate> -Roll -EffectiveDate <date and time for certificate to become active>
    
    <span data-ttu-id="5bc49-178">CsCertificate 命令的範例設定：</span><span class="sxs-lookup"><span data-stu-id="5bc49-178">An example Set-CsCertificate command:</span></span>
    
        Set-CsCertificate -Type OAuthTokenIssuer -Thumbprint "B142918E463981A76503828BB1278391B716280987B" -Roll -EffectiveDate "7/21/2012 1:00:00 PM"
    
    <div>
    

    > [!IMPORTANT]
    > <span data-ttu-id="5bc49-179">EffectiveDate 必須格式化，才能符合您伺服器的區域及語言設定。</span><span class="sxs-lookup"><span data-stu-id="5bc49-179">The EffectiveDate must be formatted to match your server’s region and language settings.</span></span> <span data-ttu-id="5bc49-180">此範例使用美國英文地區和語言設定</span><span class="sxs-lookup"><span data-stu-id="5bc49-180">The example uses the US English Region and Language settings</span></span>

    
    </div>

<span data-ttu-id="5bc49-181">當達到有效時間時（7/21/2012 1:00:00 AM），所有新的權杖都是由新的憑證所頒發。</span><span class="sxs-lookup"><span data-stu-id="5bc49-181">When the effective time is reached (7/21/2012 1:00:00 AM), all new tokens are issued by the new certificate.</span></span> <span data-ttu-id="5bc49-182">驗證權杖時，會先對照新憑證驗證權杖。</span><span class="sxs-lookup"><span data-stu-id="5bc49-182">When validating tokens, tokens will first be validated against the new certificate.</span></span> <span data-ttu-id="5bc49-183">如果驗證失敗，則會嘗試舊的憑證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-183">If the validation fails, the old certificate is tried.</span></span> <span data-ttu-id="5bc49-184">嘗試新的並回到舊憑證的程式將會繼續，直到舊憑證的到期時間為止。</span><span class="sxs-lookup"><span data-stu-id="5bc49-184">The process of trying the new and falling back to the old certificate will continue until the expiry time of the old certificate.</span></span> <span data-ttu-id="5bc49-185">舊憑證到期後（7/22/2012 2:00:00 PM），權杖將只會由新憑證驗證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-185">Once the old certificate has expired (7/22/2012 2:00:00 PM), tokens will only be validated by the new certificate.</span></span> <span data-ttu-id="5bc49-186">使用 CsCertificate Cmdlet 和– Previous 參數，就能安全地移除舊的憑證。</span><span class="sxs-lookup"><span data-stu-id="5bc49-186">The old certificate can be safely removed using the Remove-CsCertificate cmdlet with the –Previous parameter.</span></span>

    Remove-CsCertificate -Type OAuthTokenIssuer -Previous

</div>

<div>

## <a name="see-also"></a><span data-ttu-id="5bc49-187">請參閱</span><span class="sxs-lookup"><span data-stu-id="5bc49-187">See Also</span></span>


[<span data-ttu-id="5bc49-188">在 Lync Server 2013 中規劃 Edge Server 憑證</span><span class="sxs-lookup"><span data-stu-id="5bc49-188">Plan for Edge Server certificates in Lync Server 2013</span></span>](lync-server-2013-plan-for-edge-server-certificates.md)  
[<span data-ttu-id="5bc49-189">在 Lync Server 2013 中管理伺服器間驗證（OAuth）與合作夥伴應用程式</span><span class="sxs-lookup"><span data-stu-id="5bc49-189">Managing server-to-server authentication (OAuth) and partner applications in Lync Server 2013</span></span>](lync-server-2013-managing-server-to-server-authentication-oauth-and-partner-applications.md)  


[<span data-ttu-id="5bc49-190">針對 Lync Server 2013 設定 Edge 憑證</span><span class="sxs-lookup"><span data-stu-id="5bc49-190">Set up Edge certificates for Lync Server 2013</span></span>](lync-server-2013-set-up-edge-certificates.md)  
<span data-ttu-id="5bc49-191">[Set-CsCertificate](https://technet.microsoft.com/en-us/library/Gg398518(v=OCS.15))</span><span class="sxs-lookup"><span data-stu-id="5bc49-191">[Set-CsCertificate](https://technet.microsoft.com/en-us/library/Gg398518(v=OCS.15))</span></span>  
<span data-ttu-id="5bc49-192">[移除-CsCertificate](https://technet.microsoft.com/en-us/library/Gg412895(v=OCS.15))</span><span class="sxs-lookup"><span data-stu-id="5bc49-192">[Remove-CsCertificate](https://technet.microsoft.com/en-us/library/Gg412895(v=OCS.15))</span></span>  
  

</div>

</div>

<span> </span>

</div>

</div>

</div>

